# ðŸ”§ Stone Grimoire â€” Dev Handoff (Repo-Aware)

## 0) Non-negotiables (keep these intact)
- **ND-safe by design:** no autoplay audio, gentle fades, no strobe, volume caps.  
- **Museum-grade feel:** illuminated parchment UI, plaques, provenance blocks.  
- **Open-world:** no locks/gates; all labs/realms are directly reachable.  
- **Root-relative asset paths** for shared CSS/JS (`/assets/...`) to avoid nested path breakage across `/`, `/chapels/`, `/main/`, etc.  

---

## 1) Whatâ€™s already in repo and must remain
**Data**
- `assets/data/stylepacks.json` (curated packs; provenance header; ND-safe palettes)  
- `assets/data/angels72.json` (full 72: sign/segment/decan/ruler/element/stylepack/toneHz/pattern)  

**Pages (examples the user mentioned)**
- Root: `index.html`, `cathedral.html`, `angels72.html`  
- Chapels/labs (open-world):  
  - `chapels/angel-lab.html`, `chapels/angel-cubes.html`, `chapels/musical-cubes.html`, `chapels/cubes-visual-lab.html`  
  - `chapels/apprentice-pillar.html`, `chapels/jacobs-ladder.html`, `chapels/helix-totem.html`  
  - `chapels/crypt.html`, `chapels/lady-chapel.html`  
  - `chapels/crystal-grid.html`, `chapels/crystal-pavilion.html`  
  - `chapels/respawn-gate.html`  

**CSS**
- `assets/css/palette.css`  
- `assets/css/light.css` (plaque / ritual / overlays)  
- `assets/css/dark.css` (new, supports theme toggle)  

**JS (engines + utilities)**
- `assets/js/theme.js` âœ… UPDATED â€” light/dark toggle + inject button  
- `assets/js/engines/ambient-engine.js` âœ… ND-safe audio  
- `assets/js/engines/cymatic-engine.js` âœ… unified ASCII-safe module  
- Other helpers stay as-is  

**Navigation**
- Footer/nav blocks point back to `../cathedral.html` and other labs.  

---

## 2) What we changed right now
- **Theme system**:  
  - `<link id="theme-css" rel="stylesheet" href="/assets/css/light.css">`  
  - `<script src="/assets/js/theme.js" defer></script>`  
  - Handles light/dark swap + localStorage; button injected into `.c99-ritual`.  
- **Cymatics engine**:  
  - Canonical at `assets/js/engines/cymatic-engine.js`.  
  - Mount with:  
    ```html
    <canvas id="cymatics"></canvas>
    <script type="module">
      import { mountCymaticsCanvas } from "/assets/js/engines/cymatic-engine.js";
      window.addEventListener("DOMContentLoaded", () => 
        mountCymaticsCanvas("#cymatics"));
    </script>
    ```

---

## 3) Known repo quirks to fix
- **Duplicate dirs** (e.g. `Folios/` vs `folios/`) â†’ keep lowercase, update links.  
- **Old ambient engine copy** (`js/audio/ambient-engine.js`) â†’ keep only `assets/js/engines/ambient-engine.js`.  
- **Root-relative assets** â†’ replace `../assets/...` with `/assets/...` globally.  

---

## 4) Planetary light & stained-glass overlay (planned)
- Implement `assets/js/planetary-light.js` later.  
- Gently shift cathedral tint by planetary hour (`--planet-glow` CSS var).  
- Used in `.overlay-vitrail`.  

---

## 5) Angels Ladder (grid)
- Data: `assets/data/angels72.json`.  
- Page: `angels72.html`. On click:  
  - Apply angelâ€™s `stylepack`.  
  - Call `setToneHz(angel.toneHz)`.  
  - Update plaque with details.  
- ND-safe: audio only on user tap.  

---

## 6) Labs wiring
- **Angel Cubes Lab**: 12 ratios â†’ tones â†’ angels â†’ plaque.  
- **Crystal Grid**: crystals = tone+stylepack, tap to lay glowing grid.  
- **Helix Totem / Jacobâ€™s Ladder**: 72-step climb â†’ tone+color glide.  
- **Save Art MVP**: add *Export PNG* of current canvas (filename = angel+timestamp).  

---

## 7) Accessibility guardrails
- Respect `prefers-reduced-motion`.  
- No autoplay; first tap resumes audio.  
- Global volume cap.  
- Provide *Quietus* button.  
- Plaques have ARIA role="note".  

---

## 8) Verification steps
1. Open `/index.html` + `/cathedral.html` â†’ theme toggle works.  
2. Open `/angels72.html` â†’ click = tone + skin + plaque update.  
3. Test chapels (`angel-cubes.html`, `crystal-grid.html`) â†’ ND-safe interactions.  
4. Check no uppercase folder references.  

---

## 9) What not to change
- Donâ€™t re-add relative paths for shared CSS/JS.  
- Donâ€™t enable autoplay or strobe.  
- Donâ€™t gate pages behind unlocks.  

---

## 10) Stretch goals
- Add style engine shim â†’ map `stylepacks.json` â†’ CSS vars.  
- Add planetary-light after theme is stable.  

---

### One-line summary
	> Keep ND-safe, museum-grade, open-world. Theme swap standardized, cymatic engine unified, angels72/stylepacks data in place. Fix duplicate folders + paths, defer planetary light. No autoplay; all must work on iPad Safari.