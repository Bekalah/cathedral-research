<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cathedral Portal • Realms & Engines</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: system-ui, sans-serif; background:#0f0f17; color:#eee; margin:0; }
  header { padding:1.2rem 2rem; background:#181826; border-bottom:1px solid #2c2c40; }
  h1 { margin:0; font-size:1.6rem; letter-spacing: .05em; }
  main { padding:2rem; max-width:1200px; margin:0 auto; }
  section { margin-bottom:3rem; }
  .grid { display:grid; gap:1.2rem; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); }
  .card { background:#1e1e2d; padding:1rem 1.1rem 1.3rem; border:1px solid #2b2b3b; border-radius:10px; position:relative; }
  .card h3 { margin:.2rem 0 .4rem; font-size:1.05rem; }
  .tag { display:inline-block; background:#2e3655; padding:.15rem .55rem; border-radius:999px; font-size:.65rem; letter-spacing:.05em; text-transform:uppercase; }
  .meta { font-size:.7rem; opacity:.75; margin-top:.35rem; line-height:1.3; }
  footer { padding:2rem; text-align:center; font-size:.75rem; opacity:.6; }
  a { color:#9ad5ff; text-decoration:none; }
  a:hover { text-decoration:underline; }
  .realm { border-left:4px solid #4e67ff; }
  .engine { border-left:4px solid #ff8f3d; }
  .codex { border-left:4px solid #70d18c; }
  .pillrow { margin-top:.4rem; display:flex; flex-wrap:wrap; gap:.35rem; }
  .pill { background:#303a52; padding:.25rem .55rem; border-radius:6px; font-size:.6rem; }
</style>
</head>
<body>
<header>
  <h1>Cathedral Portal <span style="opacity:.5;font-weight:400;">Realms • Engines • Codex</span></h1>
</header>
<main>
  <section id="codex" class="codex">
    <h2>Codex 144 • Living Lattice</h2>
    <p id="codex-stats">Loading codex metrics…</p>
    <details open>
      <summary>Schema Integrity</summary>
      <pre id="schema-summary" style="background:#12121a;padding:1rem;border-radius:8px;overflow:auto;max-height:220px;font-size:.7rem;"></pre>
    </details>
  </section>
  <section id="realms" class="realm">
    <h2>Realms</h2>
    <div id="realm-grid" class="grid"></div>
  </section>
  <section id="engines" class="engine">
    <h2>Engines</h2>
    <div id="engine-grid" class="grid"></div>
  </section>
</main>
<footer>Cathedral Monorepo • ND-safe • Provenance Enforced • <a href="docs/HITCHHIKERS_REALM_GUIDE.md">Hitchhiker Guide</a></footer>
<script type="module">
async function loadJSON(path) { const r = await fetch(path); return r.json(); }

async function init() {
  // Codex metrics
  let codex = await loadJSON('../data/codex.144_99.json').catch(()=>null);
  if (codex && codex.$ref) {
    try { codex = await loadJSON(codex.$ref.replace('../','../')); } catch {}
  }
  if (Array.isArray(codex)) {
    document.getElementById('codex-stats').textContent = `${codex.length} nodes • sample node_ids: ${codex.slice(0,5).map(n=>n.node_id).join(', ')}`;
  } else {
    document.getElementById('codex-stats').textContent = 'Codex not available';
  }

  // Schema (static)
  const schema = await loadJSON('../docs/CODEX_SCHEMA.json').catch(()=>null);
  if (schema) {
    document.getElementById('schema-summary').textContent = JSON.stringify(schema.items.properties, null, 2);
  }

  // Realms (apps folder discovery stub - static list for now)
  const realms = [
    { id:'arcanae-lab', title:'Arcanae Lab', purpose:'Archetype & harmonic research lab', path:'../apps/arcanae-lab/' },
    { id:'cathedral-of-circuits', title:'Cathedral of Circuits', purpose:'Fractal art/game cathedral engine', path:'../apps/cathedral-of-circuits/' },
    { id:'stone-grimoire', title:'Stone Grimoire', purpose:'Living archive & narrative codex fusion', path:'../apps/stone-grimoire/' }
  ];
  const realmGrid = document.getElementById('realm-grid');
  realms.forEach(r => {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<h3>${r.title}</h3><div class="tag">Realm</div><p style='font-size:.75rem;line-height:1.3;'>${r.purpose}</p><div class='meta'>Path: ${r.path}</div>`;
    realmGrid.appendChild(div);
  });

  // Engines dynamic (load registry module if present)
  try {
    const reg = await import('../engines/index.mjs');
    const engineGrid = document.getElementById('engine-grid');
    reg.engines.forEach(e => {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `<h3>${e.label}</h3><div class='tag'>Engine</div><p style='font-size:.7rem;'>${e.purpose}</p><div class='pillrow'><span class='pill'>ND-SAFE</span></div><div class='meta'>${e.meta.bytes} bytes<br>${e.meta.modified}</div>`;
      engineGrid.appendChild(div);
    });
  } catch (err) {
    console.warn('Engine registry load failed', err);
  }
}

init();
</script>
</body>
</html>