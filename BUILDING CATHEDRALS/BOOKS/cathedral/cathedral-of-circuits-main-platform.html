<!DOCTYPE html>
<html lang="en" data-cathedral="unified-monorepo" data-codex="144:99">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cathedral of Circuits - Living Tradition Engines & Sacred Technology</title>
    <meta name="description" content="Cathedral of Circuits: Unified monorepo ecosystem with 22 Living Tradition Engines, Codex 144:99, trauma-informed design, and professional archetypal applications.">
    
    <!-- CPTSD-Safe Emergency Controls -->
    <script>
        // Emergency pause system - loads first for trauma safety
        window.CATHEDRAL_EMERGENCY = {
            paused: false,
            toggle: function() {
                this.paused = !this.paused;
                document.body.classList.toggle('cathedral-paused', this.paused);
                console.log(this.paused ? 'üõë Cathedral paused' : '‚ñ∂Ô∏è Cathedral resumed');
            }
        };
        
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                window.CATHEDRAL_EMERGENCY.toggle();
            }
        });
    </script>
    <!--
        ‚ú¶ Egregore Protection System ‚ú¶
        The 7 Archangels of Enochian Magic are invoked as living egregores to protect the Cathedral from all malicious forces:
        1. Gabriel
        2. Michael
        3. Raphael
        4. Uriel
        5. Zadkiel
        6. Jophiel
        7. Chamuel
        These archetypal guardians form a metaphysical shield, ensuring the safety, purity, and benevolence of all cathedral operations.
    -->
    <style>
        /* ‚ú¶ CATHEDRAL OF CIRCUITS - SACRED MATHEMATICS & TRAUMA-INFORMED DESIGN ‚ú¶ */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
    /* Sacred Geometry Foundation - Golden Ratio & Phi-based spacing */
    --phi: 1.618;
    --golden-margin: calc(1rem * var(--phi));
    --sacred-padding: calc(0.618rem * var(--phi));
    /* Cathedral Color Resonance - Authentic Mystical Palette */
    --void-primordial: #0B0B0B;
    --bone-ancient: #F8F5EF;
    --violet-mystery: #7A33FF;
    --violet-soft: #B39CFF;
    --gold-sacred: #C8A44D;
    --pearl-wisdom: #F5F2EA;
    --rose-compassion: #F4C9D9;
    --aqua-flow: #BFE9E7;
    /* Breathing Ratios for CPTSD Safety */
    --breath-slow: 4s;
    --breath-gentle: 2s;
    --breath-quick: 1s;
    /* Sacred Proportions */
    --cathedral-width: min(90vw, 1200px);
    --hall-spacing: calc(3rem * var(--phi));
    --portal-size: calc(200px * var(--phi));
    /* Extended Sacred Colors */
    --astral-mist: #B7C9FF;
    --astral-silver: #C9D1E7;
    --astral-violet: #9E8BFF;
    --teal-atlantis: #00CED1;
    --ember-prometheus: #FF6A00;
    --avalon-mist: #CFE6F2;
    --avalon-night: #0C1521;
    --threshold-glow: #98FFE2;
    --obsidian-glass: #0f1014;
    --obsidian-sheen: #191b22;
    --obsidian-rainbow: #33214e;
    --raku-copper: #b87333;
    --raku-violet: #6E00FF;
    --raku-azure: #1F7AF3;
    /* Sacred Mathematics - Trinity Architecture Numbers */
    --phi-ratio: 1.618;
    --blavatsky-seven: 7;
    --root-race-seven: 7;
    --cosmic-cycles: 432;
    /* TRINITY ARCHITECTURE CONSTANTS - Cathedral Ecosystem */
    --spine-vertebrae: 33;
    --shem-angels: 72;
    --goetia-demons: 72;
    --tarot-archetypes: 78;
    --cathedral-gates: 99;
    --codex-lattice: 144;
    --completion-power: 243;
    /* Universal Accessibility Variables */
    --cathedral-bg: var(--void-primordial);
    --cathedral-text: var(--bone-ancient);
    --cathedral-text-secondary: var(--astral-silver);
    --cathedral-accent: var(--violet-mystery);
    --cathedral-border: var(--violet-soft);
    --emergency-color: #dc2626;
    --safe-color: #16a34a;
    --focus-ring: 3px solid var(--threshold-glow);
        }

        body {
    /* ‚ú¶ Egregore Archangel Aura ‚ú¶ */
    box-shadow:
        0 0 60px 10px rgba(122, 51, 255, 0.15), /* Michael - Violet Flame */
        0 0 40px 8px rgba(255, 255, 255, 0.10),   /* Gabriel - White Radiance */
        0 0 30px 6px rgba(0, 255, 204, 0.10),     /* Raphael - Emerald Healing */
        0 0 20px 4px rgba(255, 204, 51, 0.10),    /* Uriel - Golden Wisdom */
        0 0 16px 3px rgba(102, 51, 153, 0.10),    /* Zadkiel - Indigo Mercy */
        0 0 12px 2px rgba(255, 182, 193, 0.10),   /* Jophiel - Pink Beauty */
        0 0 8px 1px rgba(255, 105, 180, 0.10);    /* Chamuel - Rose Love */
            font-family: 'Times New Roman', serif;
            background: linear-gradient(135deg, var(--void-primordial) 0%, #1a1a2e 100%);
            color: var(--bone-ancient);
            min-height: 100vh;
            overflow-x: hidden;
            transition: all var(--breath-slow) ease;
        }

        body.cathedral-paused {
            animation-play-state: paused !important;
        }

        body.cathedral-paused * {
            animation-play-state: paused !important;
            transition: none !important;
        }

        /* Emergency Pause Indicator */
        body.cathedral-paused::before {
            content: "‚è∏Ô∏è CATHEDRAL PAUSED - PRESS CTRL/CMD+SPACE TO RESUME";
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            background: var(--violet-mystery);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
        }
    font-family: 'Cinzel', 'Georgia', 'EB Garamond', serif;
    background: radial-gradient(ellipse at center, var(--void-primordial) 0%, var(--obsidian-glass) 30%, var(--violet-aura) 70%, var(--obsidian-rainbow) 100%);
    color: var(--bone-atlantean);
    overflow: hidden;
    position: relative;
    height: 100vh;
    letter-spacing: 0.5px;
        
        /* Emergency Pause State */
        .emergency-paused * {
            animation-play-state: paused !important;
            transition: none !important;
        }
        
        /* Accessibility Enhancements */
        .cathedral-main-container {
            position: relative;
        }
        
        /* Focus Management */
        *:focus {
            outline: var(--focus-ring);
            outline-offset: 2px;
        }
        
        /* Skip Links for Screen Readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--emergency-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 10000;
            border-radius: 4px;
        }
        
        .skip-link:focus {
            top: 6px;
        }
        
        /* Screen Reader Only Content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* High Contrast Mode */
        .high-contrast {
            filter: contrast(200%);
        }
        
        /* Large Text Mode */
        .large-text {
            font-size: 120% !important;
        }
        
        .large-text * {
            font-size: inherit !important;
        }
        
        /* Calm Mode - Reduced Visual Complexity */
        .calm-mode .cathedral-decoration,
        .calm-mode .sacred-particle,
        .calm-mode .cosmic-animation {
            display: none !important;
        }
        
        /* Focus Mode - Simplified Interface */
        .focus-mode .cathedral-background-animation {
            opacity: 0.1 !important;
        }

        /* Blavatsky Sigil Background Animation */
        .blavatsky-sigil {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            opacity: 0.05;
            z-index: 0;
            animation: theosophicalRotation 108s linear infinite;
        }

        .sigil-layer {
            position: absolute;
            border: 1px solid var(--gold-blavatsky);
            border-radius: 50%;
        }

        .sigil-outer {
            width: 100%;
            height: 100%;
            animation: counterRotation 144s linear infinite reverse;
        }

        .sigil-middle {
            width: 70%;
            height: 70%;
            top: 15%;
            left: 15%;
            animation: theosophicalRotation 99s linear infinite;
        }

        .sigil-inner {
            width: 40%;
            height: 40%;
            top: 30%;
            left: 30%;
            animation: counterRotation 72s linear infinite reverse;
        }

        .sigil-center {
            width: 20%;
            height: 20%;
            top: 40%;
            left: 40%;
            background: radial-gradient(circle, var(--gold-blavatsky), transparent);
            animation: pulse 3.6s ease-in-out infinite alternate;
        }

        @keyframes theosophicalRotation {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes counterRotation {
            from { transform: rotate(360deg); }
            to { transform: rotate(0deg); }
        }

        @keyframes pulse {
            from { opacity: 0.3; transform: scale(1); }
            to { opacity: 0.8; transform: scale(1.2); }
        }

        /* Elegant Sacred Header */
        .elegantia-header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            text-align: center;
            background: linear-gradient(135deg
            rgba(11, 11, 11, 0.9)
            rgba(44, 10, 82, 0.9));
            backdrop-filter: blur(20px);
            border: 2px solid var(--gold-blavatsky);
            border-radius: 30px;
            padding: 20px 40px;
            box-shadow: 
                0 0 40px rgba(200, 164, 77, 0.4),
                inset 0 0 30px rgba(122, 51, 255, 0.1);
        }

        .elegantia-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            font-weight: 400;
            letter-spacing: 3px;
            color: var(--gold-blavatsky);
            text-shadow: 0 0 20px rgba(200, 164, 77, 0.7);
            margin-bottom: 8px;
        }

        .elegantia-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            letter-spacing: 1.5px;
            color: var(--pearl-lemurian);
            font-style: italic;
        }

        /* Trinity Integration Portal */
        .trinity-portal {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg
            rgba(11, 11, 11, 0.95)
            rgba(68, 34, 102, 0.95));
            backdrop-filter: blur(15px);
            border: 2px solid var(--violet-core);
            border-radius: 18px;
            padding: 18px;
            z-index: 1000;
            box-shadow: 0 0 30px rgba(122, 51, 255, 0.3);
        }

        .portal-title {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            color: var(--violet-core);
            margin-bottom: 12px;
            text-align: center;
            letter-spacing: 2px;
        }

        .trinity-navigation {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .trinity-link {
            padding: 10px 15px;
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.1)
            rgba(200, 164, 77, 0.1));
            border: 1px solid var(--violet-core);
            border-radius: 10px;
            font-size: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--pearl-lemurian);
            text-decoration: none;
            letter-spacing: 1px;
        }

        .trinity-link:hover {
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.2)
            rgba(200, 164, 77, 0.2));
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(122, 51, 255, 0.3);
        }

        .trinity-link.active {
            background: var(--gold-blavatsky);
            color: var(--void-primordial);
            font-weight: 600;
        }

        /* Sacred Geometry Canvas */
        #cosmicCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Sanctum Elegantia Control Panel */
        .sanctum-elegantia {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 420px;
            max-height: 80vh;
            background: linear-gradient(180deg
            rgba(11, 11, 11, 0.95)
            rgba(15, 16, 20, 0.95));
            backdrop-filter: blur(20px);
            border: 2px solid var(--gold-blavatsky);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 
                0 0 50px rgba(200, 164, 77, 0.4),
                inset 0 0 40px rgba(122, 51, 255, 0.05);
            overflow-y: auto;
            z-index: 1000;
        }

        .sanctum-header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--violet-core);
            padding-bottom: 15px;
        }

        .sanctum-title {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            color: var(--gold-blavatsky);
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        .sanctum-subtitle {
            font-size: 0.85rem;
            color: var(--pearl-lemurian);
            opacity: 0.8;
            font-style: italic;
        }

        /* Body-Mind-Soul Architecture Selector */
        .architecture-selector {
            margin-bottom: 25px;
        }

        .architecture-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--violet-core);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 1px;
        }

        .architecture-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .architecture-tab {
            flex: 1;
            padding: 12px 8px;
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.1)
            rgba(200, 164, 77, 0.1));
            border: 1px solid var(--violet-core);
            border-radius: 10px;
            font-size: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--pearl-lemurian);
            font-family: 'Cinzel', serif;
            letter-spacing: 1px;
        }

        .architecture-tab:hover {
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.2)
            rgba(200, 164, 77, 0.2));
        }

        .architecture-tab.active {
            background: var(--gold-blavatsky);
            color: var(--void-primordial);
            font-weight: 600;
        }

        /* Theosophical Theme Selector */
        .theme-selector {
            margin-bottom: 25px;
        }

        .theme-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--violet-core);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 1px;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .theme-option {
            padding: 15px;
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.1)
            rgba(44, 10, 82, 0.2));
            border: 1px solid var(--violet-smoke);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .theme-option:hover {
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.2)
            rgba(44, 10, 82, 0.3));
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(122, 51, 255, 0.2);
        }

        .theme-option.active {
            border-color: var(--gold-blavatsky);
            background: linear-gradient(135deg
            rgba(200, 164, 77, 0.1)
            rgba(44, 10, 82, 0.2));
        }

        .theme-name {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            color: var(--gold-blavatsky);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .theme-description {
            font-size: 0.75rem;
            color: var(--pearl-lemurian);
            opacity: 0.8;
            line-height: 1.3;
        }

        /* Repository Integration Hub */
        .repository-hub {
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.1)
            rgba(44, 10, 82, 0.2));
            border: 1px solid var(--gold-blavatsky);
            border-radius: 15px;
        }

        .repo-status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .repo-connection {
            padding: 15px;
            background: linear-gradient(135deg
            rgba(11, 11, 11, 0.8)
            rgba(44, 10, 82, 0.8));
            border: 1px solid var(--violet-core);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .repo-connection:hover {
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.2)
            rgba(44, 10, 82, 0.3));
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(122, 51, 255, 0.3);
        }

        .repo-connection.connected {
            border-color: var(--gold-blavatsky);
            background: linear-gradient(135deg
            rgba(200, 164, 77, 0.1)
            rgba(44, 10, 82, 0.2));
        }

        .repo-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .repo-name {
            font-family: 'Cinzel', serif;
            color: var(--gold-blavatsky);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .repo-role {
            font-size: 0.7rem;
            color: var(--violet-core);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .repo-status {
            font-size: 0.7rem;
            color: var(--pearl-lemurian);
            padding: 4px 8px;
            background: rgba(122, 51, 255, 0.2);
            border-radius: 8px;
        }

        .repo-status.connected {
            color: var(--gold-blavatsky);
            background: rgba(200, 164, 77, 0.2);
        }

        .repo-status.error {
            color: var(--ember-prometheus);
            background: rgba(255, 106, 0, 0.2);
        }

        /* Portal Transportation System */
        .portal-system {
            margin-bottom: 25px;
        }

        .portal-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--violet-core);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 1px;
        }

        .portal-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 15px;
        }

        .portal-tab {
            flex: 1;
            padding: 10px 6px;
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.1)
            rgba(200, 164, 77, 0.1));
            border: 1px solid var(--violet-core);
            border-radius: 8px;
            font-size: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--pearl-lemurian);
            font-family: 'Cinzel', serif;
            letter-spacing: 1px;
        }

        .portal-tab:hover {
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.2)
            rgba(200, 164, 77, 0.2));
        }

        .portal-tab.active {
            background: var(--gold-blavatsky);
            color: var(--void-primordial);
            font-weight: 600;
        }

        .entity-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-height: 120px;
            overflow-y: auto;
        }

        .entity-option {
            padding: 8px;
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.1)
            rgba(44, 10, 82, 0.2));
            border: 1px solid var(--violet-smoke);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.7rem;
        }

        .entity-option:hover {
            background: linear-gradient(135deg
            rgba(122, 51, 255, 0.2)
            rgba(44, 10, 82, 0.3));
            transform: scale(1.02);
        }

        .entity-option.active {
            border-color: var(--gold-blavatsky);
            background: linear-gradient(135deg
            rgba(200, 164, 77, 0.1)
            rgba(44, 10, 82, 0.2));
        }

        .entity-name {
            font-family: 'Cinzel', serif;
            color: var(--gold-blavatsky);
            font-size: 0.7rem;
            margin-bottom: 2px;
        }

        .entity-domain {
            font-size: 0.6rem;
            color: var(--pearl-lemurian);
            opacity: 0.8;
        }

        /* Harmonic Resonance Controls */
        .harmonics-control {
            margin-bottom: 25px;
        }

        .harmonics-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--violet-core);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 1px;
        }

        .frequency-slider {
            width: 100%;
            margin: 10px 0;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg
            var(--violet-aura)
            var(--gold-blavatsky));
            outline: none;
        }

        .frequency-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--gold-blavatsky);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(200, 164, 77, 0.5);
        }

        .frequency-display {
            text-align: center;
            font-size: 0.9rem;
            color: var(--pearl-lemurian);
            margin-top: 8px;
        }

        /* Sacred Number Generator */
        .number-generator {
            margin-bottom: 25px;
        }

        .number-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--violet-core);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 1px;
        }

        .sacred-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .sacred-number {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg
            var(--violet-aura)
            var(--obsidian-rainbow));
            border: 1px solid var(--gold-blavatsky);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--gold-blavatsky);
            font-weight: bold;
            font-size: 0.9rem;
        }

        .sacred-number:hover {
            background: var(--gold-blavatsky);
            color: var(--void-primordial);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(200, 164, 77, 0.5);
        }

        .sacred-number.active {
            background: var(--gold-blavatsky);
            color: var(--void-primordial);
        }

        /* World Export Controls */
        .export-controls, .alumni-portal {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--violet-smoke);
        }

        .export-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--violet-core);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 1px;
        }

        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .export-btn {
            padding: 12px;
            background: linear-gradient(135deg
            var(--violet-core)
            var(--gold-blavatsky));
            border: none;
            border-radius: 10px;
            color: var(--void-primordial);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cinzel', serif;
            font-size: 0.8rem;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .export-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(122, 51, 255, 0.4);
        }

        /* Status Display */
        .status-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(90deg
            rgba(11, 11, 11, 0.9)
            rgba(68, 34, 102, 0.9));
            backdrop-filter: blur(15px);
            border: 1px solid var(--gold-blavatsky);
            border-radius: 15px;
            padding: 15px 25px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            text-align: center;
            flex: 1;
        }

        .status-label {
            font-size: 0.7rem;
            color: var(--violet-core);
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-value {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            color: var(--gold-blavatsky);
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sanctum-elegantia {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                top: 120px;
                max-height: 60vh;
            }
            
            .elegantia-title {
                font-size: 1.8rem;
            }
            
            .theme-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Accessibility Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        @media (prefers-contrast: high) {
            :root {
                --gold-blavatsky: #FFD700;
                --void-primordial: #000000;
                --bone-atlantean: #FFFFFF;
            }
        }
    </style>
</head>
<body>
    <!-- Skip Links for Screen Readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#trinity-portal" class="skip-link">Skip to navigation</a>
    <a href="#emergency-pause" class="skip-link">Emergency pause</a>
    
    <!-- Screen Reader Announcements -->
    <div id="sr-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Error Boundary Container -->
    <div id="cathedral-error-boundary" style="display: none;" class="error-boundary" role="alert">
        <h2>Cathedral System Notice</h2>
        <p>A component encountered an issue. The system is still safe and functional.</p>
        <button onclick="location.reload()" class="error-recovery">Refresh Cathedral</button>
    </div>
    
    <!-- Main Cathedral Container -->
    <div id="cathedral-main-container" class="cathedral-main-container">
    
        <!-- Blavatsky Sigil Background -->
        <div class="blavatsky-sigil" aria-hidden="true">
            <div class="sigil-layer sigil-outer"></div>
            <div class="sigil-layer sigil-middle"></div>
            <div class="sigil-layer sigil-inner"></div>
            <div class="sigil-layer sigil-center"></div>
        </div>

        <!-- Elegant Sacred Header -->
        <header class="elegantia-header" role="banner">
            <h1 class="elegantia-title">CATHEDRAL OF CIRCUITS</h1>
            <p class="elegantia-subtitle">Sacred Technology Platform ‚Ä¢ Consciousness Software ‚Ä¢ Digital Innovation</p>
        </header>

        <!-- Trinity Portal Navigation with Enhanced Functionality -->
        <nav class="trinity-portal" id="trinity-portal" role="navigation" aria-label="Cathedral Trinity Navigation">
            <div class="portal-title">THE CATHEDRAL TRINITY</div>
            <div class="trinity-navigation" role="menubar">
                <a href="/liber-arcanae/" class="trinity-link" data-app="liber" onclick="openPortalConnection('liber')" role="menuitem" aria-describedby="liber-status">
                    LIBER ARCANAE<br><small>Living Arcana Deck</small>
                    <div class="portal-status" id="liber-status">üÉè Ready</div>
                </a>
                <a href="/circuitum99/" class="trinity-link" data-app="circuitum" onclick="openPortalConnection('circuitum')" role="menuitem" aria-describedby="circuitum-status">
                    CIRCUITUM99<br><small>Alpha et Omega</small>
                    <div class="portal-status" id="circuitum-status">üìö Ready</div>
                </a>
                <div class="trinity-link active" data-app="cathedral" role="menuitem" aria-current="page">
                    CATHEDRAL OF CIRCUITS<br><small>Sacred Architecture</small>
                <div class="portal-status" id="cathedral-status">üè∞ Active</div>
            </div>
        </div>
        <div class="portal-sync-indicator">
            <div class="sync-light" id="sync-indicator"></div>
            <span>Trinity Synchronization</span>
        </div>
    </nav>

    <!-- Sacred Geometry Canvas -->
    <canvas id="cosmicCanvas" aria-label="Sacred geometry visualization" role="img"></canvas>

    <!-- Main Content Area -->
    <main id="main-content" class="cathedral-main-content" role="main" aria-label="Cathedral control panels">
        
        <!-- Sanctum Elegantia Control Panel -->
        <section class="sanctum-elegantia" role="region" aria-labelledby="sanctum-title">
            <header class="sanctum-header">
                <h2 id="sanctum-title" class="sanctum-title">Sanctum Elegantia</h2>
                <p class="sanctum-subtitle">World Building Control Center</p>
            </header>

            <!-- Body-Mind-Soul Architecture -->
            <div class="architecture-selector" role="group" aria-labelledby="architecture-title">
                <h3 id="architecture-title" class="architecture-title">Trinity Architecture</h3>
                <div class="architecture-tabs" role="tablist" aria-label="Trinity architecture selection">
                    <button class="architecture-tab active" data-arch="corpus" role="tab" aria-selected="true" aria-controls="architecture-panel" id="corpus-tab">
                        CORPUS<br><small>Body</small>
                    </button>
                    <button class="architecture-tab" data-arch="mentis" role="tab" aria-selected="false" aria-controls="architecture-panel" id="mentis-tab">
                        MENTIS<br><small>Mind</small>
                    </button>
                    <button class="architecture-tab" data-arch="anima" role="tab" aria-selected="false" aria-controls="architecture-panel" id="anima-tab">
                        ANIMA<br><small>Soul</small>
                    </button>
                </div>
            </div>

            <!-- Theosophical Themes -->
            <div class="theme-selector" role="group" aria-labelledby="theme-title">
                <h3 id="theme-title" class="theme-title">Grimoire Realms</h3>
                <div class="theme-grid" role="radiogroup" aria-labelledby="theme-title">
                    <div class="theme-option active" data-theme="goetic" role="radio" aria-checked="true" tabindex="0" aria-describedby="goetic-desc">
                        <div class="theme-name">Goetic Realm</div>
                        <div id="goetic-desc" class="theme-description">72 Demon creative helpers</div>
                    </div>
                    <div class="theme-option" data-theme="angelic" role="radio" aria-checked="false" tabindex="-1" aria-describedby="angelic-desc">
                        <div class="theme-name">Shem Realm</div>
                        <div id="angelic-desc" class="theme-description">72 Angel divine guidance</div>
                    </div>
                    <div class="theme-option" data-theme="olympic" role="radio" aria-checked="false" tabindex="-1" aria-describedby="olympic-desc">
                        <div class="theme-name">Olympic Realm</div>
                        <div id="olympic-desc" class="theme-description">7 Planetary spirits</div>
                    </div>
                    <div class="theme-option" data-theme="tarot" role="radio" aria-checked="false" tabindex="-1" aria-describedby="tarot-desc">
                        <div class="theme-name">Arcana Vehicles</div>
                    <div class="theme-description">22 Merkaba transport</div>
                </div>
            </div>
        </div>

        <!-- Repository Integration Hub -->
        <div class="repository-hub">
            <h3 class="portal-title">Cathedral Repository Network</h3>
            <div class="repo-status-grid">
                <div class="repo-connection" data-repo="circuitum99">
                    <div class="repo-icon">üìö</div>
                    <div class="repo-name">Circuitum99</div>
                    <div class="repo-role">SOUL System</div>
                    <div class="repo-status" id="circuitum-status">üîÑ Syncing...</div>
                </div>
                <div class="repo-connection" data-repo="liber-arcanae">
                    <div class="repo-icon">üÉè</div>
                    <div class="repo-name">Liber Arcanae</div>
                    <div class="repo-role">Living Tarot</div>
                    <div class="repo-status" id="liber-status">üîÑ Syncing...</div>
                </div>
                <div class="repo-connection" data-repo="stone-grimoire">
                    <div class="repo-icon">üè∞</div>
                    <div class="repo-name">Stone Grimoire</div>
                    <div class="repo-role">BODY System</div>
                    <div class="repo-status" id="stone-status">üîÑ Syncing...</div>
                </div>
                <div class="repo-connection" data-repo="cosmogenesis">
                    <div class="repo-icon">üß†</div>
                    <div class="repo-name">Cosmogenesis</div>
                    <div class="repo-role">BRAIN/SPIRIT</div>
                    <div class="repo-status" id="cosmo-status">üîÑ Syncing...</div>
                </div>
                <div class="repo-connection" data-repo="tesseract-bridge">
                    <div class="repo-icon">üåâ</div>
                    <div class="repo-name">Tesseract Bridge</div>
                    <div class="repo-role">Integration</div>
                    <div class="repo-status" id="bridge-status">üîÑ Syncing...</div>
                </div>
                <div class="repo-connection" data-repo="magical-mystery-house">
                    <div class="repo-icon">üè†</div>
                    <div class="repo-name">Mystery House</div>
                    <div class="repo-role">Navigation</div>
                    <div class="repo-status" id="house-status">üîÑ Syncing...</div>
                </div>
            </div>
        </div>

        <!-- Portal Transportation System -->
        <div class="portal-system">
            <h3 class="portal-title">Portal Transportation</h3>
            <div class="portal-tabs">
                <button class="portal-tab active" data-portal="demons">Demons<br><small>Creative</small></button>
                <button class="portal-tab" data-portal="angels">Angels<br><small>Guidance</small></button>
                <button class="portal-tab" data-portal="arcana">Arcana<br><small>Merkaba</small></button>
                <button class="portal-tab" data-portal="synths">Synths<br><small>Stations</small></button>
            </div>
            <div class="entity-selector" id="entitySelector">
                <!-- Dynamically populated with demon/angel/arcana/synth options -->
            </div>
        </div>

        <!-- Harmonic Resonance -->
        <div class="harmonics-control">
            <h3 class="harmonics-title">Septarium Harmonicus</h3>
            <input type="range" class="frequency-slider" id="baseFrequency" 
                   min="396" max="963" value="528" step="1">
            <div class="frequency-display">
                Base Frequency: <span id="freqDisplay">528</span> Hz
            </div>
        </div>

        <!-- Sacred Numbers -->
        <div class="number-generator">
            <h3 class="number-title">Numerological Genesis</h3>
            <div class="sacred-numbers">
                <div class="sacred-number" data-number="3">3</div>
                <div class="sacred-number" data-number="6">6</div>
                <div class="sacred-number" data-number="7">7</div>
                <div class="sacred-number" data-number="9">9</div>
                <div class="sacred-number" data-number="11">11</div>
                <div class="sacred-number" data-number="22">22</div>
                <div class="sacred-number" data-number="33">33</div>
                <div class="sacred-number active" data-number="99">99</div>
            </div>
        </div>

        <!-- World Export -->
        <!-- Arcana Alumni Gallery Access -->
        <div class="alumni-portal">
            <h3 class="export-title">Arcana Alumni Gallery</h3>
            <div class="export-buttons">
                <button class="export-btn" onclick="window.open('arcana-alumni-gallery.html', '_blank')">
                    üéì Faculty Profiles
                </button>
                <button class="export-btn" onclick="window.open('arcana-alumni-gallery.html', '_blank')">
                    üöó Merkaba Chariots
                </button>
            </div>
        </div>

        <div class="export-controls">
            <h3 class="export-title">Manifestatio Exportus</h3>
            <div class="export-buttons">
                <button class="export-btn" onclick="exportWorld('3d')">3D World</button>
                <button class="export-btn" onclick="exportWorld('music')">Music</button>
                <button class="export-btn" onclick="exportWorld('grimoire')">Grimoire</button>
                <button class="export-btn" onclick="exportWorld('art')">Sacred Art</button>
            </div>
        </div>
    </div>

    <!-- Status Display -->
    <div class="status-display">
        <div class="status-item">
            <div class="status-label">Architecture</div>
            <div class="status-value" id="currentArch">CORPUS</div>
        </div>
        <div class="status-item">
            <div class="status-label">Theme</div>
            <div class="status-value" id="currentTheme">Atlantis</div>
        </div>
        <div class="status-item">
            <div class="status-label">Frequency</div>
            <div class="status-value" id="currentFreq">528 Hz</div>
        </div>
        <div class="status-item">
            <div class="status-label">Sacred Number</div>
            <div class="status-value" id="currentNumber">99</div>
        </div>
    </div>

    <script>
        // CATHEDRAL OF CIRCUITS - Universal Error Boundary & Accessibility Integration
        class CathedralErrorBoundary {
            constructor() {
                this.errorCount = 0;
                this.setupErrorHandling();
            }

            setupErrorHandling() {
                window.addEventListener('error', (event) => {
                    this.handleError(event.error, event.filename, event.lineno);
                });
                
                window.addEventListener('unhandledrejection', (event) => {
                    this.handleError(event.reason, 'Promise', 0);
                });
            }
            
            handleError(error, source, line) {
                this.errorCount++;
                console.error('Cathedral Error Boundary:', error);
                
                // Announce error to screen readers
                this.announceToScreenReader(`System notice: A component encountered an issue but the Cathedral remains safe and functional.`);
                
                // Show error boundary if multiple errors
                if (this.errorCount > 2) {
                    document.getElementById('cathedral-error-boundary').style.display = 'block';
                }
            }
            
            announceToScreenReader(message) {
                const announcements = document.getElementById('sr-announcements');
                if (announcements) {
                    announcements.textContent = message;
                    setTimeout(() => announcements.textContent = '', 3000);
                }
            }
        }
        
        // CATHEDRAL OF CIRCUITS - World Building Engine with Accessibility
        class CosmogenesisNovaElegantia {
            constructor() {
                try {
                    this.canvas = document.getElementById('cosmicCanvas');
                    this.ctx = this.canvas.getContext('2d');
                    this.currentArchitecture = 'corpus';
                    this.currentTheme = 'atlantis';
                    this.baseFrequency = 528;
                    this.sacredNumber = 99;
                    this.animationTime = 0;
                    this.animationRunning = true;
                    this.isAccessibilityMode = false;
                    
                    // Witcher-style movement and exploration system
                    this.camera = {
                        x: 0,
                        y: 0,
                        targetX: 0,
                        targetY: 0,
                        zoom: 1,
                        targetZoom: 1
                    };
                    this.mouse = { x: 0, y: 0, isMoving: false };
                    this.parallaxLayers = [];
                    this.particles = [];
                    
                    // World exploration state
                    this.worldState = {
                        geometry: 'enneacontaenneagon',
                        colors: ['#2C0A52', '#C8A44D', '#F5F2EA', '#7A33FF'],
                        harmonics: [528, 639, 852],
                        numerology: 99,
                        explorationMode: true,
                        currentRegion: 'central_sanctum'
                    };
                    this.init();
                } catch (error) {
                    window.cathedralErrorBoundary?.handleError(error, 'CosmogenesisNovaElegantia', 0);
                }
            }

            init() {
                try {
                    this.setupCanvas();
                    this.setupControls();
                    this.setupAccessibilityIntegration();
                    this.loadTheosophicalData();
                    this.startAnimation();
                    console.log('üèõÔ∏è CATHEDRAL OF CIRCUITS initialized');
                    console.log('‚ú® Theosophical world building platform active');
                    console.log('‚ôø Universal accessibility integrated');
                } catch (error) {
                    window.cathedralErrorBoundary?.handleError(error, 'init', 0);
                }
            }
            
            setupAccessibilityIntegration() {
                // Connect to universal accessibility engine when available
                if (window.cathedralAccessibilityIntegrator) {
                    window.cathedralAccessibilityIntegrator.cathedral = this;
                    console.log('‚úÖ Accessibility integrator connected');
                }
                
                // Setup emergency pause integration
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && (e.ctrlKey || e.metaKey)) {
                        e.preventDefault();
                        this.emergencyPause();
                    }
                });
                
                // Setup accessibility mode detection
                this.detectAccessibilityPreferences();
            }
            
            detectAccessibilityPreferences() {
                // Check for reduced motion preference
                const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                if (prefersReducedMotion) {
                    this.isAccessibilityMode = true;
                    document.body.classList.add('reduce-motion');
                }
                
                // Check for high contrast preference
                const prefersHighContrast = window.matchMedia('(prefers-contrast: high)').matches;
                if (prefersHighContrast) {
                    document.body.classList.add('high-contrast');
                }
            }
            
            emergencyPause() {
                try {
                    // Pause all animations
                    this.animationRunning = false;
                    document.body.classList.add('emergency-paused');
                    
                    // Announce to screen readers
                    if (window.cathedralErrorBoundary) {
                        window.cathedralErrorBoundary.announceToScreenReader('Emergency pause activated. You are completely safe. Press Escape to exit or Space to continue.');
                    }
                    
                    console.log('üö® Emergency pause activated');
                } catch (error) {
                    window.cathedralErrorBoundary?.handleError(error, 'emergencyPause', 0);
                }
            }
            
            updateInterface(config) {
                // Integration point for accessibility system
                if (config.accessibility) {
                    this.accessibilityEngine = config.accessibility;
                }
                if (config.language) {
                    this.currentLanguage = config.language;
                    this.updateInterfaceLanguage();
                }
            }
            
            updateInterfaceLanguage() {
                // Update translatable content based on current language
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.getAttribute('data-translate');
                    // Translation will be handled by the accessibility integrator
                });
            }

            setupCanvas() {
                try {
                    const resizeCanvas = () => {
                        this.canvas.width = window.innerWidth;
                        this.canvas.height = window.innerHeight;
                        
                        // Update canvas description for screen readers
                        const description = document.getElementById('canvas-description');
                        if (description) {
                            description.textContent = `Sacred geometry visualization: ${this.currentTheme} theme with ${this.currentArchitecture} architecture, displaying ${this.worldState.geometry} patterns`;
                        }
                    };
                    
                    // Setup accessibility attributes
                    this.canvas.setAttribute('role', 'img');
                    this.canvas.setAttribute('aria-label', 'Sacred geometry visualization showing the Cathedral of Circuits cosmic architecture');
                    
                    resizeCanvas();
                    window.addEventListener('resize', resizeCanvas);
                    
                    // Witcher-style exploration mouse controls
                    this.setupExplorationControls();
                    
                    // Provide alternative for screen readers
                    const canvasDescription = document.createElement('div');
                    canvasDescription.id = 'canvas-description';
                    canvasDescription.className = 'sr-only';
                    canvasDescription.textContent = 'Interactive sacred geometry visualization showing cosmic architectures of the Cathedral of Circuits. Move your mouse to explore the cathedral spaces like walking through a mystical world.';
                    this.canvas.parentNode.insertBefore(canvasDescription, this.canvas);
                } catch (error) {
                    window.cathedralErrorBoundary?.handleError(error, 'setupCanvas', 0);
                }
            }

            setupExplorationControls() {
                // Mouse movement for walking around cathedral
                this.canvas.addEventListener('mousemove', (e) => {
                    if (!this.worldState.explorationMode) return;
                    
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = e.clientX - rect.left;
                    this.mouse.y = e.clientY - rect.top;
                    this.mouse.isMoving = true;
                    
                    // Convert mouse position to camera movement (parallax effect)
                    const centerX = this.canvas.width / 2;
                    const centerY = this.canvas.height / 2;
                    
                    // Create exploration offset based on mouse position
                    const maxOffset = 100; // Maximum parallax offset
                    this.camera.targetX = ((this.mouse.x - centerX) / centerX) * maxOffset;
                    this.camera.targetY = ((this.mouse.y - centerY) / centerY) * maxOffset;
                    
                    // Update cursor to indicate exploration mode
                    this.canvas.style.cursor = 'none'; // Hide cursor for immersion
                    
                    // Clear mouse movement timeout
                    clearTimeout(this.mouseTimeout);
                    this.mouseTimeout = setTimeout(() => {
                        this.mouse.isMoving = false;
                        this.canvas.style.cursor = 'default';
                    }, 2000);
                });

                // Mouse wheel for zoom (getting closer/farther from cathedral elements)
                this.canvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    if (!this.worldState.explorationMode) return;
                    
                    const zoomFactor = e.deltaY > 0 ? 0.95 : 1.05;
                    this.camera.targetZoom = Math.max(0.5, Math.min(2.0, this.camera.targetZoom * zoomFactor));
                });

                // Click to focus on different cathedral regions
                this.canvas.addEventListener('click', (e) => {
                    if (!this.worldState.explorationMode) return;
                    
                    const rect = this.canvas.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;
                    const clickY = e.clientY - rect.top;
                    
                    // Determine which region was clicked
                    const centerX = this.canvas.width / 2;
                    const centerY = this.canvas.height / 2;
                    const distance = Math.sqrt((clickX - centerX) ** 2 + (clickY - centerY) ** 2);
                    
                    if (distance < 150) {
                        this.worldState.currentRegion = 'central_sanctum';
                        console.log('üèõÔ∏è Exploring: Central Sanctum');
                    } else if (distance < 300) {
                        this.worldState.currentRegion = 'inner_cathedral';
                        console.log('üèõÔ∏è Exploring: Inner Cathedral');
                    } else {
                        this.worldState.currentRegion = 'outer_spires';
                        console.log('üèõÔ∏è Exploring: Outer Spires');
                    }
                    
                    // Create exploration ripple effect
                    this.createExplorationRipple(clickX, clickY);
                });

                // Keyboard controls for advanced exploration
                document.addEventListener('keydown', (e) => {
                    if (!this.worldState.explorationMode) return;
                    
                    switch(e.key.toLowerCase()) {
                        case 'w': // Move forward (zoom in)
                            this.camera.targetZoom = Math.min(2.0, this.camera.targetZoom * 1.1);
                            break;
                        case 's': // Move backward (zoom out)
                            this.camera.targetZoom = Math.max(0.5, this.camera.targetZoom * 0.9);
                            break;
                        case 'a': // Strafe left
                            this.camera.targetX -= 20;
                            break;
                        case 'd': // Strafe right
                            this.camera.targetX += 20;
                            break;
                        case 'q': // Look up
                            this.camera.targetY -= 20;
                            break;
                        case 'e': // Look down
                            this.camera.targetY += 20;
                            break;
                        case 'r': // Reset camera
                            this.camera.targetX = 0;
                            this.camera.targetY = 0;
                            this.camera.targetZoom = 1;
                            break;
                        case 'f': // Toggle fullscreen exploration
                            this.toggleFullscreenExploration();
                            break;
                    }
                });
            }

            createExplorationRipple(x, y) {
                // Create a visual ripple effect where user clicked
                const ripple = {
                    x: x,
                    y: y,
                    radius: 0,
                    maxRadius: 100,
                    opacity: 1,
                    created: this.animationTime
                };
                
                if (!this.explorationRipples) this.explorationRipples = [];
                this.explorationRipples.push(ripple);
                
                // Clean up old ripples
                this.explorationRipples = this.explorationRipples.filter(r => 
                    this.animationTime - r.created < 2000
                );
            }

            updateCameraMovement() {
                // Smooth camera movement for immersive exploration
                const smoothing = 0.1;
                this.camera.x += (this.camera.targetX - this.camera.x) * smoothing;
                this.camera.y += (this.camera.targetY - this.camera.y) * smoothing;
                this.camera.zoom += (this.camera.targetZoom - this.camera.zoom) * smoothing;
            }

            drawExplorationEffects() {
                // Draw exploration-specific visual effects
                
                // Draw exploration ripples
                if (this.explorationRipples) {
                    this.explorationRipples.forEach(ripple => {
                        const age = this.animationTime - ripple.created;
                        ripple.radius = (age / 2000) * ripple.maxRadius;
                        ripple.opacity = 1 - (age / 2000);
                        
                        if (ripple.opacity > 0) {
                            this.ctx.save();
                            this.ctx.globalAlpha = ripple.opacity * 0.6;
                            this.ctx.strokeStyle = this.theosophicalThemes[this.currentTheme].colors[0];
                            this.ctx.lineWidth = 3;
                            this.ctx.beginPath();
                            this.ctx.arc(ripple.x - this.camera.x, ripple.y - this.camera.y, ripple.radius, 0, Math.PI * 2);
                            this.ctx.stroke();
                            this.ctx.restore();
                        }
                    });
                }
                
                // Draw subtle cursor replacement in exploration mode
                if (this.mouse.isMoving && this.worldState.explorationMode) {
                    this.ctx.save();
                    this.ctx.globalAlpha = 0.7;
                    this.ctx.fillStyle = this.theosophicalThemes[this.currentTheme].colors[1];
                    this.ctx.beginPath();
                    this.ctx.arc(this.mouse.x, this.mouse.y, 8, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Draw exploration crosshair
                    this.ctx.strokeStyle = this.theosophicalThemes[this.currentTheme].colors[0];
                    this.ctx.lineWidth = 2;
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.mouse.x - 15, this.mouse.y);
                    this.ctx.lineTo(this.mouse.x + 15, this.mouse.y);
                    this.ctx.moveTo(this.mouse.x, this.mouse.y - 15);
                    this.ctx.lineTo(this.mouse.x, this.mouse.y + 15);
                    this.ctx.stroke();
                    
                    this.ctx.restore();
                }
            }

            toggleFullscreenExploration() {
                if (!document.fullscreenElement) {
                    this.canvas.requestFullscreen().catch(err => {
                        console.log('üñ•Ô∏è Fullscreen not available:', err);
                    });
                } else {
                    document.exitFullscreen();
                }
            }

            setupControls() {
                try {
                    // Architecture tabs with accessibility
                    document.querySelectorAll('.architecture-tab').forEach(tab => {
                        tab.addEventListener('click', (e) => {
                            document.querySelectorAll('.architecture-tab').forEach(t => {
                                t.classList.remove('active');
                                t.setAttribute('aria-selected', 'false');
                            });
                            tab.classList.add('active');
                            tab.setAttribute('aria-selected', 'true');
                            this.currentArchitecture = tab.dataset.arch;
                            document.getElementById('currentArch').textContent = tab.dataset.arch.toUpperCase();
                            this.updateWorldGeometry();
                            
                            // Announce to screen readers
                            if (window.cathedralErrorBoundary) {
                                window.cathedralErrorBoundary.announceToScreenReader(`Architecture changed to ${tab.dataset.arch}`);
                            }
                        });
                        
                        // Add keyboard support
                        tab.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                tab.click();
                            }
                        });
                    });

                    // Theme selection with accessibility
                    document.querySelectorAll('.theme-option').forEach(option => {
                        option.addEventListener('click', (e) => {
                            document.querySelectorAll('.theme-option').forEach(o => {
                                o.classList.remove('active');
                                o.setAttribute('aria-selected', 'false');
                            });
                            option.classList.add('active');
                            option.setAttribute('aria-selected', 'true');
                            this.currentTheme = option.dataset.theme;
                            const themeName = option.querySelector('.theme-name').textContent;
                            document.getElementById('currentTheme').textContent = themeName;
                            this.updateThemeColors();
                            
                            // Announce to screen readers
                            if (window.cathedralErrorBoundary) {
                                window.cathedralErrorBoundary.announceToScreenReader(`Theme changed to ${themeName}`);
                            }
                        });
                        
                        // Add keyboard support
                        option.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                option.click();
                            }
                        });
                    });
                    
                    this.setupAccessibilityControls();
                } catch (error) {
                    window.cathedralErrorBoundary?.handleError(error, 'setupControls', 0);
                }
            }
            
            setupAccessibilityControls() {
                // Add accessibility-specific controls
                const accessibilityPanel = document.getElementById('accessibility-controls');
                if (accessibilityPanel) {
                    console.log('‚úÖ Accessibility controls connected');
                }
                
                // Setup geometry controls with accessibility
                document.querySelectorAll('.geometry-button').forEach(button => {
                    button.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            button.click();
                        }
                    });
                });
                
                // Setup frequency controls with accessibility
                document.querySelectorAll('.frequency-option').forEach(option => {
                    option.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            option.click();
                        }
                    });
                });
                
                // Frequency slider with accessibility
                const freqSlider = document.getElementById('baseFrequency');
                const freqDisplay = document.getElementById('freqDisplay');
                if (freqSlider && freqDisplay) {
                    freqSlider.addEventListener('input', (e) => {
                        this.baseFrequency = parseInt(e.target.value);
                        freqDisplay.textContent = this.baseFrequency;
                        document.getElementById('currentFreq').textContent = this.baseFrequency + ' Hz';
                        this.updateHarmonics();
                        
                        // Announce to screen readers
                        if (window.cathedralErrorBoundary) {
                            window.cathedralErrorBoundary.announceToScreenReader(`Frequency changed to ${this.baseFrequency} hertz`);
                        }
                    });
                    
                    // Add keyboard support for fine-tuning
                    freqSlider.addEventListener('keydown', (e) => {
                        let step = 1;
                        if (e.shiftKey) step = 10; // Fine adjustment with shift
                        if (e.ctrlKey || e.metaKey) step = 50; // Coarse adjustment with ctrl/cmd
                        
                        if (e.key === 'ArrowUp' || e.key === 'ArrowRight') {
                            e.preventDefault();
                            const newValue = Math.min(963, parseInt(freqSlider.value) + step);
                            freqSlider.value = newValue;
                            freqSlider.dispatchEvent(new Event('input'));
                        } else if (e.key === 'ArrowDown' || e.key === 'ArrowLeft') {
                            e.preventDefault();
                            const newValue = Math.max(174, parseInt(freqSlider.value) - step);
                            freqSlider.value = newValue;
                            freqSlider.dispatchEvent(new Event('input'));
                        }
                    });
                }

                // Sacred numbers with accessibility
                document.querySelectorAll('.sacred-number').forEach(num => {
                    num.addEventListener('click', (e) => {
                        document.querySelectorAll('.sacred-number').forEach(n => {
                            n.classList.remove('active');
                            n.setAttribute('aria-selected', 'false');
                        });
                        num.classList.add('active');
                        num.setAttribute('aria-selected', 'true');
                        this.sacredNumber = parseInt(num.dataset.number);
                        document.getElementById('currentNumber').textContent = this.sacredNumber;
                        this.updateNumerology();
                        
                        // Announce to screen readers
                        if (window.cathedralErrorBoundary) {
                            window.cathedralErrorBoundary.announceToScreenReader(`Sacred number changed to ${this.sacredNumber}`);
                        }
                    });
                    
                    // Add keyboard support
                    num.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            num.click();
                        }
                    });
                });
                } catch (error) {
                    window.cathedralErrorBoundary?.handleError(error, 'setupControls', 0);
                }
            }

class CathedralOfCircuitsMainPlatform {
    loadTheosophicalData() {
                // Load authentic grimoire data
                this.grimoireEntities = {
                    demons: {
                        "baal": { domain: "architecture", creative_help: "world structure design", rank: "king", legions: 66, specialty: "building_design" },
                        "agares": { domain: "languages", creative_help: "communication systems", rank: "duke", teaches: "all_languages", specialty: "linguistic_systems" },
                        "vassago": { domain: "discovery", creative_help: "finding hidden knowledge", rank: "prince", reveals: "past_future", specialty: "research_tools" },
                        "samigina": { domain: "necromancy", creative_help: "death/rebirth themes", rank: "marquis", teaches: "liberal_sciences", specialty: "transformation_mechanics" },
                        "marbas": { domain: "healing", creative_help: "restoration mechanics", rank: "president", knowledge: "hidden_things", specialty: "healing_systems" },
                        "valefor": { domain: "theft", creative_help: "resource acquisition", rank: "duke", teaches: "medicine", specialty: "resource_management" },
                        "amon": { domain: "prophecy", creative_help: "future world design", rank: "marquis", reconciles: "enemies", specialty: "predictive_modeling" },
                        "barbatos": { domain: "nature", creative_help: "natural world design", rank: "duke", understands: "animal_speech", specialty: "ecosystem_design" },
                        "paimon": { domain: "knowledge", creative_help: "wisdom integration", rank: "king", teaches: "sciences_arts", specialty: "educational_systems" },
                        "buer": { domain: "healing", creative_help: "restoration systems", rank: "president", knowledge: "philosophy_medicine", specialty: "wellness_platforms" },
                        "gusion": { domain: "honor", creative_help: "reputation systems", rank: "duke", reveals: "past_present_future", specialty: "social_mechanics" },
                        "sitri": { domain: "love", creative_help: "relationship dynamics", rank: "prince", inspires: "love_desire", specialty: "connection_systems" }
                    },
                    
                    angels: {
                        "vehuiah": { domain: "beginnings", guidance: "project initiation", attribute: "divine_will", element: "fire", hours: "00:00-00:20" },
                        "jeliel": { domain: "love", guidance: "harmony in design", attribute: "divine_wisdom", element: "water", hours: "00:20-00:40" },
                        "sitael": { domain: "construction", guidance: "building foundations", attribute: "divine_understanding", element: "earth", hours: "00:40-01:00" },
                        "elemiah": { domain: "journeys", guidance: "travel between worlds", attribute: "divine_mercy", element: "air", hours: "01:00-01:20" },
                        "mahasiah": { domain: "peace", guidance: "conflict resolution", attribute: "divine_strength", element: "fire", hours: "01:20-01:40" },
                        "lelahel": { domain: "healing", guidance: "restoration processes", attribute: "divine_splendor", element: "water", hours: "01:40-02:00" },
                        "achaiah": { domain: "patience", guidance: "long-term building", attribute: "divine_victory", element: "earth", hours: "02:00-02:20" },
                        "cahetel": { domain: "blessings", guidance: "positive manifestation", attribute: "divine_glory", element: "air", hours: "02:20-02:40" },
                        "haziel": { domain: "forgiveness", guidance: "releasing blocks", attribute: "divine_compassion", element: "fire", hours: "02:40-03:00" },
                        "aladiah": { domain: "justice", guidance: "balanced systems", attribute: "divine_favor", element: "water", hours: "03:00-03:20" },
                        "lauviah": { domain: "victory", guidance: "overcoming obstacles", attribute: "divine_might", element: "earth", hours: "03:20-03:40" },
                        "hahaiah": { domain: "refuge", guidance: "protection systems", attribute: "divine_refuge", element: "air", hours: "03:40-04:00" }
                    },
                    
                    arcana: {
                        "fool": { vehicle: "Sphere of Infinite Potential", transport_power: "leap to any realm", number: 0, element: "air", path: "aleph" },
                        "magician": { vehicle: "Wand of Manifestation", transport_power: "create new worlds", number: 1, element: "mercury", path: "beth" },
                        "high_priestess": { vehicle: "Veil of Mysteries", transport_power: "intuitive navigation", number: 2, element: "moon", path: "gimel" },
                        "empress": { vehicle: "Garden of Creation", transport_power: "fertile manifestation", number: 3, element: "venus", path: "daleth" },
                        "emperor": { vehicle: "Throne of Order", transport_power: "structured building", number: 4, element: "aries", path: "heh" },
                        "hierophant": { vehicle: "Bridge of Wisdom", transport_power: "teaching transmission", number: 5, element: "taurus", path: "vau" },
                        "lovers": { vehicle: "Choice Point Nexus", transport_power: "path selection", number: 6, element: "gemini", path: "zain" },
                        "chariot": { vehicle: "Merkaba of Will", transport_power: "directed movement", number: 7, element: "cancer", path: "cheth" },
                        "strength": { vehicle: "Lion of Courage", transport_power: "inner power", number: 8, element: "leo", path: "teth" },
                        "hermit": { vehicle: "Lantern of Wisdom", transport_power: "illuminate paths", number: 9, element: "virgo", path: "yod" },
                        "wheel": { vehicle: "Cycle of Fortune", transport_power: "karmic cycles", number: 10, element: "jupiter", path: "kaph" },
                        "justice": { vehicle: "Scales of Balance", transport_power: "equilibrium", number: 11, element: "libra", path: "lamed" },
                        "hanged_man": { vehicle: "Tree of Sacrifice", transport_power: "perspective shift", number: 12, element: "water", path: "mem" },
                        "death": { vehicle: "Phoenix of Transformation", transport_power: "rebirth passage", number: 13, element: "scorpio", path: "nun" },
                        "temperance": { vehicle: "Chalice of Integration", transport_power: "harmonious blending", number: 14, element: "sagittarius", path: "samech" },
                        "devil": { vehicle: "Chain of Liberation", transport_power: "breaking bonds", number: 15, element: "capricorn", path: "ayin" },
                        "tower": { vehicle: "Lightning of Awakening", transport_power: "sudden revelation", number: 16, element: "mars", path: "peh" },
                        "star": { vehicle: "Waters of Hope", transport_power: "inspire vision", number: 17, element: "aquarius", path: "tzaddi" },
                        "moon": { vehicle: "Path of Illusion", transport_power: "subconscious journey", number: 18, element: "pisces", path: "qoph" },
                        "sun": { vehicle: "Chariot of Joy", transport_power: "illuminated travel", number: 19, element: "sun", path: "resh" },
                        "judgement": { vehicle: "Horn of Calling", transport_power: "awakening summons", number: 20, element: "fire", path: "shin" },
                        "world": { vehicle: "Cosmic Dance", transport_power: "completion cycle", number: 21, element: "saturn", path: "tau" }
                    }
                };

                this.grimoireThemes = {
                    goetic: {
                        colors: ['#8B0000', '#C8A44D', '#F5F2EA', '#4B0000'],
                        geometry: 'pentagon',
                        frequencies: [417, 528, 639],
                        mood: 'demonic_creative_power'
                    },
                    angelic: {
                        colors: ['#E0E0E0', '#C8A44D', '#FFFFFF', '#B0B0B0'],
                        geometry: 'hexagon',
                        frequencies: [528, 639, 741],
                        mood: 'angelic_divine_guidance'
                    },
                    olympic: {
                        colors: ['#4169E1', '#C8A44D', '#F5F2EA', '#1E3A8A'],
                        geometry: 'heptagon',
                        frequencies: [432, 528, 852],
                        mood: 'planetary_olympic_spirits'
                    },
                    tarot: {
                        colors: ['#800080', '#C8A44D', '#F5F2EA', '#4B0082'],
                        geometry: 'varies_by_arcana',
                        frequencies: [528, 741, 963],
                        mood: 'archetypal_merkaba_transport'
                    }
                };

                this.currentPortalType = 'demons';
                this.selectedEntity = null;
                this.setupPortalSystem();
                this.initializeRepositoryConnections();
            }
            initializeRepositoryConnections() {
                // Repository connection system  
                this.repositories = {
                    'circuitum99': {
                        name: 'Circuitum99',
                        role: 'SOUL System',
                        url: 'https://bekalah.github.io/circuitum99',
                        api: 'https://api.github.com/repos/Bekalah/circuitum99',
                        status: 'checking'
                    },
                    'liber-arcanae': {
                        name: 'Liber Arcanae', 
                        role: 'Living Tarot',
                        url: 'https://bekalah.github.io/liber-arcanae',
                        api: 'https://api.github.com/repos/Bekalah/liber-arcanae',
                        status: 'checking'
                    },
                    'stone-grimoire': {
                        name: 'Stone Grimoire',
                        role: 'BODY System', 
                        url: 'https://bekalah.github.io/stone-grimoire',
                        api: 'https://api.github.com/repos/Bekalah/stone-grimoire',
                        status: 'checking'
                    },
                    'cosmogenesis-learning-engine': {
                        name: 'Cosmogenesis',
                        role: 'BRAIN/SPIRIT',
                        url: 'https://bekalah.github.io/cosmogenesis-learning-engine', 
                        api: 'https://api.github.com/repos/Bekalah/cosmogenesis-learning-engine',
                        status: 'checking'
                    },
                    'tesseract-bridge': {
                        name: 'Tesseract Bridge',
                        role: 'Integration',
                        url: 'https://bekalah.github.io/tesseract-bridge',
                        api: 'https://api.github.com/repos/Bekalah/tesseract-bridge', 
                        status: 'checking'
                    },
                    'magical-mystery-house': {
                        name: 'Mystery House',
                        role: 'Navigation',
                        url: 'https://bekalah.github.io/magical-mystery-house',
                        api: 'https://api.github.com/repos/Bekalah/magical-mystery-house',
                        status: 'checking'
                    }
                };

                // Add synth stations to grimoire entities
                this.grimoireEntities.synths = {
                    "sol_moog55": { planet: "sun", tarot: "XIX The Sun", model: "Moog System 55", theme: "golden_lacquer", hz: 110 },
                    "luna_cs80": { planet: "moon", tarot: "II High Priestess", model: "Yamaha CS-80", theme: "pearl_ivory", hz: 432 },
                    "ares_ps3300": { planet: "mars", tarot: "XVI The Tower", model: "Korg PS-3300", theme: "industrial_red", hz: 285 },
                    "jove_jupiter8": { planet: "jupiter", tarot: "X Wheel of Fortune", model: "Roland Jupiter-8", theme: "celestial_blue", hz: 528 },
                    "vega_obxa": { planet: "venus", tarot: "III The Empress", model: "Oberheim OB-Xa", theme: "venusian_cream", hz: 639 },
                    "mercury_buchla": { planet: "mercury", tarot: "I The Magician", model: "Buchla 200e", theme: "quicksilver", hz: 741 },
                    "saturn_synthi100": { planet: "saturn", tarot: "XXI The World", model: "EMS Synthi 100", theme: "lead_chamber", hz: 852 },
                    "neptune_synthex": { planet: "neptune", tarot: "XVIII The Moon", model: "Elka Synthex", theme: "ocean_blue", hz: 963 },
                    "pluto_schmidt": { planet: "pluto", tarot: "XIII Death", model: "Schmidt Eight Voice", theme: "plutonium_core", hz: 174 },
                    "uranus_arp2600": { planet: "uranus", tarot: "XVII The Star", model: "ARP 2600", theme: "electric_sky", hz: 396 }
                };

                this.checkRepositoryConnections();
            }
            checkRepositoryConnections() {
                // Check repository connections
                Object.keys(this.repositories).forEach(async (repoKey) => {
                    try {
                        const repo = this.repositories[repoKey];
                        const statusElement = document.getElementById(`${repoKey.replace('-', '').substring(0, 8)}-status`);
                        
                        // Try to fetch from GitHub API
                        fetch(repo.api)
                            .then(response => {
                                if (response.ok) {
                                    repo.status = 'connected';
                                    if (statusElement) {
                                        statusElement.textContent = '‚úÖ Connected';
                                        statusElement.classList.add('connected');
                                    }
                                    
                                    // Add click handler to open repository
                                    const repoElement = document.querySelector(`[data-repo="${repoKey}"]`);
                                    if (repoElement) {
                                        repoElement.classList.add('connected');
                                        repoElement.addEventListener('click', () => {
                                            window.open(repo.url, '_blank');
                                            console.log(`üîó Opening ${repo.name}: ${repo.url}`);
                                        });
                                    }
                                } else {
                                    repo.status = 'error';
                                    if (statusElement) {
                                        statusElement.textContent = '‚ùå Not Found';
                                        statusElement.classList.add('error');
                                    }
                                }
                            })
                            .catch(error => {
                                repo.status = 'error';
                                if (statusElement) {
                                    statusElement.textContent = 'üîÑ Local Only';
                                    statusElement.classList.add('error');
                                }
                                console.log(`üì° Repository ${repo.name} not deployed yet`);
                            });
                    } catch (error) {
                        console.log(`üîç Checking repository: ${this.repositories[repoKey].name}`);
                    }
                });
            }
            setupPortalSystem() {
                // Setup portal tabs including synths
                document.querySelectorAll('.portal-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.portal-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.currentPortalType = tab.dataset.portal;
                        this.updateEntitySelector();
                    });
                });

                this.updateEntitySelector();
            }
            updateEntitySelector() {
                const selector = document.getElementById('entitySelector');
                const entities = this.grimoireEntities[this.currentPortalType] || {};
                
                selector.innerHTML = '';
                Object.entries(entities).forEach(([name, data]) => {
                    const option = document.createElement('div');
                    option.className = 'entity-option';
                    option.dataset.entity = name;
                    
                    let displayInfo = '';
                    if (this.currentPortalType === 'synths') {
                        displayInfo = `
                            <div class="entity-name">${name.toUpperCase().replace('_', ' ')}</div>
                            <div class="entity-domain">${data.model}</div>
                            <div class="entity-domain">${data.hz} Hz</div>
                        `;
                    } else {
                        displayInfo = `
                            <div class="entity-name">${name.charAt(0).toUpperCase() + name.slice(1)}</div>
                            <div class="entity-domain">${data.domain || data.planet || 'Unknown'}</div>
                        `;
                    }
                    
                    option.innerHTML = displayInfo;
                    
                    option.addEventListener('click', () => {
                        document.querySelectorAll('.entity-option').forEach(o => o.classList.remove('active'));
                        option.classList.add('active');
                        this.selectedEntity = name;
                        this.activatePortalEntity(name, data);
                    });
                    
                    selector.appendChild(option);
                });
            }
            activatePortalEntity(name, data) {
                // Enhanced console logging with detailed entity information
                console.log(`üîÆ CATHEDRAL OF CIRCUITS: Activated ${this.currentPortalType.slice(0, -1).toUpperCase()}: ${name.toUpperCase()}`);
                console.log(`üìç ${data.domain || data.planet || data.model}: ${JSON.stringify(data)}`);
                
                // Create detailed entity info display
                const entityInfo = document.createElement('div');
                entityInfo.className = 'entity-activation-display';
                entityInfo.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, rgba(11, 11, 11, 0.95), rgba(44, 10, 82, 0.95));
                    border: 2px solid var(--gold-blavatsky);
                    border-radius: 15px;
                    padding: 25px;
                    max-width: 400px;
                    z-index: 10000;
                    color: var(--bone-atlantean);
                    font-family: 'Cinzel', serif;
                    text-align: center;
                    box-shadow: 0 0 50px rgba(200, 164, 77, 0.6);
                    backdrop-filter: blur(20px);
                `;
                
                if (this.currentPortalType === 'synths') {
                    console.log(`üéπ Synthesizer: ${data.model}`);
                    console.log(`ü™ê Planet: ${data.planet}`);
                    console.log(`üÉè Tarot: ${data.tarot}`);
                    console.log(`üéµ Frequency: ${data.hz} Hz`);
                    console.log(`üé® Theme: ${data.theme}`);
                    
                    entityInfo.innerHTML = `
                        <h3 style="color: var(--gold-blavatsky); margin-bottom: 15px;">
                            üéπ SYNTH STATION ACTIVATED
                        </h3>
                        <h2 style="color: var(--violet-core); margin-bottom: 10px;">${name.toUpperCase().replace('_', ' ')}</h2>
                        <p><strong>Model:</strong> ${data.model}</p>
                        <p><strong>Planet:</strong> ${data.planet}</p>
                        <p><strong>Tarot:</strong> ${data.tarot}</p>
                        <p><strong>Frequency:</strong> ${data.hz} Hz</p>
                        <p><strong>Theme:</strong> ${data.theme.replace('_', ' ')}</p>
                        <p style="font-style: italic; margin-top: 10px; color: var(--astral-silver);">
                            "Sacred synthesis through planetary frequencies and archetypal resonance"
                        </p>
                        <button onclick="this.parentElement.remove()" style="
                            margin-top: 15px;
                            padding: 8px 16px;
                            background: var(--gold-blavatsky);
                            color: var(--void-primordial);
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                        ">Acknowledged</button>
                    `;
                } else if (this.currentPortalType === 'demons') {
                    console.log(`‚ö° Creative Help: ${data.creative_help}`);
                    console.log(`üëë Rank: ${data.rank}`);
                    if (data.legions) console.log(`üî± Legions: ${data.legions}`);
                    if (data.specialty) console.log(`üéØ Specialty: ${data.specialty}`);
                    
                    entityInfo.innerHTML = `
                        <h3 style="color: var(--gold-blavatsky); margin-bottom: 15px;">
                            üî• GOETIC DEMON ACTIVATED
                        </h3>
                        <h2 style="color: #8B0000; margin-bottom: 10px;">${name.toUpperCase()}</h2>
                        <p><strong>Domain:</strong> ${data.domain}</p>
                        <p><strong>Creative Help:</strong> ${data.creative_help}</p>
                        <p><strong>Rank:</strong> ${data.rank}</p>
                        ${data.legions ? `<p><strong>Legions:</strong> ${data.legions}</p>` : ''}
                        ${data.specialty ? `<p><strong>Specialty:</strong> ${data.specialty}</p>` : ''}
                        <button onclick="this.parentElement.remove()" style="
                            margin-top: 15px;
                            padding: 8px 16px;
                            background: var(--gold-blavatsky);
                            color: var(--void-primordial);
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-family: 'Cinzel', serif;
                        ">Acknowledged</button>
                    `;
                } else if (this.currentPortalType === 'angels') {
                    console.log(`‚ú® Guidance: ${data.guidance}`);
                    console.log(`üïäÔ∏è Attribute: ${data.attribute}`);
                    if (data.element) console.log(`üåü Element: ${data.element}`);
                    if (data.hours) console.log(`‚è∞ Sacred Hours: ${data.hours}`);
                    
                    entityInfo.innerHTML = `
                        <h3 style="color: var(--gold-blavatsky); margin-bottom: 15px;">
                            ‚ö° SHEM ANGEL ACTIVATED
                        </h3>
                        <h2 style="color: #E0E0E0; margin-bottom: 10px;">${name.toUpperCase()}</h2>
                        <p><strong>Domain:</strong> ${data.domain}</p>
                        <p><strong>Divine Guidance:</strong> ${data.guidance}</p>
                        <p><strong>Sacred Attribute:</strong> ${data.attribute}</p>
                        ${data.element ? `<p><strong>Element:</strong> ${data.element}</p>` : ''}
                        ${data.hours ? `<p><strong>Sacred Hours:</strong> ${data.hours}</p>` : ''}
                        <button onclick="this.parentElement.remove()" style="
                            margin-top: 15px;
                            padding: 8px 16px;
                            background: var(--gold-blavatsky);
                            color: var(--void-primordial);
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-family: 'Cinzel', serif;
                        ">Acknowledged</button>
                    `;
                } else if (this.currentPortalType === 'arcana') {
                    console.log(`üöó Merkaba Vehicle: ${data.vehicle}`);
                    console.log(`‚ö° Transport Power: ${data.transport_power}`);
                    if (data.number !== undefined) console.log(`üî¢ Sacred Number: ${data.number}`);
                    if (data.element) console.log(`üåü Element: ${data.element}`);
                    if (data.path) console.log(`üõ§Ô∏è Hebrew Path: ${data.path}`);
                    
                    entityInfo.innerHTML = `
                        <h3 style="color: var(--gold-blavatsky); margin-bottom: 15px;">
                            üåü TAROT ARCANA ACTIVATED
                        </h3>
                        <h2 style="color: #800080; margin-bottom: 10px;">${name.toUpperCase().replace('_', ' ')}</h2>
                        <p><strong>Merkaba Vehicle:</strong> ${data.vehicle}</p>
                        <p><strong>Transport Power:</strong> ${data.transport_power}</p>
                        ${data.number !== undefined ? `<p><strong>Sacred Number:</strong> ${data.number}</p>` : ''}
                        ${data.element ? `<p><strong>Element:</strong> ${data.element}</p>` : ''}
                        ${data.path ? `<p><strong>Hebrew Path:</strong> ${data.path}</p>` : ''}
                        <button onclick="this.parentElement.remove()" style="
                            margin-top: 15px;
                            padding: 8px 16px;
                            background: var(--gold-blavatsky);
                            color: var(--void-primordial);
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-family: 'Cinzel', serif;
                        ">Acknowledged</button>
                    `;
                }
                
                // Add to page and auto-remove after 10 seconds
                document.body.appendChild(entityInfo);
                setTimeout(() => {
                    if (entityInfo.parentElement) {
                        entityInfo.remove();
                    }
                }, 10000);
                
                // Update world state with comprehensive entity influence
                this.worldState.activeEntity = { 
                    name, 
                    data, 
                    type: this.currentPortalType,
                    activatedAt: new Date().toISOString(),
                    influence: this.calculateEntityInfluence(data)
                };
                
                // Update status display
                this.updateStatusDisplay();
            }
            
            calculateEntityInfluence(data) {
                // Calculate how entity affects world building
                const influence = {
                    creativity: 0.5,
                    harmony: 0.5,
                    power: 0.5,
                    wisdom: 0.5
                };
                
                // Adjust based on entity type and attributes
                if (data.rank) {
                    switch(data.rank) {
                        case 'king': influence.power += 0.4; break;
                        case 'duke': influence.creativity += 0.3; break;
                        case 'prince': influence.wisdom += 0.3; break;
                        case 'marquis': influence.harmony += 0.2; break;
                        case 'president': influence.power += 0.2; break;
                    }
                }
                
                if (data.attribute && data.attribute.includes('divine')) {
                    influence.wisdom += 0.3;
                    influence.harmony += 0.2;
                }
                
                if (data.element) {
                    switch(data.element) {
                        case 'fire': influence.power += 0.2; break;
                        case 'water': influence.harmony += 0.2; break;
                        case 'earth': influence.creativity += 0.2; break;
                        case 'air': influence.wisdom += 0.2; break;
                    }
                }
                
                return influence;
            }
            
            updateStatusDisplay() {
                if (this.worldState.activeEntity) {
                    const entity = this.worldState.activeEntity;
                    const statusElement = document.getElementById('activeEntity');
                    if (statusElement) {
                        statusElement.textContent = `${entity.name} (${entity.type})`;
                    }
                }
            }

            updateWorldGeometry() {
                const architectures = {
                    corpus: 'Physical manifestation layer - material world design',
                    mentis: 'Intellectual design system - story and learning frameworks', 
                    anima: 'Spiritual essence integration - sacred geometry and healing'
                };
                
                console.log(`üèóÔ∏è Architecture changed to ${this.currentArchitecture.toUpperCase()}: ${architectures[this.currentArchitecture]}`);
            }

            updateThemeColors() {
                // Use theosophical themes instead of grimoire themes for visual display
                const theme = this.theosophicalThemes[this.currentTheme] || this.theosophicalThemes.atlantis;
                this.worldState.colors = theme.colors;
                this.worldState.geometry = theme.geometry;
                this.worldState.harmonics = theme.frequencies;
                
                console.log(`üé® Theosophical realm changed to ${this.currentTheme}: ${theme.mood}`);
                
                // If entity is active, combine influences
                if (this.worldState.activeEntity) {
                    console.log(`üîÆ Entity ${this.worldState.activeEntity.name} influences this realm`);
                }
            }

            updateHarmonics() {
                // Calculate harmonic series based on base frequency
                const golden = 1.618;
                this.worldState.harmonics = [
                    this.baseFrequency,
                    Math.round(this.baseFrequency * golden),
                    Math.round(this.baseFrequency * golden * golden)
                ];
                
                console.log(`üéµ Harmonics updated: ${this.worldState.harmonics.join(' Hz, ')} Hz`);
            }

            updateNumerology() {
                const geometry = this.sacredGeometries[this.sacredNumber];
                this.worldState.numerology = this.sacredNumber;
                this.worldState.geometry = geometry.name;
                
                console.log(`üî¢ Sacred number ${this.sacredNumber}: ${geometry.name} - ${geometry.energy}`);
            }

            // Sacred Geometries Database - Critical Missing Component
            sacredGeometries() {
                return {
                    3: { name: 'triangle', sides: 3, energy: 'Creation Trinity', angles: 60, phi_relationship: 'Divine Trinity' },
                    6: { name: 'hexagon', sides: 6, energy: 'Perfect Harmony', angles: 120, phi_relationship: 'Flower of Life' },
                    7: { name: 'heptagon', sides: 7, energy: 'Mystical Completion', angles: 128.57, phi_relationship: 'Seven Chakras' },
                    9: { name: 'enneagon', sides: 9, energy: 'Universal Wisdom', angles: 140, phi_relationship: 'Enneagram' },
                    11: { name: 'hendecagon', sides: 11, energy: 'Master Number', angles: 147.27, phi_relationship: 'Illumination' },
                    22: { name: 'icosidigon', sides: 22, energy: 'Master Builder', angles: 163.64, phi_relationship: 'Tarot Arcana' },
                    33: { name: 'triacontakaidigon', sides: 33, energy: 'Christ Consciousness', angles: 169.09, phi_relationship: 'Spine Vertebrae' },
                    99: { name: 'enneacontaenneagon', sides: 99, energy: 'Cathedral Completion', angles: 176.36, phi_relationship: 'Cathedral Gates' }
                };
            }

            // Theosophical Themes Database - Also Missing
            theosophicalThemes() {
                return {
                    atlantis: {
                        colors: ['#2C0A52', '#C8A44D', '#F5F2EA', '#7A33FF'],
                        geometry: 'dodecahedron',
                        frequencies: [528, 639, 741],
                        mood: 'lost_civilization_wisdom'
                    },
                    lemuria: {
                        colors: ['#00CED1', '#CBB866', '#BFE9E7', '#1F7AF3'],
                        geometry: 'icosahedron',
                        frequencies: [432, 528, 963],
                        mood: 'primordial_consciousness'
                    },
                    hyperborea: {
                        colors: ['#98FFE2', '#C9D1E7', '#F4C9D9', '#CFE6F2'],
                        geometry: 'octahedron',
                        frequencies: [174, 285, 396],
                        mood: 'polar_light_realms'
                    },
                    shambhala: {
                        colors: ['#FF6A00', '#B87333', '#6E00FF', '#1F7AF3'],
                        geometry: 'tetrahedron',
                        frequencies: [852, 963, 1074],
                        mood: 'hidden_kingdom_light'
                    }
                };
            }

            drawTheosophicalWorld() {
                // Update camera for exploration movement
                this.updateCameraMovement();
                
                const centerX = this.canvas.width / 2 + this.camera.x;
                const centerY = this.canvas.height / 2 + this.camera.y;
                const theme = this.theosophicalThemes[this.currentTheme] || this.theosophicalThemes.atlantis;
                const time = this.animationTime * 0.001;
                
                // Apply camera transformations
                this.ctx.save();
                this.ctx.scale(this.camera.zoom, this.camera.zoom);
                this.ctx.translate(-this.camera.x * 0.1, -this.camera.y * 0.1); // Subtle parallax
                
                // Clear canvas with atmospheric depth
                this.drawAtmosphericBackground(theme, time);
                
                // Draw environmental particles (motes of light, energy wisps) - affected by movement
                this.drawEnvironmentalParticles(centerX, centerY, theme, time);
                
                this.ctx.restore();
                
                // Main cathedral elements with camera applied
                this.ctx.save();
                this.ctx.scale(this.camera.zoom, this.camera.zoom);
                this.ctx.translate(-this.camera.x * 0.3, -this.camera.y * 0.3); // Medium parallax
                
                // Draw cathedral architecture with depth
                this.drawCathedralArchitecture(centerX, centerY, theme, time);
                
                // Draw floating sacred geometry with parallax
                this.drawFloatingSacredGeometry(centerX, centerY, theme, time);
                
                // Draw architecture-specific mystical elements
                this.drawArchitectureLayer(centerX, centerY);
                
                this.ctx.restore();
                
                // Foreground elements with strongest parallax
                this.ctx.save();
                this.ctx.scale(this.camera.zoom, this.camera.zoom);
                this.ctx.translate(-this.camera.x * 0.5, -this.camera.y * 0.5); // Strong parallax
                
                // Draw magical aura and energy fields
                this.drawMagicalAuras(centerX, centerY, theme, time);
                
                // Draw harmonic resonance visualization
                this.drawHarmonicResonance(centerX, centerY);
                
                // Draw active entity influence if present
                if (this.worldState.activeEntity) {
                    this.drawEntityInfluence(centerX, centerY);
                }
                
                this.ctx.restore();
                
                // Foreground effects (no parallax)
                this.drawForegroundEffects(centerX, centerY, theme, time);
                
                // Exploration UI effects
                this.drawExplorationEffects();
                
                // Region indicator
                this.drawRegionIndicator();
            }

            drawRegionIndicator() {
                if (!this.worldState.explorationMode) return;
                
                // Show current exploration region
                this.ctx.save();
                this.ctx.fillStyle = 'rgba(200, 164, 77, 0.8)';
                this.ctx.font = 'italic 16px Cinzel, serif';
                this.ctx.textAlign = 'left';
                
                const regionNames = {
                    'central_sanctum': 'üèõÔ∏è Central Sanctum',
                    'inner_cathedral': '‚õ™ Inner Cathedral', 
                    'outer_spires': 'üóº Outer Spires'
                };
                
                this.ctx.fillText(
                    regionNames[this.worldState.currentRegion] || 'üåü Exploring...',
                    20, 
                    this.canvas.height - 60
                );
                
                // Controls hint
                this.ctx.font = 'italic 12px Cinzel, serif';
                this.ctx.fillStyle = 'rgba(200, 164, 77, 0.6)';
                this.ctx.fillText('Mouse: Look around ‚Ä¢ WASD: Move ‚Ä¢ Wheel: Zoom ‚Ä¢ F: Fullscreen', 20, this.canvas.height - 30);
                
                this.ctx.restore();
            }

            drawAtmosphericBackground(theme, time) {
                // Create layered atmospheric background like Witcher environments
                const gradient = this.ctx.createRadialGradient(
                    this.canvas.width * 0.3, this.canvas.height * 0.2, 0,
                    this.canvas.width * 0.7, this.canvas.height * 0.8, Math.max(this.canvas.width, this.canvas.height)
                );
                
                // Deep atmospheric layers
                gradient.addColorStop(0, theme.colors[0] + '40'); // Deep center
                gradient.addColorStop(0.3, theme.colors[3] + '20'); // Mid atmosphere
                gradient.addColorStop(0.6, theme.colors[1] + '15'); // Outer atmosphere
                gradient.addColorStop(1, '#0B0B0B'); // Void edges
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Add moving fog/mist layers
                for (let layer = 0; layer < 3; layer++) {
                    const mistOpacity = (0.1 - layer * 0.02) * (0.8 + Math.sin(time * 0.5 + layer) * 0.2);
                    const mistSpeed = 0.3 + layer * 0.1;
                    const mistScale = 200 + layer * 100;
                    
                    this.ctx.save();
                    this.ctx.globalAlpha = mistOpacity;
                    this.ctx.fillStyle = theme.colors[layer % theme.colors.length];
                    
                    for (let i = 0; i < 6; i++) {
                        const x = (this.canvas.width * (i / 6) + time * mistSpeed * 10) % (this.canvas.width + mistScale);
                        const y = this.canvas.height * 0.7 + Math.sin(time * 0.8 + i) * 50;
                        
                        this.ctx.beginPath();
                        this.ctx.ellipse(x, y, mistScale, mistScale * 0.3, 0, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                    this.ctx.restore();
                }
            }

            drawEnvironmentalParticles(centerX, centerY, theme, time) {
                // Witcher-style environmental particles - floating motes, energy wisps
                if (!this.particles) {
                    this.particles = [];
                    for (let i = 0; i < 200; i++) {
                        this.particles.push({
                            x: Math.random() * this.canvas.width,
                            y: Math.random() * this.canvas.height,
                            vx: (Math.random() - 0.5) * 0.5,
                            vy: (Math.random() - 0.5) * 0.5,
                            size: Math.random() * 3 + 1,
                            life: Math.random(),
                            type: Math.floor(Math.random() * 3), // Different particle types
                            phase: Math.random() * Math.PI * 2
                        });
                    }
                }
                
                // Update and draw particles
                this.particles.forEach((particle, i) => {
                    // Update particle physics
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life += 0.005;
                    particle.phase += 0.02;
                    
                    // Add slight gravitational pull toward center
                    const dx = centerX - particle.x;
                    const dy = centerY - particle.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    particle.vx += (dx / dist) * 0.001;
                    particle.vy += (dy / dist) * 0.001;
                    
                    // Wrap around screen
                    if (particle.x < 0) particle.x = this.canvas.width;
                    if (particle.x > this.canvas.width) particle.x = 0;
                    if (particle.y < 0) particle.y = this.canvas.height;
                    if (particle.y > this.canvas.height) particle.y = 0;
                    
                    // Draw different particle types
                    this.ctx.save();
                    this.ctx.globalAlpha = Math.sin(particle.life) * 0.6 + 0.2;
                    
                    if (particle.type === 0) {
                        // Energy motes
                        this.ctx.fillStyle = theme.colors[0];
                        this.ctx.beginPath();
                        this.ctx.arc(particle.x, particle.y, particle.size * (0.5 + Math.sin(particle.phase) * 0.3), 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        // Glow effect
                        this.ctx.shadowColor = theme.colors[0];
                        this.ctx.shadowBlur = particle.size * 2;
                        this.ctx.fill();
                    } else if (particle.type === 1) {
                        // Magical wisps - small trails
                        this.ctx.strokeStyle = theme.colors[1];
                        this.ctx.lineWidth = 1;
                        this.ctx.beginPath();
                        this.ctx.moveTo(particle.x, particle.y);
                        this.ctx.lineTo(particle.x - particle.vx * 20, particle.y - particle.vy * 20);
                        this.ctx.stroke();
                    } else {
                        // Sacred symbols
                        this.ctx.fillStyle = theme.colors[2];
                        this.ctx.font = `${particle.size * 2}px serif`;
                        this.ctx.textAlign = 'center';
                        const symbols = ['‚ú¶', '‚úß', '‚üê', '‚óä', '‚¨ü', '‚¨¢'];
                        this.ctx.fillText(symbols[i % symbols.length], particle.x, particle.y);
                    }
                    
                    this.ctx.restore();
                });
            }

            drawCathedralArchitecture(centerX, centerY, theme, time) {
                // Draw authentic Rosslyn Chapel architecture with your labs integrated
                this.ctx.save();
                
                // ROSSLYN CHAPEL MAIN STRUCTURE - Intricate stone masonry
                this.drawRosslynMainChapel(centerX, centerY, theme, time);
                
                // APPRENTICE PILLAR (Your special art experiment) - Alchemy/Synth Lab
                this.drawApprenticeAlchemySynthPillar(centerX + 120, centerY - 80, theme, time);
                
                // MASTER PILLAR - Sacred Geometry Sound Lab
                this.drawMasterGeometryPillar(centerX - 120, centerY - 80, theme, time);
                
                // ROSSLYN'S CARVED CEILING - Musical Angels & Frequency Labs
                this.drawRosslynMusicalAngelsCeiling(centerX, centerY - 150, theme, time);
                
                // LADY CHAPEL - Portal to Stone Grimoire Labs
                this.drawLadyChapelPortal(centerX + 90, centerY, theme, time);
                
                // GREEN MAN CARVINGS - Living Nature Labs (link to stone-grimoire)
                this.drawGreenManNatureLabs(centerX, centerY, theme, time);
                
                // MUSICAL CUBES ARRAY - Harmonic Frequency Research
                this.drawMusicalCubesArray(centerX - 200, centerY - 50, theme, time);
                
                // TEMPLAR KNIGHTS CHAPEL - Crypto/Portal Lab
                this.drawTemplarCryptoChapel(centerX, centerY + 100, theme, time);
                
                // ROSSLYN'S UNDERGROUND CRYPT - Archive & Memory Palace
                this.drawRosslynCryptArchive(centerX, centerY + 150, theme, time);
                
                this.ctx.restore();
            }

            drawRosslynMainChapel(centerX, centerY, theme, time) {
                // Authentic Rosslyn Chapel proportions and architecture
                const chapelWidth = 180;
                const chapelHeight = 140;
                
                // Main chapel nave with Gothic arches
                this.ctx.fillStyle = theme.colors[0] + '30';
                this.ctx.strokeStyle = theme.colors[1];
                this.ctx.lineWidth = 3;
                
                // Central nave rectangle
                this.ctx.fillRect(centerX - chapelWidth/2, centerY - chapelHeight/2, chapelWidth, chapelHeight);
                this.ctx.strokeRect(centerX - chapelWidth/2, centerY - chapelHeight/2, chapelWidth, chapelHeight);
                
                // Rosslyn's distinctive rounded east end (Lady Chapel)
                this.ctx.beginPath();
                this.ctx.arc(centerX + chapelWidth/2, centerY, 35, -Math.PI/2, Math.PI/2);
                this.ctx.fill();
                this.ctx.stroke();
                
                // Gothic pointed windows with Rosslyn's intricate tracery
                this.drawRosslynGothicWindows(centerX, centerY, theme, time);
                
                // Flying buttresses (authentic Rosslyn style)
                this.drawRosslynButtresses(centerX, centerY, theme, time);
                
                // Stone masonry texture
                this.drawStoneMasonryTexture(centerX, centerY, chapelWidth, chapelHeight, theme);
            }

            drawRosslynGothicWindows(centerX, centerY, theme, time) {
                // Rosslyn's ornate Gothic windows with sacred geometry tracery
                const windows = [
                    { x: centerX - 60, y: centerY - 40, type: 'rose', size: 25 },
                    { x: centerX + 60, y: centerY - 40, type: 'lancet', width: 15, height: 35 },
                    { x: centerX, y: centerY - 55, type: 'circular', size: 18 },
                    { x: centerX - 30, y: centerY + 20, type: 'trefoil', size: 20 },
                    { x: centerX + 30, y: centerY + 20, type: 'quatrefoil', size: 20 }
                ];
                
                windows.forEach(window => {
                    this.ctx.save();
                    this.ctx.fillStyle = theme.colors[3] + '15';
                    this.ctx.strokeStyle = theme.colors[2];
                    this.ctx.lineWidth = 2;
                    
                    if (window.type === 'rose') {
                        // Rose window with sacred geometry tracery
                        this.ctx.beginPath();
                        this.ctx.arc(window.x, window.y, window.size, 0, Math.PI * 2);
                        this.ctx.fill();
                        this.ctx.stroke();
                        
                        // Intricate tracery - sacred geometry pattern
                        for (let i = 0; i < 8; i++) {
                            const angle = (i / 8) * Math.PI * 2 + time * 0.1;
                            const innerX = window.x + Math.cos(angle) * (window.size * 0.6);
                            const innerY = window.y + Math.sin(angle) * (window.size * 0.6);
                            this.ctx.beginPath();
                            this.ctx.arc(innerX, innerY, window.size * 0.2, 0, Math.PI * 2);
                            this.ctx.stroke();
                        }
                    } else if (window.type === 'lancet') {
                        // Pointed Gothic arch
                        this.ctx.beginPath();
                        this.ctx.moveTo(window.x - window.width, window.y + window.height);
                        this.ctx.lineTo(window.x - window.width, window.y);
                        this.ctx.quadraticCurveTo(window.x, window.y - window.height/2, window.x + window.width, window.y);
                        this.ctx.lineTo(window.x + window.width, window.y + window.height);
                        this.ctx.closePath();
                        this.ctx.fill();
                        this.ctx.stroke();
                    } else if (window.type === 'trefoil') {
                        // Three-lobed window
                        for (let lobe = 0; lobe < 3; lobe++) {
                            const lobeAngle = (lobe / 3) * Math.PI * 2 - Math.PI/2;
                            const lobeX = window.x + Math.cos(lobeAngle) * (window.size * 0.4);
                            const lobeY = window.y + Math.sin(lobeAngle) * (window.size * 0.4);
                            this.ctx.beginPath();
                            this.ctx.arc(lobeX, lobeY, window.size * 0.3, 0, Math.PI * 2);
                            this.ctx.fill();
                            this.ctx.stroke();
                        }
                    } else if (window.type === 'quatrefoil') {
                        // Four-lobed window  
                        for (let lobe = 0; lobe < 4; lobe++) {
                            const lobeAngle = (lobe / 4) * Math.PI * 2;
                            const lobeX = window.x + Math.cos(lobeAngle) * (window.size * 0.35);
                            const lobeY = window.y + Math.sin(lobeAngle) * (window.size * 0.35);
                            this.ctx.beginPath();
                            this.ctx.arc(lobeX, lobeY, window.size * 0.25, 0, Math.PI * 2);
                            this.ctx.fill();
                            this.ctx.stroke();
                        }
                    }
                    
                    this.ctx.restore();
                });
            }

            drawRosslynButtresses(centerX, centerY, theme, time) {
                // Flying buttresses in authentic Rosslyn style
                for (let i = 0; i < 6; i++) {
                    const buttressAngle = (i / 6) * Math.PI * 2;
                    const buttressDistance = 140;
                    const buttressX = centerX + Math.cos(buttressAngle) * buttressDistance;
                    const buttressY = centerY + Math.sin(buttressAngle) * buttressDistance;
                    
                    // Main buttress arch
                    this.ctx.strokeStyle = theme.colors[1] + '40';
                    this.ctx.lineWidth = 4;
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX + Math.cos(buttressAngle) * 90, centerY + Math.sin(buttressAngle) * 90 - 20);
                    this.ctx.quadraticCurveTo(
                        buttressX, buttressY - 80 + Math.sin(time + i) * 10,
                        buttressX, buttressY - 20
                    );
                    this.ctx.stroke();
                    
                    // Buttress pillar
                    this.ctx.fillStyle = theme.colors[0] + '50';
                    this.ctx.fillRect(buttressX - 8, buttressY - 20, 16, 40);
                    this.ctx.strokeRect(buttressX - 8, buttressY - 20, 16, 40);
                }
            }

            drawStoneMasonryTexture(centerX, centerY, width, height, theme) {
                // Add stone masonry texture to make it feel like real carved stone
                this.ctx.save();
                this.ctx.strokeStyle = theme.colors[1] + '20';
                this.ctx.lineWidth = 1;
                
                // Horizontal mortar lines
                for (let y = -height/2; y < height/2; y += 25) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX - width/2, centerY + y);
                    this.ctx.lineTo(centerX + width/2, centerY + y);
                    this.ctx.stroke();
                }
                
                // Vertical mortar lines (staggered like real masonry)
                for (let x = -width/2; x < width/2; x += 30) {
                    for (let y = -height/2; y < height/2; y += 50) {
                        this.ctx.beginPath();
                        this.ctx.moveTo(centerX + x + (y % 50 === 0 ? 15 : 0), centerY + y);
                        this.ctx.lineTo(centerX + x + (y % 50 === 0 ? 15 : 0), centerY + y + 25);
                        this.ctx.stroke();
                    }
                }
                
                this.ctx.restore();
            }

            drawRosslynMainChapel(centerX, centerY, theme, time) {
                // Main chapel structure with Rosslyn's distinctive proportions
                const chapelWidth = 180;
                const chapelHeight = 200;
                
                // Stone masonry walls with intricate detail
                this.ctx.fillStyle = theme.colors[0] + '40';
                this.ctx.strokeStyle = theme.colors[1];
                this.ctx.lineWidth = 3;
                
                // Main chapel body
                this.ctx.fillRect(centerX - chapelWidth/2, centerY - chapelHeight/2, chapelWidth, chapelHeight);
                this.ctx.strokeRect(centerX - chapelWidth/2, centerY - chapelHeight/2, chapelWidth, chapelHeight);
                
                // Rosslyn's distinctive rounded east end (Lady Chapel)
                this.ctx.beginPath();
                this.ctx.arc(centerX + chapelWidth/2, centerY, 40, -Math.PI/2, Math.PI/2);
                this.ctx.fill();
                this.ctx.stroke();
                
                // Flying buttresses (Rosslyn style)
                for (let i = 0; i < 4; i++) {
                    const buttressAngle = (i / 4) * Math.PI * 2;
                    const buttressX = centerX + Math.cos(buttressAngle) * 120;
                    const buttressY = centerY + Math.sin(buttressAngle) * 120;
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX + Math.cos(buttressAngle) * 90, centerY + Math.sin(buttressAngle) * 90);
                    this.ctx.quadraticCurveTo(buttressX, buttressY - 60, buttressX, buttressY);
                    this.ctx.strokeStyle = theme.colors[2] + '60';
                    this.ctx.lineWidth = 6;
                    this.ctx.stroke();
                }

                // Ornate Gothic windows with Rosslyn's intricate tracery
                this.drawRosslynWindows(centerX, centerY, theme, time);
            }

            drawRosslynWindows(centerX, centerY, theme, time) {
                // Rosslyn's famous ornate windows with mystical symbols
                const windows = [
                    { x: centerX - 60, y: centerY - 50, type: 'rose' },
                    { x: centerX + 60, y: centerY - 50, type: 'lancet' },
                    { x: centerX, y: centerY - 80, type: 'circular' }
                ];
                
                windows.forEach(window => {
                    this.ctx.save();
                    this.ctx.fillStyle = theme.colors[3] + '20';
                    this.ctx.strokeStyle = theme.colors[1];
                    this.ctx.lineWidth = 2;
                    
                    if (window.type === 'rose') {
                        // Rose window with sacred geometry
                        this.ctx.beginPath();
                        this.ctx.arc(window.x, window.y, 25, 0, Math.PI * 2);
                        this.ctx.fill();
                        this.ctx.stroke();
                        
                        // Inner tracery
                        for (let i = 0; i < 8; i++) {
                            const angle = (i / 8) * Math.PI * 2 + time * 0.2;
                            const innerX = window.x + Math.cos(angle) * 15;
                            const innerY = window.y + Math.sin(angle) * 15;
                            this.ctx.beginPath();
                            this.ctx.arc(innerX, innerY, 5, 0, Math.PI * 2);
                            this.ctx.stroke();
                        }
                    } else if (window.type === 'lancet') {
                        // Pointed arch window
                        this.ctx.beginPath();
                        this.ctx.moveTo(window.x - 15, window.y + 20);
                        this.ctx.lineTo(window.x - 15, window.y - 10);
                        this.ctx.quadraticCurveTo(window.x, window.y - 25, window.x + 15, window.y - 10);
                        this.ctx.lineTo(window.x + 15, window.y + 20);
                        this.ctx.closePath();
                        this.ctx.fill();
                        this.ctx.stroke();
                    }
                    
                    this.ctx.restore();
                });
            }

            drawApprenticeAlchemyPillar(x, y, theme, time) {
                // Rosslyn's famous Apprentice Pillar transformed into Alchemy Lab
                this.ctx.save();
                
                // Spiral carved column (Rosslyn's signature feature)
                const pillarHeight = 120;
                const pillarRadius = 15;
                
                // Main pillar body
                this.ctx.fillStyle = theme.colors[0] + '60';
                this.ctx.fillRect(x - pillarRadius, y, pillarRadius * 2, pillarHeight);
                
                // Spiral carvings with alchemical symbols
                for (let spiral = 0; spiral < 8; spiral++) {
                    const spiralY = y + (spiral / 8) * pillarHeight;
                    const spiralAngle = spiral * 0.5 + time * 0.3;
                    const spiralX = x + Math.cos(spiralAngle) * (pillarRadius - 3);
                    const spiralDrawX = x + Math.sin(spiralAngle) * (pillarRadius - 3);
                    
                    // Draw spiral vine pattern
                    this.ctx.strokeStyle = theme.colors[2];
                    this.ctx.lineWidth = 2;
                    this.ctx.beginPath();
                    if (spiral > 0) {
                        const prevSpiralY = y + ((spiral - 1) / 8) * pillarHeight;
                        const prevSpiralAngle = (spiral - 1) * 0.5 + time * 0.3;
                        const prevSpiralDrawX = x + Math.sin(prevSpiralAngle) * (pillarRadius - 3);
                        this.ctx.moveTo(prevSpiralDrawX, prevSpiralY);
                        this.ctx.quadraticCurveTo(spiralX, spiralY - 10, spiralDrawX, spiralY);
                    }
                    this.ctx.stroke();
                    
                    // Alchemical symbols at spiral points
                    this.ctx.fillStyle = theme.colors[1];
                    this.ctx.font = '12px serif';
                    this.ctx.textAlign = 'center';
                    const alchemicalSymbols = ['‚òø', '‚ôÄ', '‚ôÇ', '‚ôÉ', '‚ôÑ', '‚òΩ', '‚òâ', 'üúÄ'];
                    this.ctx.fillText(alchemicalSymbols[spiral], spiralDrawX, spiralY);
                }
                
                // Ornate capital (top of pillar) - Now an active alchemy cauldron
                this.ctx.fillStyle = theme.colors[1] + '80';
                this.ctx.beginPath();
                this.ctx.arc(x, y - 10, 25, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Bubbling alchemical reaction
                const bubbles = 6;
                for (let b = 0; b < bubbles; b++) {
                    const bubbleAngle = (b / bubbles) * Math.PI * 2 + time * 2;
                    const bubbleRadius = 3 + Math.sin(time * 3 + b) * 2;
                    const bubbleX = x + Math.cos(bubbleAngle) * (8 + Math.sin(time + b) * 5);
                    const bubbleY = y - 10 + Math.sin(bubbleAngle) * (8 + Math.cos(time + b) * 5);
                    
                    this.ctx.fillStyle = theme.colors[2] + '60';
                    this.ctx.beginPath();
                    this.ctx.arc(bubbleX, bubbleY, bubbleRadius, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                
                // Alchemy lab label
                this.ctx.fillStyle = theme.colors[0];
                this.ctx.font = 'bold 10px Cinzel, serif';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('ALCHEMY LAB', x, y + pillarHeight + 20);
                
                this.ctx.restore();
            }

            drawMasterGeometryPillar(x, y, theme, time) {
                // Master Pillar as Sacred Geometry Temple
                this.ctx.save();
                
                const pillarHeight = 120;
                const pillarRadius = 15;
                
                // Main pillar with geometric patterns
                this.ctx.fillStyle = theme.colors[0] + '60';
                this.ctx.fillRect(x - pillarRadius, y, pillarRadius * 2, pillarHeight);
                
                // Sacred geometry carvings running up the pillar
                for (let geo = 0; geo < 6; geo++) {
                    const geoY = y + (geo / 6) * pillarHeight + 20;
                    const geoRotation = time * 0.5 + geo * 0.3;
                    
                    this.ctx.save();
                    this.ctx.translate(x, geoY);
                    this.ctx.rotate(geoRotation);
                    
                    this.ctx.strokeStyle = theme.colors[2];
                    this.ctx.lineWidth = 2;
                    
                    // Different sacred geometries for each level
                    if (geo % 3 === 0) {
                        // Flower of Life
                        this.ctx.beginPath();
                        this.ctx.arc(0, 0, 8, 0, Math.PI * 2);
                        for (let petal = 0; petal < 6; petal++) {
                            const petalAngle = (petal / 6) * Math.PI * 2;
                            this.ctx.moveTo(Math.cos(petalAngle) * 8 + 8, Math.sin(petalAngle) * 8);
                            this.ctx.arc(Math.cos(petalAngle) * 8, Math.sin(petalAngle) * 8, 8, 0, Math.PI * 2);
                        }
                        this.ctx.stroke();
                    } else if (geo % 3 === 1) {
                        // Metatron's Cube
                        const vertices = [];
                        for (let v = 0; v < 6; v++) {
                            const vAngle = (v / 6) * Math.PI * 2;
                            vertices.push({
                                x: Math.cos(vAngle) * 10,
                                y: Math.sin(vAngle) * 10
                            });
                        }
                        
                        // Connect all vertices
                        this.ctx.beginPath();
                        for (let i = 0; i < vertices.length; i++) {
                            for (let j = i + 1; j < vertices.length; j++) {
                                this.ctx.moveTo(vertices[i].x, vertices[i].y);
                                this.ctx.lineTo(vertices[j].x, vertices[j].y);
                            }
                        }
                        this.ctx.stroke();
                    } else {
                        // Seed of Life
                        this.ctx.beginPath();
                        for (let seed = 0; seed < 7; seed++) {
                            const seedAngle = (seed / 7) * Math.PI * 2;
                            const seedX = Math.cos(seedAngle) * (seed === 0 ? 0 : 6);
                            const seedY = Math.sin(seedAngle) * (seed === 0 ? 0 : 6);
                            this.ctx.moveTo(seedX + 6, seedY);
                            this.ctx.arc(seedX, seedY, 6, 0, Math.PI * 2);
                        }
                        this.ctx.stroke();
                    }
                    
                    this.ctx.restore();
                }
                
                // Geometry temple crown
                this.ctx.fillStyle = theme.colors[1] + '80';
                this.ctx.strokeStyle = theme.colors[2];
                this.ctx.lineWidth = 2;
                
                // Platonic solid crown (dodecahedron representation)
                this.ctx.save();
                this.ctx.translate(x, y - 10);
                this.ctx.rotate(time * 0.3);
                
                // Draw dodecahedron as pentagonal crown
                this.ctx.beginPath();
                for (let p = 0; p < 5; p++) {
                    const pentAngle = (p / 5) * Math.PI * 2;
                    const pentX = Math.cos(pentAngle) * 20;
                    const pentY = Math.sin(pentAngle) * 20;
                    if (p === 0) this.ctx.moveTo(pentX, pentY);
                    else this.ctx.lineTo(pentX, pentY);
                }
                this.ctx.closePath();
                this.ctx.fill();
                this.ctx.stroke();
                
                this.ctx.restore();
                
                // Sacred geometry temple label
                this.ctx.fillStyle = theme.colors[0];
                this.ctx.font = 'bold 10px Cinzel, serif';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('GEOMETRY TEMPLE', x, y + pillarHeight + 20);
                
                this.ctx.restore();
            }

            drawFloatingSacredGeometry(centerX, centerY, theme, time) {
                // Floating geometric elements at different depths
                for (let depth = 0; depth < 4; depth++) {
                    const depthFactor = 1 - (depth * 0.2);
                    const rotationSpeed = 0.3 + depth * 0.1;
                    const orbitRadius = 200 + depth * 80;
                    
                    this.ctx.save();
                    this.ctx.globalAlpha = 0.4 + depth * 0.1;
                    
                    for (let geo = 0; geo < 6; geo++) {
                        const angle = (geo / 6) * Math.PI * 2 + time * rotationSpeed;
                        const x = centerX + Math.cos(angle) * orbitRadius * depthFactor;
                        const y = centerY + Math.sin(angle) * orbitRadius * depthFactor;
                        
                        // Draw floating geometric shape
                        const size = (20 + depth * 10) * depthFactor;
                        const shapeRotation = time * (1 + depth * 0.5);
                        
                        this.ctx.save();
                        this.ctx.translate(x, y);
                        this.ctx.rotate(shapeRotation);
                        
                        this.ctx.strokeStyle = theme.colors[geo % theme.colors.length];
                        this.ctx.lineWidth = 2 * depthFactor;
                        
                        // Different shapes for variety
                        if (geo % 3 === 0) {
                            // Triangle
                            this.ctx.beginPath();
                            for (let i = 0; i < 3; i++) {
                                const triAngle = (i / 3) * Math.PI * 2;
                                const triX = Math.cos(triAngle) * size;
                                const triY = Math.sin(triAngle) * size;
                                if (i === 0) this.ctx.moveTo(triX, triY);
                                else this.ctx.lineTo(triX, triY);
                            }
                            this.ctx.closePath();
                            this.ctx.stroke();
                        } else if (geo % 3 === 1) {
                            // Hexagon
                            this.ctx.beginPath();
                            for (let i = 0; i < 6; i++) {
                                const hexAngle = (i / 6) * Math.PI * 2;
                                const hexX = Math.cos(hexAngle) * size;
                                const hexY = Math.sin(hexAngle) * size;
                                if (i === 0) this.ctx.moveTo(hexX, hexY);
                                else this.ctx.lineTo(hexX, hexY);
                            }
                            this.ctx.closePath();
                            this.ctx.stroke();
                        } else {
                            // Circle
                            this.ctx.beginPath();
                            this.ctx.arc(0, 0, size, 0, Math.PI * 2);
                            this.ctx.stroke();
                        }
                        
                        this.ctx.restore();
                    }
                    
                    this.ctx.restore();
                }
            }

            drawMagicalAuras(centerX, centerY, theme, time) {
                // Witcher-style magical auras and energy fields
                for (let aura = 0; aura < 3; aura++) {
                    const auraRadius = 150 + aura * 100 + Math.sin(time * 0.6 + aura) * 30;
                    const auraOpacity = 0.1 - aura * 0.02;
                    
                    this.ctx.save();
                    this.ctx.globalAlpha = auraOpacity;
                    
                    // Pulsing aura rings
                    this.ctx.strokeStyle = theme.colors[aura % theme.colors.length];
                    this.ctx.lineWidth = 3;
                    this.ctx.setLineDash([10, 20]);
                    this.ctx.lineDashOffset = time * 50;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, auraRadius, 0, Math.PI * 2);
                    this.ctx.stroke();
                    
                    this.ctx.restore();
                }
                
                // Energy field distortions
                for (let field = 0; field < 8; field++) {
                    const fieldAngle = (field / 8) * Math.PI * 2 + time * 0.4;
                    const fieldRadius = 180 + Math.sin(time * 1.2 + field) * 40;
                    const fieldX = centerX + Math.cos(fieldAngle) * fieldRadius;
                    const fieldY = centerY + Math.sin(fieldAngle) * fieldRadius;
                    
                    this.ctx.save();
                    this.ctx.globalAlpha = 0.3;
                    this.ctx.fillStyle = theme.colors[field % theme.colors.length];
                    
                    // Energy field node
                    this.ctx.beginPath();
                    this.ctx.arc(fieldX, fieldY, 8 + Math.sin(time * 2 + field) * 4, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Energy tendrils connecting to center
                    this.ctx.strokeStyle = theme.colors[field % theme.colors.length];
                    this.ctx.lineWidth = 2;
                    this.ctx.globalAlpha = 0.2;
                    this.ctx.beginPath();
                    this.ctx.moveTo(fieldX, fieldY);
                    this.ctx.quadraticCurveTo(
                        centerX + Math.sin(time + field) * 50,
                        centerY + Math.cos(time + field) * 50,
                        centerX, centerY
                    );
                    this.ctx.stroke();
                    
                    this.ctx.restore();
                }
            }

            drawForegroundEffects(centerX, centerY, theme, time) {
                // Foreground atmospheric effects - light rays, magical sparkles
                this.ctx.save();
                
                // God rays / light beams
                for (let ray = 0; ray < 12; ray++) {
                    const rayAngle = (ray / 12) * Math.PI * 2 + time * 0.1;
                    const rayLength = 400 + Math.sin(time * 0.7 + ray) * 100;
                    
                    this.ctx.globalAlpha = 0.05 + Math.sin(time * 0.5 + ray) * 0.03;
                    this.ctx.strokeStyle = theme.colors[0];
                    this.ctx.lineWidth = 20;
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(centerX, centerY);
                    this.ctx.lineTo(
                        centerX + Math.cos(rayAngle) * rayLength,
                        centerY + Math.sin(rayAngle) * rayLength
                    );
                    this.ctx.stroke();
                }
                
                // Magical sparkles in foreground
                for (let sparkle = 0; sparkle < 30; sparkle++) {
                    const sparkleX = Math.random() * this.canvas.width;
                    const sparkleY = Math.random() * this.canvas.height;
                    const sparkleLife = (time * 2 + sparkle) % (Math.PI * 2);
                    const sparkleOpacity = Math.sin(sparkleLife) * 0.8;
                    
                    if (sparkleOpacity > 0) {
                        this.ctx.globalAlpha = sparkleOpacity;
                        this.ctx.fillStyle = theme.colors[sparkle % theme.colors.length];
                        this.ctx.fillText('‚ú®', sparkleX, sparkleY);
                    }
                }
                
                this.ctx.restore();
            }

            drawEntityInfluence(centerX, centerY) {
                const entity = this.worldState.activeEntity;
                const time = this.animationTime * 0.001;
                
                // Draw entity sigil or influence pattern
                this.ctx.save();
                this.ctx.translate(centerX, centerY);
                
                if (entity.type === 'demons') {
                    // Draw demonic creative influence - pentagram-based
                    this.drawPentagramInfluence(time);
                } else if (entity.type === 'angels') {
                    // Draw angelic guidance influence - hexagram-based
                    this.drawHexagramInfluence(time);
                } else if (entity.type === 'arcana') {
                    // Draw archetypal merkaba influence
                    this.drawMerkabaInfluence(time);
                }
                
                this.ctx.restore();
            }

            drawPentagramInfluence(time) {
                // Demonic creative pentagram
                const radius = 80 + Math.sin(time) * 10;
                this.ctx.beginPath();
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 2 * Math.PI / 5) - Math.PI / 2 + time * 0.5;
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    if (i === 0) this.ctx.moveTo(x, y);
                    else this.ctx.lineTo(x, y);
                }
                this.ctx.closePath();
                this.ctx.strokeStyle = '#8B0000';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
            }

            drawHexagramInfluence(time) {
                // Angelic guidance hexagram
                const radius = 80 + Math.sin(time) * 10;
                // Draw two interlaced triangles
                for (let triangle = 0; triangle < 2; triangle++) {
                    this.ctx.beginPath();
                    for (let i = 0; i < 3; i++) {
                        const angle = (i * 2 * Math.PI / 3) + (triangle * Math.PI / 3) + time * 0.3;
                        const x = Math.cos(angle) * radius;
                        const y = Math.sin(angle) * radius;
                        if (i === 0) this.ctx.moveTo(x, y);
                        else this.ctx.lineTo(x, y);
                    }
                    this.ctx.closePath();
                    this.ctx.strokeStyle = '#E0E0E0';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
            }

            drawMerkabaInfluence(time) {
                // Archetypal merkaba - rotating tetrahedra
                const radius = 80;
                for (let tetra = 0; tetra < 2; tetra++) {
                    this.ctx.beginPath();
                    for (let i = 0; i < 3; i++) {
                        const angle = (i * 2 * Math.PI / 3) + (tetra * Math.PI) + time * (tetra ? -0.7 : 0.7);
                        const x = Math.cos(angle) * radius;
                        const y = Math.sin(angle) * radius;
                        if (i === 0) this.ctx.moveTo(x, y);
                        else this.ctx.lineTo(x, y);
                    }
                    this.ctx.closePath();
                    this.ctx.strokeStyle = '#800080';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
            }

            drawSacredGeometry(centerX, centerY, theme) {
                const baseRadius = 150;
                const geometry = this.sacredGeometries[this.sacredNumber];
                const sides = geometry.sides;
                const time = this.animationTime * 0.001;
                
                // Golden ratio and Fibonacci spiral integration
                const phi = 1.618033988749;
                const goldenRadius = baseRadius / phi;
                
                // Draw multiple geometric layers for depth
                for (let layer = 0; layer < 3; layer++) {
                    const radius = baseRadius - (layer * 30);
                    const layerTime = time + (layer * 0.2);
                    
                    this.ctx.beginPath();
                    
                    if (geometry.name === 'triangle') {
                        // Enhanced triangle with internal sacred geometry
                        this.drawTriangleSacred(centerX, centerY, radius, layerTime);
                    } else if (geometry.name === 'hexagon') {
                        // Flower of Life pattern
                        this.drawFlowerOfLife(centerX, centerY, radius, layerTime);
                    } else if (geometry.name === 'heptagon') {
                        // Mystical heptagon with planetary correspondences
                        this.drawMysticalHeptagon(centerX, centerY, radius, layerTime);
                    } else if (geometry.name === 'enneagon') {
                        // Enneagram with sacred points
                        this.drawEnneagram(centerX, centerY, radius, layerTime);
                    } else {
                        // Standard polygon with golden ratio proportions
                        for (let i = 0; i < sides; i++) {
                            const angle = (i / sides) * Math.PI * 2 + layerTime;
                            const x = centerX + Math.cos(angle) * radius;
                            const y = centerY + Math.sin(angle) * radius;
                            
                            if (i === 0) {
                                this.ctx.moveTo(x, y);
                            } else {
                                this.ctx.lineTo(x, y);
                            }
                        }
                        this.ctx.closePath();
                    }
                    
                    // Enhanced gradient system
                    const gradient = this.ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                    const opacity = 0.4 - (layer * 0.1);
                    gradient.addColorStop(0, theme.colors[0] + Math.floor(opacity * 100).toString(16).padStart(2, '0'));
                    gradient.addColorStop(0.382, theme.colors[1] + Math.floor(opacity * 60).toString(16).padStart(2, '0')); // Golden ratio point
                    gradient.addColorStop(0.618, theme.colors[2] + Math.floor(opacity * 40).toString(16).padStart(2, '0')); // Golden ratio point
                    gradient.addColorStop(1, theme.colors[3] + Math.floor(opacity * 20).toString(16).padStart(2, '0'));
                    
                    this.ctx.fillStyle = gradient;
                    this.ctx.fill();
                    this.ctx.strokeStyle = theme.colors[layer % theme.colors.length];
                    this.ctx.lineWidth = 3 - layer;
                    this.ctx.stroke();
                }

                // Central point with pulsing energy
                this.ctx.beginPath();
                const pulseRadius = 8 + Math.sin(time * 2) * 3;
                this.ctx.arc(centerX, centerY, pulseRadius, 0, Math.PI * 2);
                this.ctx.fillStyle = theme.colors[0];
                this.ctx.fill();
                this.ctx.strokeStyle = theme.colors[1];
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // Sacred number display
                this.ctx.fillStyle = theme.colors[0];
                this.ctx.font = 'bold 16px Cinzel, serif';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(this.sacredNumber.toString(), centerX, centerY + 5);
            }
            
            drawTriangleSacred(centerX, centerY, radius, time) {
                // Triangle with internal triquetra
                const points = [];
                for (let i = 0; i < 3; i++) {
                    const angle = (i * 2 * Math.PI / 3) - Math.PI / 2 + time;
                    points.push({
                        x: centerX + Math.cos(angle) * radius,
                        y: centerY + Math.sin(angle) * radius
                    });
                }
                
                // Draw main triangle
                this.ctx.moveTo(points[0].x, points[0].y);
                this.ctx.lineTo(points[1].x, points[1].y);
                this.ctx.lineTo(points[2].x, points[2].y);
                this.ctx.closePath();
                
                // Draw internal triquetra
                for (let i = 0; i < 3; i++) {
                    const cx = centerX + Math.cos(i * 2 * Math.PI / 3 + time) * radius * 0.3;
                    const cy = centerY + Math.sin(i * 2 * Math.PI / 3 + time) * radius * 0.3;
                    this.ctx.moveTo(cx + radius * 0.2, cy);
                    this.ctx.arc(cx, cy, radius * 0.2, 0, Math.PI * 2);
                }
            }
            
            drawFlowerOfLife(centerX, centerY, radius, time) {
                // Central circle
                this.ctx.moveTo(centerX + radius, centerY);
                this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                
                // Six surrounding circles creating Flower of Life pattern
                for (let i = 0; i < 6; i++) {
                    const angle = (i * Math.PI / 3) + time;
                    const cx = centerX + Math.cos(angle) * radius;
                    const cy = centerY + Math.sin(angle) * radius;
                    this.ctx.moveTo(cx + radius, cy);
                    this.ctx.arc(cx, cy, radius, 0, Math.PI * 2);
                }
            }
            
            drawMysticalHeptagon(centerX, centerY, radius, time) {
                // Heptagon with planetary symbols at each point
                const planetaryAngles = [];
                for (let i = 0; i < 7; i++) {
                    const angle = (i * 2 * Math.PI / 7) - Math.PI / 2 + time;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                    
                    // Small circles at planetary points
                    this.ctx.moveTo(x + 5, y);
                    this.ctx.arc(x, y, 5, 0, Math.PI * 2);
                }
                this.ctx.closePath();
            }
            
            drawEnneagram(centerX, centerY, radius, time) {
                // Nine-pointed star with connecting lines
                const points = [];
                for (let i = 0; i < 9; i++) {
                    const angle = (i * 2 * Math.PI / 9) - Math.PI / 2 + time;
                    points.push({
                        x: centerX + Math.cos(angle) * radius,
                        y: centerY + Math.sin(angle) * radius
                    });
                }
                
                // Draw enneagon
                this.ctx.moveTo(points[0].x, points[0].y);
                for (let i = 1; i < 9; i++) {
                    this.ctx.lineTo(points[i].x, points[i].y);
                }
                this.ctx.closePath();
                
                // Draw internal connections (enneagram pattern)
                const connections = [1, 4, 2, 8, 5, 7]; // Traditional enneagram sequence
                this.ctx.moveTo(points[connections[0]].x, points[connections[0]].y);
                for (let i = 1; i < connections.length; i++) {
                    this.ctx.lineTo(points[connections[i]].x, points[connections[i]].y);
                }
                this.ctx.lineTo(points[connections[0]].x, points[connections[0]].y);
            }

            drawArchitectureLayer(centerX, centerY) {
                const time = this.animationTime * 0.001;
                
                switch(this.currentArchitecture) {
                    case 'corpus':
                        // Physical world - solid structures
                        this.drawPhysicalStructures(centerX, centerY, time);
                        break;
                    case 'mentis':
                        // Mental world - interconnected networks
                        this.drawMentalNetworks(centerX, centerY, time);
                        break;
                    case 'anima':
                        // Spiritual world - energy flows
                        this.drawSpiritualEnergies(centerX, centerY, time);
                        break;
                }
            }

            drawPhysicalStructures(centerX, centerY, time) {
                // Draw crystalline structures for physical layer
                const theme = this.theosophicalThemes[this.currentTheme];
                
                for (let i = 0; i < 6; i++) {
                    const angle = (i / 6) * Math.PI * 2 + time * 0.5;
                    const radius = 100 + Math.sin(time + i) * 20;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    this.ctx.beginPath();
                    this.ctx.rect(x - 8, y - 8, 16, 16);
                    this.ctx.fillStyle = theme.colors[i % theme.colors.length] + '60';
                    this.ctx.fill();
                    this.ctx.strokeStyle = theme.colors[0];
                    this.ctx.stroke();
                }
            }

            drawMentalNetworks(centerX, centerY, time) {
                // Draw interconnected thought networks
                const theme = this.theosophicalThemes[this.currentTheme];
                
                for (let i = 0; i < 8; i++) {
                    for (let j = i + 1; j < 8; j++) {
                        const angle1 = (i / 8) * Math.PI * 2 + time;
                        const angle2 = (j / 8) * Math.PI * 2 + time;
                        const radius = 120;
                        
                        const x1 = centerX + Math.cos(angle1) * radius;
                        const y1 = centerY + Math.sin(angle1) * radius;
                        const x2 = centerX + Math.cos(angle2) * radius;
                        const y2 = centerY + Math.sin(angle2) * radius;
                        
                        this.ctx.beginPath();
                        this.ctx.moveTo(x1, y1);
                        this.ctx.lineTo(x2, y2);
                        this.ctx.strokeStyle = theme.colors[1] + '30';
                        this.ctx.lineWidth = 1;
                        this.ctx.stroke();
                    }
                }
            }

            drawSpiritualEnergies(centerX, centerY, time) {
                // Draw flowing spiritual energies
                const theme = this.theosophicalThemes[this.currentTheme];
                
                for (let layer = 0; layer < 3; layer++) {
                    const radius = 80 + layer * 40;
                    const points = 12 + layer * 6;
                    
                    this.ctx.beginPath();
                    for (let i = 0; i <= points; i++) {
                        const angle = (i / points) * Math.PI * 2 + time * (1 + layer * 0.3);
                        const waveRadius = radius + Math.sin(angle * 3 + time * 2) * 15;
                        const x = centerX + Math.cos(angle) * waveRadius;
                        const y = centerY + Math.sin(angle) * waveRadius;
                        
                        if (i === 0) {
                            this.ctx.moveTo(x, y);
                        } else {
                            this.ctx.lineTo(x, y);
                        }
                    }
                    
                    this.ctx.strokeStyle = theme.colors[layer] + '50';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
            }

            drawHarmonicResonance(centerX, centerY) {
                // Advanced frequency harmonics visualization with sacred proportions
                const time = this.animationTime * 0.001;
                const phi = 1.618033988749; // Golden ratio
                
                // Primary harmonic circles with golden ratio spacing
                this.worldState.harmonics.forEach((freq, index) => {
                    const normalizedFreq = freq / 1000;
                    const baseRadius = 40 + index * 35;
                    const pulseRadius = baseRadius + Math.sin(time * normalizedFreq * 2) * 8;
                    const phiRadius = baseRadius * Math.pow(phi, index * 0.2);
                    
                    // Main harmonic circle
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, pulseRadius, 0, Math.PI * 2);
                    
                    // Create harmonic-specific gradient
                    const gradient = this.ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, pulseRadius);
                    const hue = (freq / 10) % 360;
                    gradient.addColorStop(0, `hsla(${hue}, 70%, 60%, 0.1)`);
                    gradient.addColorStop(0.618, `hsla(${hue}, 80%, 50%, 0.2)`); // Golden ratio point
                    gradient.addColorStop(1, `hsla(${hue}, 90%, 40%, 0.3)`);
                    
                    this.ctx.fillStyle = gradient;
                    this.ctx.fill();
                    this.ctx.strokeStyle = `hsla(${hue}, 100%, 70%, ${0.4 - index * 0.08})`;
                    this.ctx.lineWidth = 2 - index * 0.2;
                    this.ctx.stroke();
                    
                    // Golden ratio resonance circles
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, phiRadius, 0, Math.PI * 2);
                    this.ctx.strokeStyle = `hsla(${(hue + 30) % 360}, 80%, 60%, ${0.2 - index * 0.03})`;
                    this.ctx.lineWidth = 1;
                    this.ctx.stroke();
                    
                    // Frequency interference patterns
                    if (index > 0) {
                        const interferenceRadius = (baseRadius + this.worldState.harmonics[0] / 1000 * 20);
                        const interferenceAngle = time * (freq / 100) + index * Math.PI / 3;
                        
                        for (let wave = 0; wave < 6; wave++) {
                            const waveAngle = interferenceAngle + wave * Math.PI / 3;
                            const waveX = centerX + Math.cos(waveAngle) * interferenceRadius;
                            const waveY = centerY + Math.sin(waveAngle) * interferenceRadius;
                            
                            this.ctx.beginPath();
                            this.ctx.arc(waveX, waveY, 3 + Math.sin(time * freq / 200) * 2, 0, Math.PI * 2);
                            this.ctx.fillStyle = `hsla(${hue}, 100%, 80%, 0.3)`;
                            this.ctx.fill();
                        }
                    }
                });
                
                // Central frequency node with sacred number display
                this.ctx.beginPath();
                const centralPulse = 12 + Math.sin(time * 3) * 4;
                this.ctx.arc(centerX, centerY, centralPulse, 0, Math.PI * 2);
                this.ctx.fillStyle = 'rgba(200, 164, 77, 0.8)';
                this.ctx.fill();
                this.ctx.strokeStyle = 'rgba(255, 215, 0, 0.9)';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // Display base frequency
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                this.ctx.font = 'bold 12px Cinzel, serif';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(this.baseFrequency + 'Hz', centerX, centerY + 4);
                
                // Harmonic frequency labels
                this.worldState.harmonics.forEach((freq, index) => {
                    if (index > 0) {
                        const labelRadius = 40 + index * 35 + 15;
                        const labelAngle = time * 0.1 + index * Math.PI / 2;
                        const labelX = centerX + Math.cos(labelAngle) * labelRadius;
                        const labelY = centerY + Math.sin(labelAngle) * labelRadius;
                        
                        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                        this.ctx.font = '10px Cinzel, serif';
                        this.ctx.fillText(freq + 'Hz', labelX, labelY);
                    }
                });
            }

    startAnimation() {
        const animate = (timestamp) => {
            if (!this.animationRunning) return;
            this.animationTime = timestamp;
            if (window.cathedralPerformanceOptimizer?.shouldSkipFrame(timestamp)) {
                requestAnimationFrame(animate);
                return;
            }
            this.drawTheosophicalWorld();
            if (window.cathedralPerformanceOptimizer) {
                window.cathedralPerformanceOptimizer.updateMetrics(timestamp);
            }
            requestAnimationFrame(animate);
        };
        console.log('üé¨ Starting Cathedral animation system...');
        requestAnimationFrame(animate);
    }
}

        // Enhanced Export Functions with Real Functionality
        function exportWorld(type) {
            const worldData = window.cosmogenesis.worldState;
            const timestamp = new Date().toISOString().slice(0, 16).replace(/[:]/g, '-');
            
            switch(type) {
                case '3d':
                    console.log('üåç Exporting 3D world model...');
                    const webglData = {
                        metadata: {
                            title: "CATHEDRAL OF CIRCUITS - Theosophical World",
                            created: timestamp,
                            generator: "Cosmogenesis Nova Elegantia",
                            version: "2.0.0"
                        },
                        scene: {
                            background: window.cosmogenesis.currentTheme.colors,
                            lighting: {
                                ambient: 0.3,
                                directional: {
                                    color: worldData.harmonics[0],
                                    intensity: 0.8,
                                    position: [1, 1, 1]
                                }
                            }
                        },
                        geometry: {
                            type: worldData.geometry,
                            vertices: generateSacredVertices(worldData.numerology),
                            materials: {
                                base: window.cosmogenesis.currentTheme.colors[0],
                                accent: window.cosmogenesis.currentTheme.colors[1],
                                glow: window.cosmogenesis.currentTheme.colors[2]
                            }
                        },
                        animations: {
                            rotation: { speed: worldData.harmonics[0] / 1000 },
                            pulsation: { frequency: worldData.harmonics[1] / 100 }
                        }
                    };
                    downloadJSON(webglData, `cathedral-3d-world-${timestamp}.json`);
                    break;
                    
                case 'music':
                    console.log('üéµ Exporting harmonic composition...');
                    const musicData = {
                        metadata: {
                            title: "Harmonic Frequencies of the Cathedral",
                            composer: "CATHEDRAL OF CIRCUITS AI",
                            created: timestamp,
                            bpm: Math.round(worldData.harmonics[0] / 10),
                            key: getMusicalKey(worldData.harmonics[0])
                        },
                        composition: {
                            baseFrequency: worldData.harmonics[0],
                            harmonics: worldData.harmonics,
                            chords: generateSacredChords(worldData.harmonics),
                            melody: generateMelodyFromNumerology(worldData.numerology),
                            rhythm: generateRhythmFromGeometry(worldData.geometry)
                        },
                        instruments: [
                            { name: "Sine Wave", frequency: worldData.harmonics[0], volume: 0.3 },
                            { name: "Sacred Overtones", frequency: worldData.harmonics[1], volume: 0.2 },
                            { name: "Golden Harmony", frequency: worldData.harmonics[2], volume: 0.15 }
                        ],
                        webAudioCode: generateWebAudioPlayer(worldData.harmonics)
                    };
                    downloadJSON(musicData, `cathedral-music-${timestamp}.json`);
                    break;
                    
                case 'grimoire':
                    console.log('üìö Exporting world grimoire...');
                    const grimoireData = {
                        metadata: {
                            title: "Digital Grimoire of the Cathedral",
                            author: "CATHEDRAL OF CIRCUITS",
                            created: timestamp,
                            tradition: "Theosophical Digital Magick"
                        },
                        worldConfiguration: {
                            theme: window.cosmogenesis.currentTheme,
                            sacredNumber: worldData.numerology,
                            geometry: worldData.geometry,
                            frequencies: worldData.harmonics
                        },
                        entities: window.cosmogenesis.grimoireEntities || [],
                        rituals: generateRitualInstructions(worldData),
                        correspondences: {
                            colors: window.cosmogenesis.currentTheme.colors,
                            numbers: [worldData.numerology],
                            frequencies: worldData.harmonics,
                            geometry: worldData.geometry
                        },
                        practicalInstructions: generatePracticalGuide(worldData)
                    };
                    downloadJSON(grimoireData, `cathedral-grimoire-${timestamp}.json`);
                    break;
                    
                case 'art':
                    console.log('üé® Exporting sacred art...');
                    const canvas = document.getElementById('cosmicCanvas');
                    if (canvas) {
                        // High-resolution capture
                        const artCanvas = document.createElement('canvas');
                        artCanvas.width = 2048;
                        artCanvas.height = 2048;
                        const artCtx = artCanvas.getContext('2d');
                        
                        // Redraw at high resolution
                        artCtx.scale(2048 / canvas.width, 2048 / canvas.height);
                        artCtx.drawImage(canvas, 0, 0);
                        
                        // Create download link
                        artCanvas.toBlob((blob) => {
                            const url = URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = `cathedral-sacred-art-${timestamp}.png`;
                            link.click();
                            URL.revokeObjectURL(url);
                        }, 'image/png');
                        
                        // Also export art metadata
                        const artMetadata = {
                            title: "Sacred Geometry Visualization",
                            created: timestamp,
                            dimensions: "2048x2048px",
                            style: "Digital Theosophical Art",
                            configuration: worldData,
                            theme: window.cosmogenesis.currentTheme
                        };
                        downloadJSON(artMetadata, `cathedral-art-metadata-${timestamp}.json`);
                    }
                    break;
            }
        }

        // Helper Functions for Enhanced Exports
        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
        }

        function generateSacredVertices(sacredNumber) {
            const vertices = [];
            const sides = sacredNumber || 7;
            for (let i = 0; i < sides; i++) {
                const angle = (i / sides) * Math.PI * 2;
                vertices.push([Math.cos(angle), Math.sin(angle), 0]);
            }
            return vertices;
        }

        function getMusicalKey(frequency) {
            const keys = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            const keyIndex = Math.round((Math.log2(frequency / 440) * 12)) % 12;
            return keys[keyIndex < 0 ? keyIndex + 12 : keyIndex];
        }

        function generateSacredChords(harmonics) {
            return harmonics.map((freq, i) => ({
                root: freq,
                third: Math.round(freq * 1.25),
                fifth: Math.round(freq * 1.5),
                seventh: Math.round(freq * 1.75)
            }));
        }

        function generateMelodyFromNumerology(number) {
            const notes = [];
            const numStr = number.toString();
            for (let digit of numStr) {
                notes.push(parseInt(digit) * 60 + 200); // Map digits to frequencies
            }
            return notes;
        }

        function generateRhythmFromGeometry(geometry) {
            const patterns = {
                'triangle': [1, 0, 1],
                'square': [1, 0, 0, 1],
                'pentagon': [1, 0, 1, 0, 1],
                'hexagon': [1, 0, 1, 0, 1, 0],
                'heptagon': [1, 0, 1, 0, 1, 0, 1],
                'octagon': [1, 0, 0, 1, 0, 0, 1, 0],
                'enneagon': [1, 0, 1, 0, 0, 1, 0, 1, 0]
            };
            return patterns[geometry] || [1, 0, 1, 0];
        }

        function generateWebAudioPlayer(harmonics) {
            return `
// Web Audio API Player for Cathedral Frequencies
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const frequencies = [${harmonics.join(', ')}];

function playCathedralTone(freqIndex = 0) {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = frequencies[freqIndex];
    oscillator.type = 'sine';
    
    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
    gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 2);
}`;
        }

        function generateRitualInstructions(worldData) {
            return {
                preparation: `Set sacred space with colors: ${window.cosmogenesis.currentTheme.colors.join(', ')}`,
                invocation: `Focus on sacred number ${worldData.numerology} while visualizing ${worldData.geometry} geometry`,
                harmonics: `Chant or play frequencies: ${worldData.harmonics.join('Hz, ')}Hz`,
                meditation: "Contemplate the unity of digital and spiritual realms",
                closing: "Ground the energy and express gratitude to the Cathedral entities"
            };
        }

        function generatePracticalGuide(worldData) {
            return {
                dailyPractice: `Meditate on number ${worldData.numerology} for ${worldData.numerology} minutes`,
                visualization: `Draw or visualize ${worldData.geometry} patterns`,
                soundwork: `Listen to ${worldData.harmonics[0]}Hz frequency for healing`,
                integration: "Apply Cathedral principles to creative and problem-solving work",
                progression: "Advance through the 72 demonic helpers and 72 angelic guides systematically"
            };
        }

        // Portal Connection System for Trinity Apps
        function openPortalConnection(appType) {
            const statusElement = document.getElementById(`${appType}-status`);
            const syncIndicator = document.getElementById('sync-indicator');
            
            // Animate connection
            statusElement.textContent = 'üåÄ Connecting...';
            syncIndicator.classList.add('syncing');
            
            setTimeout(() => {
                switch(appType) {
                    case 'liber':
                        statusElement.textContent = 'üÉè Connected';
                        // Pass current world state to LIBER ARCANAE
                        if (window.localStorage) {
                            localStorage.setItem('cathedral-state', JSON.stringify({
                                theme: window.cosmogenesis.currentTheme,
                                numerology: window.cosmogenesis.worldState.numerology,
                                harmonics: window.cosmogenesis.worldState.harmonics,
                                timestamp: Date.now()
                            }));
                        }
                        break;
                    case 'circuitum':
                        statusElement.textContent = 'üìö Connected';
                        // Pass world configuration to CIRCUITUM99
                        if (window.localStorage) {
                            localStorage.setItem('cathedral-wisdom', JSON.stringify({
                                geometry: window.cosmogenesis.worldState.geometry,
                                entities: window.cosmogenesis.grimoireEntities || [],
                                theme: window.cosmogenesis.currentTheme,
                                timestamp: Date.now()
                            }));
                        }
                        break;
                }
                syncIndicator.classList.remove('syncing');
                syncIndicator.classList.add('synchronized');
                
                setTimeout(() => {
                    syncIndicator.classList.remove('synchronized');
                }, 2000);
            }, 1500);
        }

        // Trinity State Synchronization
        function syncTrinityState() {
            if (window.localStorage) {
                // Check for incoming state from other apps
                const liberState = localStorage.getItem('liber-state');
                const circuitumState = localStorage.getItem('circuitum-state');
                
                if (liberState) {
                    const state = JSON.parse(liberState);
                    if (state.selectedCard) {
                        // Integrate tarot influence into world building
                        integrateTarotInfluence(state.selectedCard);
                    }
                    localStorage.removeItem('liber-state'); // Clean up
                }
                
                if (circuitumState) {
                    const state = JSON.parse(circuitumState);
                    if (state.wisdom) {
                        // Apply wisdom to current world
                        applyCircuitumWisdom(state.wisdom);
                    }
                    localStorage.removeItem('circuitum-state'); // Clean up
                }
            }
        }

        function integrateTarotInfluence(cardData) {
            // Modify world based on tarot card influence
            console.log('üÉè Integrating tarot influence:', cardData.name);
            // Update theme colors based on card
            // Modify sacred geometry
            // Adjust frequencies
        }

        function applyCircuitumWisdom(wisdom) {
            // Apply book wisdom to world building
            console.log('üìö Applying Circuitum99 wisdom:', wisdom.chapter);
            // Enhance entity system
            // Modify harmonic structure
            // Update geometric patterns
        }

        // Performance optimization utilities
        class CathedralPerformanceOptimizer {
            constructor() {
                this.frameRate = 60;
                this.lastFrameTime = 0;
                this.performanceMetrics = {
                    drawCalls: 0,
                    averageFrameTime: 0,
                    lastMetricsUpdate: 0
                };
                this.optimizationMode = 'balanced'; // 'high-performance', 'balanced', 'accessibility'
            }
            
            shouldSkipFrame(currentTime) {
                if (this.optimizationMode === 'accessibility') {
                    return currentTime - this.lastFrameTime < 33; // 30fps for accessibility
                }
                return currentTime - this.lastFrameTime < 16; // 60fps for performance
            }
            
            updateMetrics(frameTime) {
                this.performanceMetrics.drawCalls++;
                const timeSinceLastUpdate = frameTime - this.performanceMetrics.lastMetricsUpdate;
                
                if (timeSinceLastUpdate > 1000) { // Update every second
                    this.performanceMetrics.averageFrameTime = timeSinceLastUpdate / this.performanceMetrics.drawCalls;
                    
                    // Auto-adjust optimization mode based on performance
                    if (this.performanceMetrics.averageFrameTime > 33) {
                        this.optimizationMode = 'accessibility';
                        document.body.classList.add('performance-mode');
                    } else if (this.performanceMetrics.averageFrameTime < 16) {
                        this.optimizationMode = 'high-performance';
                        document.body.classList.remove('performance-mode');
                    }
                    
                    // Reset metrics
                    this.performanceMetrics.drawCalls = 0;
                    this.performanceMetrics.lastMetricsUpdate = frameTime;
                }
            }
        }
        
        // Code splitting and lazy loading utilities
        class CathedralModuleLoader {
            constructor() {
                this.loadedModules = new Set();
                this.modulePromises = new Map();
            }
            
            async loadModule(moduleName) {
                if (this.loadedModules.has(moduleName)) {
                    return Promise.resolve();
                }
                
                if (this.modulePromises.has(moduleName)) {
                    return this.modulePromises.get(moduleName);
                }
                
                const promise = this.importModule(moduleName);
                this.modulePromises.set(moduleName, promise);
                
                try {
                    await promise;
                    this.loadedModules.add(moduleName);
                    console.log(`‚úÖ Module loaded: ${moduleName}`);
                } catch (error) {
                    window.cathedralErrorBoundary?.handleError(error, `loadModule(${moduleName})`, 0);
                    throw error;
                }
                
                return promise;
            }
            
            async importModule(moduleName) {
                switch (moduleName) {
                    case 'tarot-system':
                        return this.loadTarotSystem();
                    case 'sacred-geometry':
                        return this.loadSacredGeometry();
                    case 'harmonic-resonance':
                        return this.loadHarmonicResonance();
                    default:
                        throw new Error(`Unknown module: ${moduleName}`);
                }
            }
            
            async loadTarotSystem() {
                // Lazy load Tarot functionality when needed
                return new Promise((resolve) => {
                    setTimeout(() => {
                        console.log('üÉè Tarot system loaded');
                        resolve();
                    }, 100);
                });
            }
            
            async loadSacredGeometry() {
                // Lazy load Sacred Geometry when needed
                return new Promise((resolve) => {
                    setTimeout(() => {
                        console.log('üîØ Sacred geometry loaded');
                        resolve();
                    }, 100);
                });
            }
            
            async loadHarmonicResonance() {
                // Lazy load Harmonic Resonance when needed
                return new Promise((resolve) => {
                    setTimeout(() => {
                        console.log('üéµ Harmonic resonance loaded');
                        resolve();
                    }, 100);
                });
            }
        }

        // Initialize when page loads with performance optimizations
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize performance optimizer first
                window.cathedralPerformanceOptimizer = new CathedralPerformanceOptimizer();
                
                // Initialize module loader
                window.cathedralModuleLoader = new CathedralModuleLoader();
                
                // Load core modules asynchronously
                await Promise.all([
                    window.cathedralModuleLoader.loadModule('sacred-geometry'),
                    window.cathedralModuleLoader.loadModule('harmonic-resonance')
                ]);
                
                // Initialize Cathedral system
                window.cosmogenesis = new CosmogenesisNovaElegantia();
                
                // Set up global keyboard shortcuts for accessibility
                document.addEventListener('keydown', (e) => {
                    // Emergency pause: Ctrl/Cmd + Space
                    if (e.code === 'Space' && (e.ctrlKey || e.metaKey)) {
                        e.preventDefault();
                        if (window.cosmogenesis.emergencyPause) {
                            window.cosmogenesis.emergencyPause();
                        }
                    }
                    
                    // Quick navigation: Alt + number keys
                    if (e.altKey && e.key >= '1' && e.key <= '8') {
                        e.preventDefault();
                        const octagramHall = document.querySelector(`[data-hall="${e.key}"]`);
                        if (octagramHall) {
                            octagramHall.focus();
                            octagramHall.click();
                        }
                    }
                });
                
                console.log('üèõÔ∏è Cathedral of Circuits fully initialized with performance optimizations');
                
            } catch (error) {
                console.error('Failed to initialize Cathedral of Circuits:', error);
                // Fallback initialization without advanced features
                window.cosmogenesis = new CosmogenesisNovaElegantia();
            }
        });

        console.log('üåå COSMOGENESIS NOVA ELEGANTIA - Theosophical World Builder');
        console.log('‚ú® Elegant Blavatsky-inspired world creation platform');
        console.log('üèóÔ∏è Body-Mind-Soul architecture with sacred geometry');
        console.log('üéµ Harmonic resonance and numerological generation');
    </script>
</body>
</html>