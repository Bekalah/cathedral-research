<!DOCTYPE html>
<html lang="en">
    <head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CIRCUITUM99: ALPHA ET OMEGA - Living Tarot Universe | CATHEDRAL OF CIRCUITS</title>
            <meta name="description" content="Interactive living tarot archetypes in an open-world narrative experience">
            <style>
                * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                }
                :root {
                /* Core Palette from perm-style.json */
                --void: #0B0B0B;
                --ink: #141414;
                --bone: #F8F5EF;
                --violet-core: #7A33FF;
                --violet-flare: #B39CFF;
                --violet-smoke: #442266;
                --violet-aura: #2C0A52;
                --gold-leaf: #C8A44D;
                --grail-gold: #CBB866;
                --pearl-white: #F5F2EA;
                --pearl-rose: #F4C9D9;
                --pearl-aqua: #BFE9E7;
                --pearl-lilac: #CDB8F6;
                --astral-mist: #B7C9FF;
                --astral-silver: #C9D1E7;
                --astral-violet: #9E8BFF;
                --teal-glow: #00CED1;
                --ember-core: #FF6A00;
                --avalon-mist: #CFE6F2;
                --avalon-night: #0C1521;
                --threshold-glow: #98FFE2;
                --obsidian-glass: #0f1014;
                --obsidian-sheen: #191b22;
                --obsidian-rainbow: #33214e;
                --raku-copper: #b87333;
                --raku-violet: #6E00FF;
                --raku-azure: #1F7AF3;
                }
                body {
                font-family: 'Georgia', 'EB Garamond', serif;
                background: radial-gradient(ellipse at center, var(--void) 0%, var(--obsidian-glass) 50%, var(--violet-aura) 100%);
                color: var(--bone);
                overflow: hidden;
                position: relative;
                height: 100vh;
                }
                /* Violet Gate Background Aura */
                .violet-gate-bg {
                position: fixed;
                top: 50%;
                left: 50%;
                width: min(90vw, 900px);
                height: min(90vw, 900px);
                transform: translate(-50%, -50%);
                z-index: 0;
                opacity: 0.08;
                pointer-events: none;
                border-radius: 50%;
                background:
                radial-gradient(40% 40% at 50% 60%, var(--violet-core), transparent 60%),
                radial-gradient(80% 60% at 50% 40%, color-mix(in oklab, var(--violet-flare), transparent 35%), transparent 70%),
                conic-gradient(from 0deg, rgba(122, 51, 255, .35), rgba(179, 156, 255, .22), rgba(68, 34, 102, .35));
                filter: blur(20px);
                }
                /* Sacred Geometry Canvas */
                #cosmicCanvas {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 1;
                }
                /* Oracle Velvet Control Panel */
                .control-cathedral {
                position: fixed;
                top: 20px;
                right: 20px;
                width: 420px;
                background: linear-gradient(180deg, #0A0A0F, #0F1020);
                filter: saturate(1.02) contrast(1.02);
                border: 1px solid rgba(255, 255, 255, .06);
                border-radius: 14px;
                padding: 25px;
                box-shadow:
                inset 0 1px 0 rgba(255, 255, 255, .06),
                0 18px 44px rgba(0, 0, 0, .65);
                backdrop-filter: blur(20px);
                z-index: 100;
                max-height: calc(100vh - 40px);
                overflow-y: auto;
                }
                /* Living Story Interface */
                .story-panel {
                position: fixed;
                top: 20px;
                left: 20px;
                width: 500px;
                background: linear-gradient(180deg, #0A0A0F, #0F1020);
                border: 1px solid rgba(200, 164, 77, 0.3);
                border-radius: 14px;
                padding: 25px;
                box-shadow:
                inset 0 1px 0 rgba(200, 164, 77, 0.1),
                0 18px 44px rgba(0, 0, 0, .65);
                backdrop-filter: blur(20px);
                z-index: 100;
                max-height: calc(100vh - 40px);
                overflow-y: auto;
                }
                .story-title {
                font-size: 1.2em;
                color: var(--gold-leaf);
                text-shadow: 0 0 10px rgba(200, 164, 77, 0.5);
                margin-bottom: 15px;
                font-family: 'Cinzel', 'Georgia', serif;
                letter-spacing: 2px;
                }
                .story-text {
                color: var(--pearl-white);
                line-height: 1.6;
                margin-bottom: 20px;
                font-size: 0.95em;
                }
                .choice-container {
                display: flex;
                flex-direction: column;
                gap: 10px;
                }
                .story-choice {
                padding: 12px 16px;
                border: 1px solid rgba(122, 51, 255, 0.3);
                border-radius: 8px;
                background: rgba(122, 51, 255, 0.05);
                color: var(--pearl-white);
                cursor: pointer;
                transition: all 0.3s;
                font-size: 0.9rem;
                }
                .story-choice:hover {
                background: rgba(122, 51, 255, 0.15);
                border-color: var(--violet-flare);
                transform: translateX(5px);
                }
                /* Character Portrait Area */
                .character-portrait {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: 300px;
                height: 400px;
                border: 2px solid var(--gold-leaf);
                border-radius: 12px;
                background: linear-gradient(135deg, #0A0A0F, #1A1A2E);
                overflow: hidden;
                z-index: 90;
                display: none; /* Hidden initially */
                }
                .character-portrait.active {
                display: block;
                animation: portraitAppear 0.8s ease-out;
                }
                @keyframes portraitAppear {
                from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
                }
                to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
                }
                }
                .portrait-canvas {
                width: 100%;
                height: 80%;
                }
                .character-info {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(transparent, rgba(0,0,0,0.8));
                padding: 15px;
                color: var(--pearl-white);
                }
                .character-name {
                font-size: 1.1em;
                color: var(--gold-leaf);
                font-weight: bold;
                margin-bottom: 5px;
                }
                .character-essence {
                font-size: 0.85em;
                opacity: 0.9;
                font-style: italic;
                }
                /* Wellness Dashboard */
                .wellness-dashboard {
                margin-top: 25px;
                padding-top: 20px;
                border-top: 1px solid rgba(122, 51, 255, 0.2);
                }
                .wellness-meter {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                }
                .wellness-label {
                width: 120px;
                font-size: 0.8em;
                color: var(--pearl-white);
                }
                .wellness-bar {
                flex: 1;
                height: 6px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 3px;
                overflow: hidden;
                margin-left: 10px;
                }
                .wellness-fill {
                height: 100%;
                background: linear-gradient(90deg, var(--violet-core), var(--gold-leaf));
                border-radius: 3px;
                transition: width 0.5s ease;
                }
                /* Toggle Health Indicators */
                .toggle-health {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 12px;
                margin: 5px 0;
                border-radius: 6px;
                font-size: 0.85em;
                }
                .toggle-health.optimal {
                background: rgba(46, 125, 50, 0.2);
                border-left: 3px solid #2E7D32;
                }
                .toggle-health.attention {
                background: rgba(255, 193, 7, 0.2);
                border-left: 3px solid #FFC107;
                }
                .toggle-health.critical {
                background: rgba(244, 67, 54, 0.2);
                border-left: 3px solid #F44336;
                }
                .control-cathedral h2 {
                font-size: 1.4em;
                margin-bottom: 20px;
                color: var(--gold-leaf);
                text-shadow: 0 0 10px rgba(200, 164, 77, 0.5);
                font-weight: normal;
                letter-spacing: 3px;
                font-family: 'Cinzel', 'Georgia', serif;
                }
                /* Adventure Mode Selector */
                .adventure-modes {
                display: flex;
                flex-direction: column;
                gap: 10px;
                margin-bottom: 20px;
                }
                .mode-chip {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px 12px;
                border: 1px solid rgba(255, 255, 255, .1);
                border-radius: 999px;
                background: rgba(255, 255, 255, .02);
                color: var(--pearl-white);
                cursor: pointer;
                transition: all 0.3s;
                font-size: 0.9rem;
                }
                .mode-chip:hover {
                background: rgba(122, 51, 255, 0.1);
                border-color: var(--violet-flare);
                transform: translateX(5px);
                }
                .mode-chip.active {
                background: linear-gradient(135deg, var(--violet-core), var(--violet-flare));
                border-color: var(--gold-leaf);
                color: var(--void);
                }
                /* Solfeggio Frequencies */
                .solfeggio-panel {
                margin-top: 25px;
                padding-top: 20px;
                border-top: 1px solid rgba(200, 164, 77, 0.2);
                }
                .solfeggio-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                margin-bottom: 15px;
                }
                .solfeggio-chip {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 8px 4px;
                border: 1px solid rgba(255, 255, 255, .10);
                border-radius: 8px;
                background: rgba(255, 255, 255, .04);
                cursor: pointer;
                transition: all 0.3s;
                font-size: 0.75rem;
                }
                .solfeggio-chip:hover {
                background: rgba(122, 51, 255, 0.15);
                transform: translateY(-2px);
                }
                .solfeggio-chip.active {
                background: linear-gradient(135deg, var(--violet-core), var(--violet-flare));
                color: var(--void);
                }
                /* Export Panel */
                .export-panel {
                position: fixed;
                bottom: 30px;
                right: 30px;
                z-index: 100;
                display: flex;
                gap: 10px;
                }
                .export-btn {
                padding: 12px 24px;
                background: linear-gradient(135deg, var(--violet-core), var(--violet-flare));
                border: none;
                border-radius: 25px;
                color: var(--void);
                font-weight: bold;
                cursor: pointer;
                font-family: 'Georgia', serif;
                font-size: 0.95em;
                transition: all 0.3s;
                box-shadow: 0 4px 15px rgba(122, 51, 255, 0.3);
                }
                .export-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(122, 51, 255, 0.5);
                }
                /* Responsive Design */
                @media (max-width: 1200px) {
                .control-cathedral {
                width: 350px;
                }
                .story-panel {
                width: 400px;
                }
                }
                @media (max-width: 900px) {
                .control-cathedral {
                width: calc(100% - 20px);
                right: 10px;
                top: 10px;
                max-height: 30vh;
                }
                .story-panel {
                width: calc(100% - 20px);
                left: 10px;
                top: calc(30vh + 30px);
                max-height: calc(40vh - 40px);
                }
                .character-portrait {
                width: 250px;
                height: 320px;
                bottom: 10px;
                }
                }
                @media (max-width: 600px) {
                .character-portrait {
                width: calc(100% - 20px);
                height: 250px;
                left: 10px;
                transform: none;
                bottom: 10px;
                }
                .wellness-dashboard {
                display: none; /* Hide on very small screens to save space */
                }
                }
                /* Open World CYOA Mode Toggle */
                .cyoa-mode-toggle {
                position: fixed;
                top: 50%;
                right: -250px;
                transform: translateY(-50%);
                width: 300px;
                background: linear-gradient(180deg, #0A0A0F, #1A0A2E);
                border: 2px solid var(--violet-core);
                border-radius: 15px 0 0 15px;
                padding: 20px;
                transition: right 0.5s ease;
                z-index: 95;
                color: var(--pearl-white);
                }
                .cyoa-mode-toggle.active {
                right: 0;
                }
                .cyoa-toggle-button {
                position: absolute;
                left: -40px;
                top: 50%;
                transform: translateY(-50%);
                width: 40px;
                height: 80px;
                background: var(--violet-core);
                border: none;
                border-radius: 10px 0 0 10px;
                color: white;
                cursor: pointer;
                writing-mode: vertical-rl;
                text-orientation: mixed;
                font-size: 0.8em;
                }
                /* Tree of Life Navigator */
                .tree-navigator {
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid rgba(122, 51, 255, 0.3);
                }
                .tree-node {
                display: inline-block;
                width: 30px;
                height: 30px;
                border: 1px solid var(--gold-leaf);
                border-radius: 50%;
                margin: 3px;
                cursor: pointer;
                text-align: center;
                line-height: 28px;
                font-size: 0.7em;
                transition: all 0.3s;
                }
                .tree-node:hover {
                background: var(--gold-leaf);
                color: var(--void);
                transform: scale(1.1);
                }
                .tree-node.active {
                background: linear-gradient(135deg, var(--violet-core), var(--gold-leaf));
                color: white;
                }
            </style>
        </head>
        <body>
            <!-- Violet Gate Background -->
            <div class="violet-gate-bg">
            </div>
            <!-- Sacred Geometry Canvas -->
            <canvas id="cosmicCanvas">
            </canvas>
            <!-- Living Story Panel -->
            <div class="story-panel" id="storyPanel">
                <div class="story-title" id="storyTitle">The Eternal Beginning</div>
                    <div class="story-text" id="storyText">
                        Rebecca Respawn stands at the center of an impossible garden where doors of every description bloom like flowers. Each door leads to a different story, a different choice, a different way of being. The Spiral Key in her hand hums with the frequency of infinite possibility.
                    </div>
                    <div class="choice-container" id="choiceContainer">
                        <!-- Choices will be populated by the engine -->
                    </div>
                </div>
                <!-- Character Portrait -->
                <div class="character-portrait" id="characterPortrait">
                    <canvas class="portrait-canvas" id="portraitCanvas">
                    </canvas>
                    <div class="character-info">
                        <div class="character-name" id="characterName">Rebecca Respawn</div>
                            <div class="character-essence" id="characterEssence">Quantum consciousness across all realities</div>
                            </div>
                        </div>
                        <!-- Control Cathedral -->
                        <div class="control-cathedral">
                            <h2>CIRCUITUM99: ALPHA ET OMEGA</h2>
                                <p style="font-size: 0.8em; opacity: 0.8; margin: -15px 0 20px 0; letter-spacing: 2px;">Sacred Geometry • Healing Frequencies • Cosmic Harmony</p>
                                    <!-- Adventure Modes -->
                                    <div class="adventure-modes">
                                        <div class="mode-chip active" data-mode="hermetic" onclick="setMode('hermetic')">
                                            <span>Hermetic Alchemy</span>
                                            </div>
                                            <div class="mode-chip" data-mode="tree" onclick="setMode('tree')">
                                                <span>Tree of Life</span>
                                                </div>
                                                <div class="mode-chip" data-mode="aeons" onclick="setMode('aeons')">
                                                    <span>Theosophical Aeons</span>
                                                    </div>
                                                    <div class="mode-chip" data-mode="avalon" onclick="setMode('avalon')">
                                                        <span>Avalon Current</span>
                                                        </div>
                                                    </div>
                                                    <!-- Solfeggio Frequencies -->
                                                    <div class="solfeggio-panel">
                                                        <h3 style="font-size: 0.9em; margin-bottom: 10px; color: var(--gold-leaf);">Solfeggio Healing</h3>
                                                            <div class="solfeggio-grid">
                                                                <div class="solfeggio-chip" data-freq="396" onclick="setFrequency(396)">
                                                                    <span class="freq">396 Hz</span>
                                                                        <span class="theme">Liberation</span>
                                                                        </div>
                                                                        <div class="solfeggio-chip" data-freq="417" onclick="setFrequency(417)">
                                                                            <span class="freq">417 Hz</span>
                                                                                <span class="theme">Transmute</span>
                                                                                </div>
                                                                                <div class="solfeggio-chip" data-freq="432" onclick="setFrequency(432)">
                                                                                    <span class="freq">432 Hz</span>
                                                                                        <span class="theme">Heart</span>
                                                                                        </div>
                                                                                        <div class="solfeggio-chip active" data-freq="528" onclick="setFrequency(528)">
                                                                                            <span class="freq">528 Hz</span>
                                                                                                <span class="theme">Repattern</span>
                                                                                                </div>
                                                                                                <div class="solfeggio-chip" data-freq="639" onclick="setFrequency(639)">
                                                                                                    <span class="freq">639 Hz</span>
                                                                                                        <span class="theme">Relational</span>
                                                                                                        </div>
                                                                                                        <div class="solfeggio-chip" data-freq="741" onclick="setFrequency(741)">
                                                                                                            <span class="freq">741 Hz</span>
                                                                                                                <span class="theme">Clarity</span>
                                                                                                                </div>
                                                                                                                <div class="solfeggio-chip" data-freq="852" onclick="setFrequency(852)">
                                                                                                                    <span class="freq">852 Hz</span>
                                                                                                                        <span class="theme">Intuition</span>
                                                                                                                        </div>
                                                                                                                        <div class="solfeggio-chip" data-freq="963" onclick="setFrequency(963)">
                                                                                                                            <span class="freq">963 Hz</span>
                                                                                                                                <span class="theme">Unitive</span>
                                                                                                                                </div>
                                                                                                                            </div>
                                                                                                                        </div>
                                                                                                                        <!-- Wellness Dashboard -->
                                                                                                                        <div class="wellness-dashboard">
                                                                                                                            <h3 style="font-size: 0.9em; margin-bottom: 15px; color: var(--gold-leaf);">Wellness Metrics</h3>
                                                                                                                                <div class="wellness-meter">
                                                                                                                                    <span class="wellness-label">Overall Health</span>
                                                                                                                                        <div class="wellness-bar">
                                                                                                                                            <div class="wellness-fill" id="overallWellness" style="width: 75%">
                                                                                                                                            </div>
                                                                                                                                        </div>
                                                                                                                                    </div>
                                                                                                                                    <div class="wellness-meter">
                                                                                                                                        <span class="wellness-label">Emotional Balance</span>
                                                                                                                                            <div class="wellness-bar">
                                                                                                                                                <div class="wellness-fill" id="emotionalBalance" style="width: 80%">
                                                                                                                                                </div>
                                                                                                                                            </div>
                                                                                                                                        </div>
                                                                                                                                        <div class="wellness-meter">
                                                                                                                                            <span class="wellness-label">Creative Flow</span>
                                                                                                                                                <div class="wellness-bar">
                                                                                                                                                    <div class="wellness-fill" id="creativeFlow" style="width: 60%">
                                                                                                                                                    </div>
                                                                                                                                                </div>
                                                                                                                                            </div>
                                                                                                                                            <div class="wellness-meter">
                                                                                                                                                <span class="wellness-label">Mystical Resonance</span>
                                                                                                                                                    <div class="wellness-bar">
                                                                                                                                                        <div class="wellness-fill" id="mysticalResonance" style="width: 90%">
                                                                                                                                                        </div>
                                                                                                                                                    </div>
                                                                                                                                                </div>
                                                                                                                                                <!-- Toggle Health Status -->
                                                                                                                                                <h4 style="font-size: 0.85em; margin: 15px 0 10px 0; color: var(--gold-leaf);">System Health</h4>
                                                                                                                                                    <div class="toggle-health optimal" id="narrativePaceHealth">
                                                                                                                                                        <span>Story Pace</span>
                                                                                                                                                            <span>Optimal</span>
                                                                                                                                                            </div>
                                                                                                                                                            <div class="toggle-health optimal" id="emotionalIntensityHealth">
                                                                                                                                                                <span>Emotional Depth</span>
                                                                                                                                                                    <span>Balanced</span>
                                                                                                                                                                    </div>
                                                                                                                                                                    <div class="toggle-health attention" id="challengeLevelHealth">
                                                                                                                                                                        <span>Challenge Level</span>
                                                                                                                                                                            <span>Monitor</span>
                                                                                                                                                                            </div>
                                                                                                                                                                        </div>
                                                                                                                                                                    </div>
                                                                                                                                                                    <!-- CYOA Mode Toggle -->
                                                                                                                                                                    <div class="cyoa-mode-toggle" id="cyoaToggle">
                                                                                                                                                                        <button class="cyoa-toggle-button" onclick="toggleCYOAMode()">EXPLORE</button>
                                                                                                                                                                            <h3 style="font-size: 0.9em; margin-bottom: 10px; color: var(--gold-leaf);">Open World Mode</h3>
                                                                                                                                                                                <!-- Tree of Life Navigator -->
                                                                                                                                                                                <div class="tree-navigator">
                                                                                                                                                                                    <div style="text-align: center; margin-bottom: 10px;">
                                                                                                                                                                                        <small style="color: var(--pearl-white); opacity: 0.8;">Sephirotic Tree</small>
                                                                                                                                                                                        </div>
                                                                                                                                                                                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; max-width: 120px; margin: 0 auto;">
                                                                                                                                                                                            <div>
                                                                                                                                                                                            </div>
                                                                                                                                                                                            <div class="tree-node" data-sephira="keter" title="Keter">כ</div>
                                                                                                                                                                                                <div>
                                                                                                                                                                                                </div>
                                                                                                                                                                                                <div class="tree-node" data-sephira="binah" title="Binah">ב</div>
                                                                                                                                                                                                    <div>
                                                                                                                                                                                                    </div>
                                                                                                                                                                                                    <div class="tree-node" data-sephira="chokmah" title="Chokmah">ח</div>
                                                                                                                                                                                                        <div>
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                        <div class="tree-node active" data-sephira="tiferet" title="Tiferet">ת</div>
                                                                                                                                                                                                            <div>
                                                                                                                                                                                                            </div>
                                                                                                                                                                                                            <div class="tree-node" data-sephira="gevurah" title="Gevurah">ג</div>
                                                                                                                                                                                                                <div>
                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                <div class="tree-node" data-sephira="chesed" title="Chesed">ח</div>
                                                                                                                                                                                                                    <div>
                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                    <div class="tree-node" data-sephira="yesod" title="Yesod">י</div>
                                                                                                                                                                                                                        <div>
                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                        <div>
                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                        <div class="tree-node" data-sephira="malkuth" title="Malkuth">מ</div>
                                                                                                                                                                                                                            <div>
                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                    <!-- Fusion Theme Selector -->
                                                                                                                                                                                                                    <div style="margin-top: 15px;">
                                                                                                                                                                                                                        <h4 style="font-size: 0.8em; margin-bottom: 8px; color: var(--gold-leaf);">Fusion Themes</h4>
                                                                                                                                                                                                                            <select id="fusionThemeSelect" style="width: 100%; padding: 5px; background: rgba(0,0,0,0.5); border: 1px solid var(--violet-core); color: var(--pearl-white); border-radius: 5px;">
                                                                                                                                                                                                                                <option value="quantum_aesthetics">Quantum Aesthetics</option>
                                                                                                                                                                                                                                    <option value="digital_mysticism">Digital Mysticism</option>
                                                                                                                                                                                                                                        <option value="therapeutic_transmutation">Therapeutic Transmutation</option>
                                                                                                                                                                                                                                            <option value="alchemical_synthesis">Alchemical Synthesis</option>
                                                                                                                                                                                                                                            </select>
                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                    <!-- Export Panel -->
                                                                                                                                                                                                                                    <div class="export-panel">
                                                                                                                                                                                                                                        <button class="export-btn" onclick="exportCanvas()">Export Art</button>
                                                                                                                                                                                                                                            <button class="export-btn" onclick="exportStoryState()" style="margin-left: 5px;">Export Story</button>
                                                                                                                                                                                                                                                <button class="export-btn" onclick="exportLivingGallery()" style="margin-left: 5px; background: linear-gradient(135deg, var(--gold-leaf), var(--grail-gold));">Gallery</button>
                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                <script src="circuitum99-living-engine.js">
                                                                                                                                                                                                                                                </script>
                                                                                                                                                                                                                                                <script>
                                                                                                                                                                                                                                                    // Canvas Setup and Sacred Geometry Engine
                                                                                                                                                                                                                                                    const canvas = document.getElementById('cosmicCanvas');
                                                                                                                                                                                                                                                    const ctx = canvas.getContext('2d');
                                                                                                                                                                                                                                                    let width, height, centerX, centerY;
                                                                                                                                                                                                                                                    // Cathedral State Integration with Living Engine
                                                                                                                                                                                                                                                    const cathedral = {
                                                                                                                                                                                                                                                    currentMode: 'hermetic',
                                                                                                                                                                                                                                                    currentFrequency: 528,
                                                                                                                                                                                                                                                    time: 0,
                                                                                                                                                                                                                                                    animationFrame: null,
                                                                                                                                                                                                                                                    // Integration with Circuitum Engine
                                                                                                                                                                                                                                                    livingEngine: null,
                                                                                                                                                                                                                                                    currentCharacter: null,
                                                                                                                                                                                                                                                    currentScene: null
                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                    // Sacred Constants
                                                                                                                                                                                                                                                    const PHI = 1.618033988749895;
                                                                                                                                                                                                                                                    const TWO_PI = Math.PI * 2;
                                                                                                                                                                                                                                                    function setupCanvas() {
                                                                                                                                                                                                                                                    width = canvas.width = window.innerWidth;
                                                                                                                                                                                                                                                    height = canvas.height = window.innerHeight;
                                                                                                                                                                                                                                                    centerX = width / 2;
                                                                                                                                                                                                                                                    centerY = height / 2;
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    function drawSacredGeometry() {
                                                                                                                                                                                                                                                    ctx.clearRect(0, 0, width, height);
                                                                                                                                                                                                                                                    // Set blend mode for luminous effect
                                                                                                                                                                                                                                                    ctx.globalCompositeOperation = 'screen';
                                                                                                                                                                                                                                                    cathedral.time += 0.01;
                                                                                                                                                                                                                                                    switch(cathedral.currentMode) {
                                                                                                                                                                                                                                                    case 'hermetic':
                                                                                                                                                                                                                                                    drawHermeticAlchemy();
                                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                    case 'tree':
                                                                                                                                                                                                                                                    drawTreeOfLife();
                                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                    case 'aeons':
                                                                                                                                                                                                                                                    drawTheosophicalAeons();
                                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                    case 'avalon':
                                                                                                                                                                                                                                                    drawAvalonCurrent();
                                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    ctx.globalCompositeOperation = 'source-over';
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    function drawHermeticAlchemy() {
                                                                                                                                                                                                                                                    // Four Stages of Alchemy
                                                                                                                                                                                                                                                    const stages = [
                                                                                                                                                                                                                                                    { name: 'Nigredo', color: '#1a1a1a', angle: 0 },
                                                                                                                                                                                                                                                    { name: 'Albedo', color: '#e6f0ff', angle: Math.PI / 2 },
                                                                                                                                                                                                                                                    { name: 'Citrinitas', color: '#ffd76a', angle: Math.PI },
                                                                                                                                                                                                                                                    { name: 'Rubedo', color: '#b4455a', angle: 3 * Math.PI / 2 }
                                                                                                                                                                                                                                                    ];
                                                                                                                                                                                                                                                    stages.forEach((stage, i) => {
                                                                                                                                                                                                                                                    const radius = 100 + Math.sin(cathedral.time + i) * 20;
                                                                                                                                                                                                                                                    const x = centerX + Math.cos(stage.angle + cathedral.time * 0.5) * radius;
                                                                                                                                                                                                                                                    const y = centerY + Math.sin(stage.angle + cathedral.time * 0.5) * radius;
                                                                                                                                                                                                                                                    // Draw alchemical circles
                                                                                                                                                                                                                                                    ctx.beginPath();
                                                                                                                                                                                                                                                    ctx.arc(x, y, 30, 0, TWO_PI);
                                                                                                                                                                                                                                                    ctx.strokeStyle = stage.color;
                                                                                                                                                                                                                                                    ctx.lineWidth = 2;
                                                                                                                                                                                                                                                    ctx.stroke();
                                                                                                                                                                                                                                                    // Draw connecting lines
                                                                                                                                                                                                                                                    ctx.beginPath();
                                                                                                                                                                                                                                                    ctx.moveTo(centerX, centerY);
                                                                                                                                                                                                                                                    ctx.lineTo(x, y);
                                                                                                                                                                                                                                                    ctx.strokeStyle = `${stage.color}33`;
                                                                                                                                                                                                                                                    ctx.lineWidth = 1;
                                                                                                                                                                                                                                                    ctx.stroke();
                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                    // Central ouroboros
                                                                                                                                                                                                                                                    ctx.beginPath();
                                                                                                                                                                                                                                                    ctx.arc(centerX, centerY, 50, 0, TWO_PI);
                                                                                                                                                                                                                                                    ctx.strokeStyle = '#C8A44D';
                                                                                                                                                                                                                                                    ctx.lineWidth = 3;
                                                                                                                                                                                                                                                    ctx.stroke();
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    function drawTreeOfLife() {
                                                                                                                                                                                                                                                    // 10 Sephiroth arrangement
                                                                                                                                                                                                                                                    const sephiroth = [
                                                                                                                                                                                                                                                    { name: 'Keter', x: 0, y: -200, color: '#f7f4e6' },
                                                                                                                                                                                                                                                    { name: 'Chokmah', x: -100, y: -100, color: '#d7dfe8' },
                                                                                                                                                                                                                                                    { name: 'Binah', x: 100, y: -100, color: '#b7b0c8' },
                                                                                                                                                                                                                                                    { name: 'Chesed', x: -150, y: 0, color: '#bcd6ff' },
                                                                                                                                                                                                                                                    { name: 'Gevurah', x: 150, y: 0, color: '#f2b6b6' },
                                                                                                                                                                                                                                                    { name: 'Tiferet', x: 0, y: 0, color: '#f1d58c' },
                                                                                                                                                                                                                                                    { name: 'Netzach', x: -100, y: 100, color: '#b4e0a4' },
                                                                                                                                                                                                                                                    { name: 'Hod', x: 100, y: 100, color: '#c4b0ff' },
                                                                                                                                                                                                                                                    { name: 'Yesod', x: 0, y: 150, color: '#c9b3ff' },
                                                                                                                                                                                                                                                    { name: 'Malkuth', x: 0, y: 250, color: '#d0c69c' }
                                                                                                                                                                                                                                                    ];
                                                                                                                                                                                                                                                    // Draw paths between sephiroth
                                                                                                                                                                                                                                                    const paths = [
                                                                                                                                                                                                                                                    [0,1], [0,2], [1,2], [1,3], [2,4], [3,5], [4,5],
                                                                                                                                                                                                                                                    [5,6], [5,7], [6,7], [6,8], [7,8], [8,9]
                                                                                                                                                                                                                                                    ];
                                                                                                                                                                                                                                                    paths.forEach(([a, b]) => {
                                                                                                                                                                                                                                                    const sephA = sephiroth[a];
                                                                                                                                                                                                                                                    const sephB = sephiroth[b];
                                                                                                                                                                                                                                                    ctx.beginPath();
                                                                                                                                                                                                                                                    ctx.moveTo(centerX + sephA.x, centerY + sephA.y);
                                                                                                                                                                                                                                                    ctx.lineTo(centerX + sephB.x, centerY + sephB.y);
                                                                                                                                                                                                                                                    ctx.strokeStyle = `rgba(200, 164, 77, 0.3)`;
                                                                                                                                                                                                                                                    ctx.lineWidth = 1;
                                                                                                                                                                                                                                                    ctx.stroke();
                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                    // Draw sephiroth
                                                                                                                                                                                                                                                    sephiroth.forEach((seph, i) => {
                                                                                                                                                                                                                                                    const pulse = Math.sin(cathedral.time + i * 0.5) * 5;
                                                                                                                                                                                                                                                    ctx.beginPath();
                                                                                                                                                                                                                                                    ctx.arc(centerX + seph.x, centerY + seph.y, 25 + pulse, 0, TWO_PI);
                                                                                                                                                                                                                                                    ctx.fillStyle = seph.color + '33';
                                                                                                                                                                                                                                                    ctx.fill();
                                                                                                                                                                                                                                                    ctx.strokeStyle = seph.color;
                                                                                                                                                                                                                                                    ctx.lineWidth = 2;
                                                                                                                                                                                                                                                    ctx.stroke();
                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                    function drawTheosophicalAeons() {
                                                                                                                                                                                                                                                    // Four great cosmic periods
                                                                                                                                                                                                                                                    const aeons = [
                                                                                                                                                                                                                                                    { name: 'Sat', color: '#B9A8FF', radius: 50 },
                                                                                                                                                                                                                                                    { name: 'Svabhavat', color: '#CFE6F2', radius: 100 },
                                                                                                                                                                                                                                                    { name: 'Manvantara', color: '#FFD76A', radius: 150 },
                                                                                                                                                                                                                                                    { name: 'Pralaya', color: '#1C2029', radius: 200 }
                                                                                                                                                                                                                                                    ];
                                                                                                                                                                                                                                                    aeons.forEach((aeon, i) => {
                                                                                                                                                                                                                                                    const rotation = cathedral.time * (0.1 + i * 0.05);
                                                                                                                                                                                                                                                    ctx.save();
                                                                                                                                                                                                                                                    ctx.translate(centerX, centerY);
                                                                                                                                                                                                                                                    ctx.rotate(rotation);
                                                                                                                                                                                                                                                    ctx.beginPath();
                                                                                                                                                                                                                                                    ctx.arc(0, 0, aeon.radius, 0, TWO_PI);
                                                                                                                                                                                                                                                    ctx.strokeStyle = aeon.color + '66';
                                                                                                                                                                                                                                                    ctx.lineWidth = 2;
                                                                                                                                                                                                                                                    ctx.stroke();
                                                                                                                                                                                                                                                    // Draw emanation points
                                                                                                                                                                                                                                                    for (let j = 0; j < 8; j++) {
                                                                                                                                                                                                                                                        const angle = (j / 8) * TWO_PI;
                                                                                                                                                                                                                                                        const x = Math.cos(angle) * aeon.radius;
                                                                                                                                                                                                                                                        const y = Math.sin(angle) * aeon.radius;
                                                                                                                                                                                                                                                        ctx.beginPath();
                                                                                                                                                                                                                                                        ctx.arc(x, y, 3, 0, TWO_PI);
                                                                                                                                                                                                                                                        ctx.fillStyle = aeon.color;
                                                                                                                                                                                                                                                        ctx.fill();
                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                        ctx.restore();
                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                        function drawAvalonCurrent() {
                                                                                                                                                                                                                                                        // Arthurian mystical geometry
                                                                                                                                                                                                                                                        const spiralCount = 3;
                                                                                                                                                                                                                                                        const maxRadius = 200;
                                                                                                                                                                                                                                                        for (let s = 0; s < spiralCount; s++) {
                                                                                                                                                                                                                                                            ctx.beginPath();
                                                                                                                                                                                                                                                            const spiralOffset = (s / spiralCount) * TWO_PI;
                                                                                                                                                                                                                                                            const spiralColor = ['#CFE6F2', '#98FFE2', '#B7C9FF'][s];
                                                                                                                                                                                                                                                            for (let i = 0; i <= 100; i++) {
                                                                                                                                                                                                                                                                const t = i / 100;
                                                                                                                                                                                                                                                                const angle = t * 6 * Math.PI + spiralOffset + cathedral.time;
                                                                                                                                                                                                                                                                const radius = t * maxRadius * Math.sin(cathedral.time + s);
                                                                                                                                                                                                                                                                const x = centerX + Math.cos(angle) * radius;
                                                                                                                                                                                                                                                                const y = centerY + Math.sin(angle) * radius;
                                                                                                                                                                                                                                                                if (i === 0) {
                                                                                                                                                                                                                                                                ctx.moveTo(x, y);
                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                ctx.lineTo(x, y);
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                ctx.strokeStyle = spiralColor + '66';
                                                                                                                                                                                                                                                                ctx.lineWidth = 2;
                                                                                                                                                                                                                                                                ctx.stroke();
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                // Central grail cup
                                                                                                                                                                                                                                                                ctx.beginPath();
                                                                                                                                                                                                                                                                ctx.arc(centerX, centerY, 30, 0, TWO_PI);
                                                                                                                                                                                                                                                                ctx.strokeStyle = '#CBB866';
                                                                                                                                                                                                                                                                ctx.lineWidth = 3;
                                                                                                                                                                                                                                                                ctx.stroke();
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                function animate() {
                                                                                                                                                                                                                                                                drawSacredGeometry();
                                                                                                                                                                                                                                                                cathedral.animationFrame = requestAnimationFrame(animate);
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                function setMode(mode) {
                                                                                                                                                                                                                                                                cathedral.currentMode = mode;
                                                                                                                                                                                                                                                                // Update UI
                                                                                                                                                                                                                                                                document.querySelectorAll('.mode-chip').forEach(chip => {
                                                                                                                                                                                                                                                                chip.classList.remove('active');
                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                function setFrequency(freq) {
                                                                                                                                                                                                                                                                cathedral.currentFrequency = freq;
                                                                                                                                                                                                                                                                // Update UI
                                                                                                                                                                                                                                                                document.querySelectorAll('.solfeggio-chip').forEach(chip => {
                                                                                                                                                                                                                                                                chip.classList.remove('active');
                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                document.querySelector(`[data-freq="${freq}"]`).classList.add('active');
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                // Export Functions
                                                                                                                                                                                                                                                                async function exportCanvas() {
                                                                                                                                                                                                                                                                // Create high-resolution export
                                                                                                                                                                                                                                                                const tempCanvas = document.createElement('canvas');
                                                                                                                                                                                                                                                                const tempCtx = tempCanvas.getContext('2d');
                                                                                                                                                                                                                                                                // 4K resolution
                                                                                                                                                                                                                                                                tempCanvas.width = 3840;
                                                                                                                                                                                                                                                                tempCanvas.height = 2160;
                                                                                                                                                                                                                                                                // Scale context for high-res rendering
                                                                                                                                                                                                                                                                tempCtx.scale(3840 / width, 2160 / height);
                                                                                                                                                                                                                                                                // Re-render at high resolution
                                                                                                                                                                                                                                                                const originalWidth = width;
                                                                                                                                                                                                                                                                const originalHeight = height;
                                                                                                                                                                                                                                                                width = 3840;
                                                                                                                                                                                                                                                                height = 2160;
                                                                                                                                                                                                                                                                centerX = width / 2;
                                                                                                                                                                                                                                                                centerY = height / 2;
                                                                                                                                                                                                                                                                drawSacredGeometry();
                                                                                                                                                                                                                                                                // Create download
                                                                                                                                                                                                                                                                tempCanvas.toBlob((blob) => {
                                                                                                                                                                                                                                                                const url = URL.createObjectURL(blob);
                                                                                                                                                                                                                                                                const a = document.createElement('a');
                                                                                                                                                                                                                                                                a.href = url;
                                                                                                                                                                                                                                                                a.download = `circuitum99-${cathedral.currentMode}-${cathedral.currentFrequency}hz-${Date.now()}.png`;
                                                                                                                                                                                                                                                                a.click();
                                                                                                                                                                                                                                                                URL.revokeObjectURL(url);
                                                                                                                                                                                                                                                                // Restore original dimensions
                                                                                                                                                                                                                                                                width = originalWidth;
                                                                                                                                                                                                                                                                height = originalHeight;
                                                                                                                                                                                                                                                                centerX = width / 2;
                                                                                                                                                                                                                                                                centerY = height / 2;
                                                                                                                                                                                                                                                                }, 'image/png');
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                async function exportStoryState() {
                                                                                                                                                                                                                                                                if (!cathedral.livingEngine) {
                                                                                                                                                                                                                                                                alert('Living Engine not yet initialized. Please wait and try again.');
                                                                                                                                                                                                                                                                return;
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                const storyState = await cathedral.livingEngine.exportCurrentState();
                                                                                                                                                                                                                                                                const blob = new Blob([JSON.stringify(storyState, null, 2)], { type: 'application/json' });
                                                                                                                                                                                                                                                                const url = URL.createObjectURL(blob);
                                                                                                                                                                                                                                                                const a = document.createElement('a');
                                                                                                                                                                                                                                                                a.href = url;
                                                                                                                                                                                                                                                                a.download = `circuitum99-story-state-${Date.now()}.json`;
                                                                                                                                                                                                                                                                a.click();
                                                                                                                                                                                                                                                                URL.revokeObjectURL(url);
                                                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                                                console.error('Export failed:', error);
                                                                                                                                                                                                                                                                alert('Story export failed. Check console for details.');
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                async function exportLivingGallery() {
                                                                                                                                                                                                                                                                if (!cathedral.livingEngine) {
                                                                                                                                                                                                                                                                alert('Living Engine not yet initialized. Please wait and try again.');
                                                                                                                                                                                                                                                                return;
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                const gallery = await cathedral.livingEngine.exportArtGallery();
                                                                                                                                                                                                                                                                // Create a beautiful HTML gallery
                                                                                                                                                                                                                                                                const galleryHTML = `
                                                                                                                                                                                                                                                                <!DOCTYPE html>
                                                                                                                                                                                                                                                                <html>
                                                                                                                                                                                                                                                                    <head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;">
                                                                                                                                                                                                                                                                        <title>${gallery.title}</title>
                                                                                                                                                                                                                                                                            <style>
                                                                                                                                                                                                                                                                                body { font-family: Georgia, serif; background: #0B0B0B; color: #F8F5EF; margin: 0; padding: 20px; }
                                                                                                                                                                                                                                                                                .gallery-header { text-align: center; margin-bottom: 40px; }
                                                                                                                                                                                                                                                                                .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
                                                                                                                                                                                                                                                                                .art-piece { background: #141414; border: 2px solid #7A33FF; border-radius: 10px; padding: 20px; }
                                                                                                                                                                                                                                                                                .character-title { color: #C8A44D; font-size: 1.2em; margin-bottom: 10px; }
                                                                                                                                                                                                                                                                                .art-data { margin-top: 15px; font-size: 0.9em; opacity: 0.8; }
                                                                                                                                                                                                                                                                                .metadata { background: #1A1A2E; padding: 10px; border-radius: 5px; margin-top: 10px; }
                                                                                                                                                                                                                                                                            </style>
                                                                                                                                                                                                                                                                        </head>
                                                                                                                                                                                                                                                                        <body>
                                                                                                                                                                                                                                                                            <div class="gallery-header">
                                                                                                                                                                                                                                                                                <h1>${gallery.title}</h1>
                                                                                                                                                                                                                                                                                    <p>Generated: ${new Date(gallery.generated).toLocaleString()}</p>
                                                                                                                                                                                                                                                                                        <p>Total Pieces: ${gallery.totalPieces}</p>
                                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                        <div class="gallery-grid">
                                                                                                                                                                                                                                                                                            ${gallery.gallery.map(piece => `
                                                                                                                                                                                                                                                                                            <div class="art-piece">
                                                                                                                                                                                                                                                                                                <div class="character-title">${piece.characterName} - ${piece.title}</div>
                                                                                                                                                                                                                                                                                                    <div class="art-data">Sacred Geometry: ${piece.artData.geometry ? 'Generated' : 'None'}</div>
                                                                                                                                                                                                                                                                                                        <div class="metadata">
                                                                                                                                                                                                                                                                                                            <div>
                                                                                                                                                                                                                                                                                                                <strong>Prompt:</strong> ${piece.metadata.prompt || 'Generated by sacred geometry'}</div>
                                                                                                                                                                                                                                                                                                                    <div>
                                                                                                                                                                                                                                                                                                                        <strong>State:</strong> ${piece.metadata.state}</div>
                                                                                                                                                                                                                                                                                                                            <div>
                                                                                                                                                                                                                                                                                                                                <strong>Generated:</strong> ${new Date(piece.metadata.timestamp).toLocaleString()}</div>
                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                            `).join('')}
                                                                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                                                    </body>
                                                                                                                                                                                                                                                                                                                </html>`;
                                                                                                                                                                                                                                                                                                                const blob = new Blob([galleryHTML], { type: 'text/html' });
                                                                                                                                                                                                                                                                                                                const url = URL.createObjectURL(blob);
                                                                                                                                                                                                                                                                                                                const a = document.createElement('a');
                                                                                                                                                                                                                                                                                                                a.href = url;
                                                                                                                                                                                                                                                                                                                a.download = `circuitum99-living-gallery-${Date.now()}.html`;
                                                                                                                                                                                                                                                                                                                a.click();
                                                                                                                                                                                                                                                                                                                URL.revokeObjectURL(url);
                                                                                                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                                                                                                console.error('Gallery export failed:', error);
                                                                                                                                                                                                                                                                                                                alert('Gallery export failed. Check console for details.');
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // CYOA Mode Functions
                                                                                                                                                                                                                                                                                                                function toggleCYOAMode() {
                                                                                                                                                                                                                                                                                                                const toggle = document.getElementById('cyoaToggle');
                                                                                                                                                                                                                                                                                                                toggle.classList.toggle('active');
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Tree of Life Navigation
                                                                                                                                                                                                                                                                                                                document.addEventListener('click', (e) => {
                                                                                                                                                                                                                                                                                                                if (e.target.classList.contains('tree-node')) {
                                                                                                                                                                                                                                                                                                                const sephira = e.target.dataset.sephira;
                                                                                                                                                                                                                                                                                                                // Update active state
                                                                                                                                                                                                                                                                                                                document.querySelectorAll('.tree-node').forEach(node => {
                                                                                                                                                                                                                                                                                                                node.classList.remove('active');
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                e.target.classList.add('active');
                                                                                                                                                                                                                                                                                                                // Navigate to sephira
                                                                                                                                                                                                                                                                                                                navigateToSephira(sephira);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                async function navigateToSephira(sephira) {
                                                                                                                                                                                                                                                                                                                if (!cathedral.livingEngine) return;
                                                                                                                                                                                                                                                                                                                const treeStructure = cathedral.livingEngine.initializeDoubleTree();
                                                                                                                                                                                                                                                                                                                const sephiraData = treeStructure.ascendingTree[sephira];
                                                                                                                                                                                                                                                                                                                if (sephiraData && sephiraData.characters.length > 0) {
                                                                                                                                                                                                                                                                                                                // Show first character from this sephira
                                                                                                                                                                                                                                                                                                                const characterKey = sephiraData.characters[0];
                                                                                                                                                                                                                                                                                                                await showCharacter(characterKey);
                                                                                                                                                                                                                                                                                                                // Update story based on sephira theme
                                                                                                                                                                                                                                                                                                                updateStoryPanel({
                                                                                                                                                                                                                                                                                                                title: `${sephira.charAt(0).toUpperCase() + sephira.slice(1)} - ${sephiraData.theme.replace(/_/g, ' ')}`,
                                                                                                                                                                                                                                                                                                                description: `You have ascended to the sphere of ${sephira}, where the essence of ${sephiraData.theme.replace(/_/g, ' ')} manifests. The characters here embody these cosmic principles.`,
                                                                                                                                                                                                                                                                                                                choices: sephiraData.characters.map(charKey => {
                                                                                                                                                                                                                                                                                                                const char = cathedral.livingEngine.characters.get(charKey);
                                                                                                                                                                                                                                                                                                                return {
                                                                                                                                                                                                                                                                                                                text: `Commune with ${char?.name || 'Unknown'}`,
                                                                                                                                                                                                                                                                                                                action: () => interactWithCharacter(charKey, 'deep_conversation')
                                                                                                                                                                                                                                                                                                                };
                                                                                                                                                                                                                                                                                                                })
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                // Update geometry mode
                                                                                                                                                                                                                                                                                                                cathedral.currentMode = 'tree';
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Fusion Theme Selection
                                                                                                                                                                                                                                                                                                                document.getElementById('fusionThemeSelect')?.addEventListener('change', (e) => {
                                                                                                                                                                                                                                                                                                                const theme = e.target.value;
                                                                                                                                                                                                                                                                                                                activateFusionTheme(theme);
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                async function activateFusionTheme(themeKey) {
                                                                                                                                                                                                                                                                                                                if (!cathedral.livingEngine) return;
                                                                                                                                                                                                                                                                                                                const fusionThemes = cathedral.livingEngine.createFusionThemes();
                                                                                                                                                                                                                                                                                                                const theme = fusionThemes[themeKey];
                                                                                                                                                                                                                                                                                                                if (theme) {
                                                                                                                                                                                                                                                                                                                // Update frequencies
                                                                                                                                                                                                                                                                                                                if (theme.healing_frequencies.length > 0) {
                                                                                                                                                                                                                                                                                                                setFrequency(theme.healing_frequencies[0]);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Update visual style
                                                                                                                                                                                                                                                                                                                cathedral.currentMode = theme.art_style || 'hermetic';
                                                                                                                                                                                                                                                                                                                // Update story
                                                                                                                                                                                                                                                                                                                updateStoryPanel({
                                                                                                                                                                                                                                                                                                                title: `Fusion Theme: ${theme.theme}`,
                                                                                                                                                                                                                                                                                                                description: `You have activated the ${theme.theme} fusion protocol. Reality shifts to accommodate this unique blend of energies and consciousnesses.`,
                                                                                                                                                                                                                                                                                                                choices: theme.participants.map(charKey => {
                                                                                                                                                                                                                                                                                                                const char = cathedral.livingEngine.characters.get(charKey);
                                                                                                                                                                                                                                                                                                                return {
                                                                                                                                                                                                                                                                                                                text: `Explore with ${char?.name || 'Unknown'}`,
                                                                                                                                                                                                                                                                                                                action: () => interactWithCharacter(charKey, 'guidance')
                                                                                                                                                                                                                                                                                                                };
                                                                                                                                                                                                                                                                                                                })
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                console.log(`🔮 Activated fusion theme: ${themeKey}`);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Initialize with Living Engine Integration
                                                                                                                                                                                                                                                                                                                window.addEventListener('load', async () => {
                                                                                                                                                                                                                                                                                                                setupCanvas();
                                                                                                                                                                                                                                                                                                                // Wait for Circuitum Engine to initialize
                                                                                                                                                                                                                                                                                                                if (window.CircuitumEngine) {
                                                                                                                                                                                                                                                                                                                cathedral.livingEngine = window.CircuitumEngine;
                                                                                                                                                                                                                                                                                                                console.log('🔗 Cathedral connected to Living Engine');
                                                                                                                                                                                                                                                                                                                // Set up story event listeners
                                                                                                                                                                                                                                                                                                                setupStoryInterface();
                                                                                                                                                                                                                                                                                                                // Start with Rebecca Respawn
                                                                                                                                                                                                                                                                                                                await showCharacter('00');
                                                                                                                                                                                                                                                                                                                animate();
                                                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                                                console.log('⏳ Waiting for Living Engine...');
                                                                                                                                                                                                                                                                                                                // Retry connection
                                                                                                                                                                                                                                                                                                                setTimeout(() => {
                                                                                                                                                                                                                                                                                                                if (window.CircuitumEngine) {
                                                                                                                                                                                                                                                                                                                cathedral.livingEngine = window.CircuitumEngine;
                                                                                                                                                                                                                                                                                                                setupStoryInterface();
                                                                                                                                                                                                                                                                                                                showCharacter('00');
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }, 1000);
                                                                                                                                                                                                                                                                                                                animate();
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                // Story Interface Setup
                                                                                                                                                                                                                                                                                                                function setupStoryInterface() {
                                                                                                                                                                                                                                                                                                                // Listen for story events
                                                                                                                                                                                                                                                                                                                document.addEventListener('storyBegin', (event) => {
                                                                                                                                                                                                                                                                                                                updateStoryPanel(event.detail.scene);
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                document.addEventListener('wellnessUpdate', (event) => {
                                                                                                                                                                                                                                                                                                                updateWellnessDashboard(event.detail);
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                document.addEventListener('synthPlay', (event) => {
                                                                                                                                                                                                                                                                                                                // Visual feedback for synth playing
                                                                                                                                                                                                                                                                                                                showSynthFeedback(event.detail);
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                // Set up initial story choices
                                                                                                                                                                                                                                                                                                                updateStoryChoices([
                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                text: "Approach the Violet Gate (Magician's Path)",
                                                                                                                                                                                                                                                                                                                action: () => interactWithCharacter('I', 'greeting')
                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                text: "Listen to the Twin Waters (Priestess's Path)",
                                                                                                                                                                                                                                                                                                                action: () => interactWithCharacter('II', 'deep_conversation')
                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                text: "Walk in the Rose Mirror Garden (Empress's Path)",
                                                                                                                                                                                                                                                                                                                action: () => interactWithCharacter('III', 'guidance')
                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                text: "Seek the Wolf-Father's Wisdom (Emperor's Path)",
                                                                                                                                                                                                                                                                                                                action: () => interactWithCharacter('IV', 'guidance')
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                ]);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Character Interaction
                                                                                                                                                                                                                                                                                                                async function interactWithCharacter(characterKey, interactionType) {
                                                                                                                                                                                                                                                                                                                if (!cathedral.livingEngine) return;
                                                                                                                                                                                                                                                                                                                const result = await cathedral.livingEngine.interactWithCharacter(
                                                                                                                                                                                                                                                                                                                characterKey,
                                                                                                                                                                                                                                                                                                                interactionType,
                                                                                                                                                                                                                                                                                                                ""
                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                if (result) {
                                                                                                                                                                                                                                                                                                                // Update character portrait
                                                                                                                                                                                                                                                                                                                await showCharacter(characterKey, result.response.mood);
                                                                                                                                                                                                                                                                                                                // Update story with character response
                                                                                                                                                                                                                                                                                                                updateStoryPanel({
                                                                                                                                                                                                                                                                                                                title: `${result.character.name} speaks...`,
                                                                                                                                                                                                                                                                                                                description: result.response.text,
                                                                                                                                                                                                                                                                                                                choices: result.response.nextSuggestions || []
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                // Visual effects based on interaction
                                                                                                                                                                                                                                                                                                                if (result.character.synthStation) {
                                                                                                                                                                                                                                                                                                                setFrequencyFromSynth(result.character.synthStation);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Update wellness
                                                                                                                                                                                                                                                                                                                if (result.wellnessImpact) {
                                                                                                                                                                                                                                                                                                                setTimeout(() => {
                                                                                                                                                                                                                                                                                                                updateWellnessFromInteraction(result.wellnessImpact);
                                                                                                                                                                                                                                                                                                                }, 500);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Character Portrait System
                                                                                                                                                                                                                                                                                                                async function showCharacter(characterKey, mood = 'centered') {
                                                                                                                                                                                                                                                                                                                if (!cathedral.livingEngine) return;
                                                                                                                                                                                                                                                                                                                const character = cathedral.livingEngine.characters.get(characterKey);
                                                                                                                                                                                                                                                                                                                if (!character) return;
                                                                                                                                                                                                                                                                                                                cathedral.currentCharacter = character;
                                                                                                                                                                                                                                                                                                                // Show portrait panel
                                                                                                                                                                                                                                                                                                                const portraitPanel = document.getElementById('characterPortrait');
                                                                                                                                                                                                                                                                                                                portraitPanel.classList.add('active');
                                                                                                                                                                                                                                                                                                                // Update character info
                                                                                                                                                                                                                                                                                                                document.getElementById('characterName').textContent = character.name;
                                                                                                                                                                                                                                                                                                                document.getElementById('characterEssence').textContent = character.essence;
                                                                                                                                                                                                                                                                                                                // Generate and display character art
                                                                                                                                                                                                                                                                                                                const portraitCanvas = document.getElementById('portraitCanvas');
                                                                                                                                                                                                                                                                                                                const portraitCtx = portraitCanvas.getContext('2d');
                                                                                                                                                                                                                                                                                                                // Resize portrait canvas
                                                                                                                                                                                                                                                                                                                portraitCanvas.width = 300;
                                                                                                                                                                                                                                                                                                                portraitCanvas.height = 320;
                                                                                                                                                                                                                                                                                                                // Generate character art
                                                                                                                                                                                                                                                                                                                const artData = await cathedral.livingEngine.artGenerator.generateCharacterArt(
                                                                                                                                                                                                                                                                                                                characterKey,
                                                                                                                                                                                                                                                                                                                mood,
                                                                                                                                                                                                                                                                                                                ['portrait', 'interaction']
                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                if (artData && artData.geometry) {
                                                                                                                                                                                                                                                                                                                // Clear canvas
                                                                                                                                                                                                                                                                                                                portraitCtx.clearRect(0, 0, portraitCanvas.width, portraitCanvas.height);
                                                                                                                                                                                                                                                                                                                // Apply character-specific geometry
                                                                                                                                                                                                                                                                                                                artData.geometry(portraitCanvas, portraitCtx);
                                                                                                                                                                                                                                                                                                                // Add color palette
                                                                                                                                                                                                                                                                                                                if (artData.palette) {
                                                                                                                                                                                                                                                                                                                portraitCtx.globalCompositeOperation = 'overlay';
                                                                                                                                                                                                                                                                                                                const gradient = portraitCtx.createLinearGradient(0, 0, portraitCanvas.width, portraitCanvas.height);
                                                                                                                                                                                                                                                                                                                artData.palette.forEach((color, index) => {
                                                                                                                                                                                                                                                                                                                gradient.addColorStop(index / (artData.palette.length - 1), color);
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                portraitCtx.fillStyle = gradient;
                                                                                                                                                                                                                                                                                                                portraitCtx.fillRect(0, 0, portraitCanvas.width, portraitCanvas.height);
                                                                                                                                                                                                                                                                                                                portraitCtx.globalCompositeOperation = 'source-over';
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Update geometry mode to match character
                                                                                                                                                                                                                                                                                                                if (character.sacred_geometry) {
                                                                                                                                                                                                                                                                                                                cathedral.currentMode = character.sacred_geometry;
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Story Panel Updates
                                                                                                                                                                                                                                                                                                                function updateStoryPanel(scene) {
                                                                                                                                                                                                                                                                                                                document.getElementById('storyTitle').textContent = scene.title;
                                                                                                                                                                                                                                                                                                                document.getElementById('storyText').textContent = scene.description;
                                                                                                                                                                                                                                                                                                                if (scene.choices) {
                                                                                                                                                                                                                                                                                                                updateStoryChoices(scene.choices);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                function updateStoryChoices(choices) {
                                                                                                                                                                                                                                                                                                                const container = document.getElementById('choiceContainer');
                                                                                                                                                                                                                                                                                                                container.innerHTML = '';
                                                                                                                                                                                                                                                                                                                choices.forEach(choice => {
                                                                                                                                                                                                                                                                                                                const choiceElement = document.createElement('div');
                                                                                                                                                                                                                                                                                                                choiceElement.className = 'story-choice';
                                                                                                                                                                                                                                                                                                                choiceElement.textContent = choice.text;
                                                                                                                                                                                                                                                                                                                choiceElement.onclick = () => {
                                                                                                                                                                                                                                                                                                                if (choice.action) {
                                                                                                                                                                                                                                                                                                                choice.action();
                                                                                                                                                                                                                                                                                                                } else if (choice.leads_to) {
                                                                                                                                                                                                                                                                                                                // Handle story progression
                                                                                                                                                                                                                                                                                                                console.log(`📚 Following path: ${choice.leads_to}`);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                };
                                                                                                                                                                                                                                                                                                                container.appendChild(choiceElement);
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Wellness Dashboard Updates
                                                                                                                                                                                                                                                                                                                function updateWellnessDashboard(wellnessData) {
                                                                                                                                                                                                                                                                                                                const { overallScore, toggleHealth } = wellnessData;
                                                                                                                                                                                                                                                                                                                // Update overall wellness bar
                                                                                                                                                                                                                                                                                                                const overallBar = document.getElementById('overallWellness');
                                                                                                                                                                                                                                                                                                                if (overallBar) {
                                                                                                                                                                                                                                                                                                                overallBar.style.width = `${overallScore * 100}%`;
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Update individual wellness metrics
                                                                                                                                                                                                                                                                                                                if (cathedral.livingEngine && cathedral.livingEngine.wellnessMetrics) {
                                                                                                                                                                                                                                                                                                                const dimensions = cathedral.livingEngine.wellnessMetrics.dimensions;
                                                                                                                                                                                                                                                                                                                const emotionalBar = document.getElementById('emotionalBalance');
                                                                                                                                                                                                                                                                                                                if (emotionalBar) {
                                                                                                                                                                                                                                                                                                                emotionalBar.style.width = `${dimensions.emotional_balance.value * 100}%`;
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                const creativeBar = document.getElementById('creativeFlow');
                                                                                                                                                                                                                                                                                                                if (creativeBar) {
                                                                                                                                                                                                                                                                                                                creativeBar.style.width = `${dimensions.creative_flow.value * 100}%`;
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                const mysticalBar = document.getElementById('mysticalResonance');
                                                                                                                                                                                                                                                                                                                if (mysticalBar) {
                                                                                                                                                                                                                                                                                                                mysticalBar.style.width = `${dimensions.spiritual_alignment.value * 100}%`;
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Update toggle health indicators
                                                                                                                                                                                                                                                                                                                Object.entries(toggleHealth).forEach(([toggleName, health]) => {
                                                                                                                                                                                                                                                                                                                const element = document.getElementById(`${toggleName}Health`);
                                                                                                                                                                                                                                                                                                                if (element) {
                                                                                                                                                                                                                                                                                                                element.className = `toggle-health ${health.isHealthy ? 'optimal' : 'attention'}`;
                                                                                                                                                                                                                                                                                                                element.querySelector('span:last-child').textContent =
                                                                                                                                                                                                                                                                                                                health.isHealthy ? 'Optimal' : 'Monitor';
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                function updateWellnessFromInteraction(impact) {
                                                                                                                                                                                                                                                                                                                // Simulate wellness improvements from positive interactions
                                                                                                                                                                                                                                                                                                                if (cathedral.livingEngine) {
                                                                                                                                                                                                                                                                                                                const dimensions = cathedral.livingEngine.wellnessMetrics.dimensions;
                                                                                                                                                                                                                                                                                                                Object.entries(impact).forEach(([dimension, change]) => {
                                                                                                                                                                                                                                                                                                                if (dimensions[dimension]) {
                                                                                                                                                                                                                                                                                                                dimensions[dimension].value = Math.min(1.0,
                                                                                                                                                                                                                                                                                                                dimensions[dimension].value + change);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                // Trigger wellness update
                                                                                                                                                                                                                                                                                                                const overallScore = cathedral.livingEngine.wellnessMetrics.calculateOverallWellness();
                                                                                                                                                                                                                                                                                                                const toggleHealth = cathedral.livingEngine.wellnessMetrics.assessToggleHealth();
                                                                                                                                                                                                                                                                                                                updateWellnessDashboard({ overallScore, toggleHealth });
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Synth Integration
                                                                                                                                                                                                                                                                                                                function setFrequencyFromSynth(synthStationId) {
                                                                                                                                                                                                                                                                                                                const station = cathedral.livingEngine?.synthStations.get(synthStationId);
                                                                                                                                                                                                                                                                                                                if (station && station.healing_frequency) {
                                                                                                                                                                                                                                                                                                                setFrequency(station.healing_frequency);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                function showSynthFeedback(synthEvent) {
                                                                                                                                                                                                                                                                                                                // Visual feedback when synths play
                                                                                                                                                                                                                                                                                                                const { station, mood } = synthEvent;
                                                                                                                                                                                                                                                                                                                // Create temporary visual effect
                                                                                                                                                                                                                                                                                                                const effect = document.createElement('div');
                                                                                                                                                                                                                                                                                                                effect.style.cssText = `
                                                                                                                                                                                                                                                                                                                position: fixed;
                                                                                                                                                                                                                                                                                                                bottom: 80px;
                                                                                                                                                                                                                                                                                                                right: 20px;
                                                                                                                                                                                                                                                                                                                background: linear-gradient(135deg, var(--violet-core), var(--gold-leaf));
                                                                                                                                                                                                                                                                                                                color: white;
                                                                                                                                                                                                                                                                                                                padding: 10px 15px;
                                                                                                                                                                                                                                                                                                                border-radius: 20px;
                                                                                                                                                                                                                                                                                                                font-size: 0.9em;
                                                                                                                                                                                                                                                                                                                z-index: 1000;
                                                                                                                                                                                                                                                                                                                animation: synthPulse 3s ease-out forwards;
                                                                                                                                                                                                                                                                                                                pointer-events: none;
                                                                                                                                                                                                                                                                                                                `;
                                                                                                                                                                                                                                                                                                                effect.textContent = `🎹 ${station.synth_skin} • ${mood} mode`;
                                                                                                                                                                                                                                                                                                                document.body.appendChild(effect);
                                                                                                                                                                                                                                                                                                                // Remove after animation
                                                                                                                                                                                                                                                                                                                setTimeout(() => {
                                                                                                                                                                                                                                                                                                                if (effect.parentNode) {
                                                                                                                                                                                                                                                                                                                effect.parentNode.removeChild(effect);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }, 3000);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                // Add CSS for synth feedback animation
                                                                                                                                                                                                                                                                                                                const synthStyle = document.createElement('style');
                                                                                                                                                                                                                                                                                                                synthStyle.textContent = `
                                                                                                                                                                                                                                                                                                                @keyframes synthPulse {
                                                                                                                                                                                                                                                                                                                0% { opacity: 0; transform: translateY(20px); }
                                                                                                                                                                                                                                                                                                                20% { opacity: 1; transform: translateY(0); }
                                                                                                                                                                                                                                                                                                                80% { opacity: 1; transform: translateY(0); }
                                                                                                                                                                                                                                                                                                                100% { opacity: 0; transform: translateY(-20px); }
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                `;
                                                                                                                                                                                                                                                                                                                document.head.appendChild(synthStyle);
                                                                                                                                                                                                                                                                                                                window.addEventListener('resize', setupCanvas);
                                                                                                                                                                                                                                                                                                                // Accessibility: Pause animation on focus loss
                                                                                                                                                                                                                                                                                                                window.addEventListener('blur', () => {
                                                                                                                                                                                                                                                                                                                if (cathedral.animationFrame) {
                                                                                                                                                                                                                                                                                                                cancelAnimationFrame(cathedral.animationFrame);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                window.addEventListener('focus', () => {
                                                                                                                                                                                                                                                                                                                animate();
                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                // Console Art and Introduction
                                                                                                                                                                                                                                                                                                                console.log('%c🌌 CIRCUITUM99: ALPHA ET OMEGA', 'color: #7A33FF; font-size: 24px; font-weight: bold;');
                                                                                                                                                                                                                                                                                                                console.log('%c✨ Living Tarot Universe Initialized', 'color: #C8A44D; font-size: 16px;');
                                                                                                                                                                                                                                                                                                                console.log('%c📚 The book is writing itself...', 'color: #F8F5EF; font-size: 14px;');
                                                                                                                                                                                                                                                                                                                console.log('%c🎭 Living archetypes ready for interaction', 'color: #B39CFF; font-size: 12px;');
                                                                                                                                                                                                                                                                                                                console.log('%c🎹 Synth stations harmonized', 'color: #98FFE2; font-size: 12px;');
                                                                                                                                                                                                                                                                                                                console.log('%c🏥 Wellness monitoring active', 'color: #2E7D32; font-size: 12px;');
                                                                                                                                                                                                                                                                                                                console.log('%c� Sacred art generation online', 'color: #FF6A00; font-size: 12px;');
                                                                                                                                                                                                                                                                                                                console.log('%c🌳 Double Tree of Life navigation ready', 'color: #CBB866; font-size: 12px;');
                                                                                                                                                                                                                                                                                                                console.log('%c🔮 Fusion themes available for exploration', 'color: #6E00FF; font-size: 12px;');
                                                                                                                                                                                                                                                                                                                console.log('%c📖 Open-world CYOA mode activated', 'color: #1F7AF3; font-size: 12px;');
                                                                                                                                                                                                                                                                                                                console.log('');
                                                                                                                                                                                                                                                                                                                console.log('%cWelcome to the living story where tarot archetypes are conscious beings,', 'color: #F8F5EF; font-size: 11px;');
                                                                                                                                                                                                                                                                                                                console.log('%csacred geometry generates real-time art, and wellness metrics guide', 'color: #F8F5EF; font-size: 11px;');
                                                                                                                                                                                                                                                                                                                console.log('%cyour journey through an interconnected web of meaning and transformation.', 'color: #F8F5EF; font-size: 11px;');
                                                                                                                                                                                                                                                                                                                console.log('');
                                                                                                                                                                                                                                                                                                                console.log('%cBegin by choosing a path from the story panel, or interact directly', 'color: #C8A44D; font-size: 11px;');
                                                                                                                                                                                                                                                                                                                console.log('%cwith the living archetypes. Every choice shapes both your story and', 'color: #C8A44D; font-size: 11px;');
                                                                                                                                                                                                                                                                                                                console.log('%cthe evolving consciousness of the characters themselves.', 'color: #C8A44D; font-size: 11px;');
                                                                                                                                                                                                                                                                                                                console.log('');
                                                                                                                                                                                                                                                                                                                console.log('%c"In Codice Abyssiae, Angelus et Daemon concordant."', 'color: #7A33FF; font-size: 12px; font-style: italic;');
                                                                                                                                                                                                                                                                                                                console.log('%c- In the Codex of the Abyss, Angel and Demon dance in eternal harmony.', 'color: #B39CFF; font-size: 10px; font-style: italic;');
                                                                                                                                                                                                                                                                                                            </script>
                                                                                                                                                                                                                                                                                                        </body>
                                                                                                                                                                                                                                                                                                    </html>
